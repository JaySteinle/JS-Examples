(()=>{"use strict";var e={496:e=>{e.exports=require("vscode")},687:e=>{e.exports=require("https")}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=o(496),a=o(687),i=async(e,o)=>{const n=t.workspace.getConfiguration().get("chatgpt-helper.model"),i=await t.workspace.openTextDocument({content:"Querying ChatGPT. This may take some time...",language:"markdown"}),s=await t.window.showTextDocument(i,{viewColumn:t.ViewColumn.Beside,preserveFocus:!0,preview:!0}),r=e.split("\r\n").join("\n");let c="";const d=a.request({hostname:"api.openai.com",path:"/v1/chat/completions",method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}},(e=>{e.on("data",(e=>{process.stdout.write(e),c+=JSON.parse(e.toString()).choices[0].message.content}))}));d.write(JSON.stringify({model:"gpt-4"===n?"gpt-4":"gpt-3.5-turbo",max_tokens:512,messages:[{role:"system",content:"You are a knowledgeable and helpful assistant called ChatGPT, who is specialised to help answer queries about users' code."},{role:"user",content:r}]})),d.end(),d.on("close",(()=>{s.edit((e=>{e.replace(new t.Range(new t.Position(0,0),new t.Position(99999999999999,0)),`${c}`)}))})),d.on("error",(e=>{console.error(e),s.edit((o=>{o.replace(new t.Range(new t.Position(0,0),new t.Position(99999999999999,0)),`Error querying ChatGPT.\n\n${e}`)}))}))};e.activate=function(e){const o=async(o=!1)=>{const n=e.secrets,a=await n.get("openAIKey");if(a&&!o)return a;const i=await t.window.showInputBox({title:"OpenAI API Key",prompt:"Enter your OpenAI API key. You can find this at beta.openai.com/account/api-keys",ignoreFocusOut:!0,placeHolder:"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"});return i?(n.store("openAIKey",i),i):""},n=t.commands.registerCommand("chatgpt-helper.askChatGptWhyNotWorking",(async()=>{const e=t.window.activeTextEditor?.document.getText(t.window.activeTextEditor?.selection),n=t.window.activeTextEditor?.document.getText(),a=e||n;a?i("Why is the following code not working?\n"+a,await o()):t.window.showErrorMessage("No code selected or file is empty. Did not send to ChatGPT")})),a=t.commands.registerCommand("chatgpt-helper.askChatGptToExplainCode",(async()=>{const e=t.window.activeTextEditor?.document.getText(t.window.activeTextEditor?.selection),n=t.window.activeTextEditor?.document.getText(),a=e||n;a?i("Explain the following code:\n"+a,await o()):t.window.showErrorMessage("No code selected or file is empty. Did not send to ChatGPT")})),s=t.commands.registerCommand("chatgpt-helper.askChatGptCustomQuery",(async()=>{const e=await t.window.showInputBox({title:"ChatGPT Query",prompt:"Enter question for ChatGPT.",placeHolder:"Query"});e?i(e,await o()):t.window.showErrorMessage("No query entered. Did not send to ChatGPT")})),r=t.commands.registerCommand("chatgpt-helper.changeOpenAIAPIKey",(async()=>{await o(!0)}));e.subscriptions.push(n,a,s,r)},e.deactivate=function(){}})(),module.exports=n})();