"use strict";var cl=Object.create;var Wr=Object.defineProperty;var pl=Object.getOwnPropertyDescriptor;var dl=Object.getOwnPropertyNames;var ml=Object.getPrototypeOf,fl=Object.prototype.hasOwnProperty;var hl=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),gl=(e,t)=>{for(var r in t)Wr(e,r,{get:t[r],enumerable:!0})},vs=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of dl(t))!fl.call(e,s)&&s!==r&&Wr(e,s,{get:()=>t[s],enumerable:!(n=pl(t,s))||n.enumerable});return e};var Kr=(e,t,r)=>(r=e!=null?cl(ml(e)):{},vs(t||!e||!e.__esModule?Wr(r,"default",{value:e,enumerable:!0}):r,e)),yl=e=>vs(Wr({},"__esModule",{value:!0}),e);var fa=hl((_m,Jt)=>{"use strict";var Ll=typeof Buffer<"u",ca=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,pa=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function da(e,t,r){r==null&&t!==null&&typeof t=="object"&&(r=t,t=void 0),Ll&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));let n=JSON.parse(e,t);if(n===null||typeof n!="object")return n;let s=r&&r.protoAction||"error",a=r&&r.constructorAction||"error";if(s==="ignore"&&a==="ignore")return n;if(s!=="ignore"&&a!=="ignore"){if(ca.test(e)===!1&&pa.test(e)===!1)return n}else if(s!=="ignore"&&a==="ignore"){if(ca.test(e)===!1)return n}else if(pa.test(e)===!1)return n;return ma(n,{protoAction:s,constructorAction:a,safe:r&&r.safe})}function ma(e,{protoAction:t="error",constructorAction:r="error",safe:n}={}){let s=[e];for(;s.length;){let a=s;s=[];for(let o of a){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"__proto__")){if(n===!0)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.__proto__}if(r!=="ignore"&&Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype")){if(n===!0)return null;if(r==="error")throw new SyntaxError("Object contains forbidden prototype property");delete o.constructor}for(let l in o){let u=o[l];u&&typeof u=="object"&&s.push(u)}}}return e}function Nn(e,t,r){let n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return da(e,t,r)}finally{Error.stackTraceLimit=n}}function Fl(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return da(e,t,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=r}}Jt.exports=Nn;Jt.exports.default=Nn;Jt.exports.parse=Nn;Jt.exports.safeParse=Fl;Jt.exports.scan=ma});var sm={};gl(sm,{activate:()=>rm,deactivate:()=>nm});module.exports=yl(sm);var J=Kr(require("vscode"));var bs=()=>{let e=new Error("Delay aborted");return e.name="AbortError",e},vl=new WeakMap;function bl({clearTimeout:e,setTimeout:t}={}){return(r,{value:n,signal:s}={})=>{if(s?.aborted)return Promise.reject(bs());let a,o,l,u=e??clearTimeout,c=()=>{u(a),l(bs())},p=()=>{s&&s.removeEventListener("abort",c)},d=new Promise((f,v)=>{o=()=>{p(),f(n)},l=v,a=(t??setTimeout)(o,r)});return s&&s.addEventListener("abort",c,{once:!0}),vl.set(d,()=>{u(a),a=null,o()}),d}}var _l=bl(),_s=_l;var F=Kr(require("vscode"));var ws="vercel.ai.error",wl=Symbol.for(ws),xs,xl=class ks extends Error{constructor({name:t,message:r,cause:n}){super(r),this[xs]=!0,this.name=t,this.cause=n}static isInstance(t){return ks.hasMarker(t,ws)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};xs=wl;var A=xl,Ts="AI_APICallError",Ss=`vercel.ai.error.${Ts}`,kl=Symbol.for(Ss),Cs,xe=class extends A{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:s,responseBody:a,cause:o,isRetryable:l=n!=null&&(n===408||n===409||n===429||n>=500),data:u}){super({name:Ts,message:e,cause:o}),this[Cs]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=s,this.responseBody=a,this.isRetryable=l,this.data=u}static isInstance(e){return A.hasMarker(e,Ss)}};Cs=kl;var Is="AI_EmptyResponseBodyError",Es=`vercel.ai.error.${Is}`,Tl=Symbol.for(Es),As,Rs=class extends A{constructor({message:e="Empty response body"}={}){super({name:Is,message:e}),this[As]=!0}static isInstance(e){return A.hasMarker(e,Es)}};As=Tl;function tt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Ps="AI_InvalidArgumentError",Ns=`vercel.ai.error.${Ps}`,Sl=Symbol.for(Ns),js,Ms=class extends A{constructor({message:e,cause:t,argument:r}){super({name:Ps,message:e,cause:t}),this[js]=!0,this.argument=r}static isInstance(e){return A.hasMarker(e,Ns)}};js=Sl;var Os="AI_InvalidPromptError",Ds=`vercel.ai.error.${Os}`,Cl=Symbol.for(Ds),$s,je=class extends A{constructor({prompt:e,message:t,cause:r}){super({name:Os,message:`Invalid prompt: ${t}`,cause:r}),this[$s]=!0,this.prompt=e}static isInstance(e){return A.hasMarker(e,Ds)}};$s=Cl;var Us="AI_InvalidResponseDataError",qs=`vercel.ai.error.${Us}`,Il=Symbol.for(qs),Ls,rt=class extends A{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Us,message:t}),this[Ls]=!0,this.data=e}static isInstance(e){return A.hasMarker(e,qs)}};Ls=Il;var Fs="AI_JSONParseError",Js=`vercel.ai.error.${Fs}`,El=Symbol.for(Js),Vs,pr=class extends A{constructor({text:e,cause:t}){super({name:Fs,message:`JSON parsing failed: Text: ${e}.
Error message: ${tt(t)}`,cause:t}),this[Vs]=!0,this.text=e}static isInstance(e){return A.hasMarker(e,Js)}};Vs=El;var Zs="AI_LoadAPIKeyError",zs=`vercel.ai.error.${Zs}`,Al=Symbol.for(zs),Bs,dr=class extends A{constructor({message:e}){super({name:Zs,message:e}),this[Bs]=!0}static isInstance(e){return A.hasMarker(e,zs)}};Bs=Al;var Hs="AI_LoadSettingError",Gs=`vercel.ai.error.${Hs}`,Rl=Symbol.for(Gs),Ws,mr=class extends A{constructor({message:e}){super({name:Hs,message:e}),this[Ws]=!0}static isInstance(e){return A.hasMarker(e,Gs)}};Ws=Rl;var Pl="AI_NoContentGeneratedError",Nl=`vercel.ai.error.${Pl}`,jl=Symbol.for(Nl),Ml;Ml=jl;var Ks="AI_NoSuchModelError",Ys=`vercel.ai.error.${Ks}`,Ol=Symbol.for(Ys),Xs,Qs=class extends A{constructor({errorName:e=Ks,modelId:t,modelType:r,message:n=`No such ${r}: ${t}`}){super({name:e,message:n}),this[Xs]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return A.hasMarker(e,Ys)}};Xs=Ol;var ea="AI_TooManyEmbeddingValuesForCallError",ta=`vercel.ai.error.${ea}`,Dl=Symbol.for(ta),ra,Lt=class extends A{constructor(e){super({name:ea,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[ra]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return A.hasMarker(e,ta)}};ra=Dl;var na="AI_TypeValidationError",sa=`vercel.ai.error.${na}`,$l=Symbol.for(sa),aa,Ul=class Pn extends A{constructor({value:t,cause:r}){super({name:na,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${tt(r)}`,cause:r}),this[aa]=!0,this.value=t}static isInstance(t){return A.hasMarker(t,sa)}static wrap({value:t,cause:r}){return Pn.isInstance(r)&&r.value===t?r:new Pn({value:t,cause:r})}};aa=$l;var Ft=Ul,oa="AI_UnsupportedFunctionalityError",ia=`vercel.ai.error.${oa}`,ql=Symbol.for(ia),la,P=class extends A{constructor({functionality:e}){super({name:oa,message:`'${e}' functionality not supported.`}),this[la]=!0,this.functionality=e}static isInstance(e){return A.hasMarker(e,ia)}};la=ql;var ua=(e,t=21)=>(r=t)=>{let n="",s=r|0;for(;s--;)n+=e[Math.random()*e.length|0];return n};var tn=Kr(fa(),1);var Jl=Object.defineProperty,Vl=(e,t,r)=>t in e?Jl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Yr=(e,t,r)=>Vl(e,typeof t!="symbol"?t+"":t,r),Xr=class extends Error{constructor(t,r){super(t),Yr(this,"type"),Yr(this,"field"),Yr(this,"value"),Yr(this,"line"),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function jn(e){}function ha(e){let{onEvent:t=jn,onError:r=jn,onRetry:n=jn,onComment:s}=e,a="",o=!0,l,u="",c="";function p(m){let y=o?m.replace(/^\xEF\xBB\xBF/,""):m,[b,h]=Zl(`${a}${y}`);for(let w of b)d(w);a=h,o=!1}function d(m){if(m===""){v();return}if(m.startsWith(":")){s&&s(m.slice(m.startsWith(": ")?2:1));return}let y=m.indexOf(":");if(y!==-1){let b=m.slice(0,y),h=m[y+1]===" "?2:1,w=m.slice(y+h);f(b,w,m);return}f(m,"",m)}function f(m,y,b){switch(m){case"event":c=y;break;case"data":u=`${u}${y}
`;break;case"id":l=y.includes("\0")?void 0:y;break;case"retry":/^\d+$/.test(y)?n(parseInt(y,10)):r(new Xr(`Invalid \`retry\` value: "${y}"`,{type:"invalid-retry",value:y,line:b}));break;default:r(new Xr(`Unknown field "${m.length>20?`${m.slice(0,20)}\u2026`:m}"`,{type:"unknown-field",field:m,value:y,line:b}));break}}function v(){u.length>0&&t({id:l,event:c||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),l=void 0,u="",c=""}function g(m={}){a&&m.consume&&d(a),l=void 0,u="",c="",a=""}return{feed:p,reset:g}}function Zl(e){let t=[],r="",n=e.length;for(let s=0;s<n;s++){let a=e[s];a==="\r"&&e[s+1]===`
`?(t.push(r),r="",s++):a==="\r"||a===`
`?(t.push(r),r=""):r+=a}return[t,r]}var Qr=class extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let s;super({start(a){s=ha({onEvent:o=>{a.enqueue(o)},onError(o){t==="terminate"?a.error(o):typeof t=="function"&&t(o)},onRetry:r,onComment:n})},transform(a){s.feed(a)}})}};function ee(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function ga(e){return new ReadableStream({async pull(t){try{let{value:r,done:n}=await e.next();n?t.close():t.enqueue(r)}catch(r){t.error(r)}},cancel(){}})}function en(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r}),t}var He=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{let s=ua(r,t);if(e==null)return s;if(r.includes(n))throw new Ms({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return a=>`${e}${n}${s(a)}`},ie=He();function ya(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function fr(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function nt({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new dr({message:`${n} API key must be a string.`});if(typeof process>"u")throw new dr({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new dr({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new dr({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function va({settingValue:e,environmentVariableName:t,settingName:r,description:n}){if(typeof e=="string")return e;if(e!=null)throw new mr({message:`${n} setting must be a string.`});if(typeof process>"u")throw new mr({message:`${n} setting is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new mr({message:`${n} setting is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new mr({message:`${n} setting must be a string. The value of the ${t} environment variable is not a string.`});return e}var hr=Symbol.for("vercel.ai.validator");function zl(e){return{[hr]:!0,validate:e}}function Bl(e){return typeof e=="object"&&e!==null&&hr in e&&e[hr]===!0&&"validate"in e}function Hl(e){return Bl(e)?e:Gl(e)}function Gl(e){return zl(t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Wl({value:e,schema:t}){let r=st({value:e,schema:t});if(!r.success)throw Ft.wrap({value:e,cause:r.error});return r.value}function st({value:e,schema:t}){let r=Hl(t);try{if(r.validate==null)return{success:!0,value:e};let n=r.validate(e);return n.success?n:{success:!1,error:Ft.wrap({value:e,cause:n.error})}}catch(n){return{success:!1,error:Ft.wrap({value:e,cause:n})}}}function Kl({text:e,schema:t}){try{let r=tn.default.parse(e);return t==null?r:Wl({value:r,schema:t})}catch(r){throw pr.isInstance(r)||Ft.isInstance(r)?r:new pr({text:e,cause:r})}}function bt({text:e,schema:t}){try{let r=tn.default.parse(e);return t==null?{success:!0,value:r}:st({value:r,schema:t})}catch(r){return{success:!1,error:pr.isInstance(r)?r:new pr({text:e,cause:r})}}}function Vt(e){try{return tn.default.parse(e),!0}catch{return!1}}function Yl(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var Xl=()=>globalThis.fetch,X=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:s,abortSignal:a,fetch:o})=>Ql({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:s,abortSignal:a,fetch:o}),Ql=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:s,abortSignal:a,fetch:o=Xl()})=>{try{let l=await o(e,{method:"POST",headers:Yl(t),body:r.content,signal:a}),u=en(l);if(!l.ok){let c;try{c=await s({response:l,url:e,requestBodyValues:r.values})}catch(p){throw fr(p)||xe.isInstance(p)?p:new xe({message:"Failed to process error response",cause:p,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:r.values})}throw c.value}try{return await n({response:l,url:e,requestBodyValues:r.values})}catch(c){throw c instanceof Error&&(fr(c)||xe.isInstance(c))?c:new xe({message:"Failed to process successful response",cause:c,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:r.values})}}catch(l){if(fr(l))throw l;if(l instanceof TypeError&&l.message==="fetch failed"){let u=l.cause;if(u!=null)throw new xe({message:`Cannot connect to API: ${u.message}`,cause:u,url:e,requestBodyValues:r.values,isRetryable:!0})}throw l}};async function _t(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var at=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:s,requestBodyValues:a})=>{let o=await n.text(),l=en(n);if(o.trim()==="")return{responseHeaders:l,value:new xe({message:n.statusText,url:s,requestBodyValues:a,statusCode:n.status,responseHeaders:l,responseBody:o,isRetryable:r?.(n)})};try{let u=Kl({text:o,schema:e});return{responseHeaders:l,value:new xe({message:t(u),url:s,requestBodyValues:a,statusCode:n.status,responseHeaders:l,responseBody:o,data:u,isRetryable:r?.(n,u)})}}catch{return{responseHeaders:l,value:new xe({message:n.statusText,url:s,requestBodyValues:a,statusCode:n.status,responseHeaders:l,responseBody:o,isRetryable:r?.(n)})}}},Ee=e=>async({response:t})=>{let r=en(t);if(t.body==null)throw new Rs({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new Qr).pipeThrough(new TransformStream({transform({data:n},s){n!=="[DONE]"&&s.enqueue(bt({text:n,schema:e}))}}))}};var ne=e=>async({response:t,url:r,requestBodyValues:n})=>{let s=await t.text(),a=bt({text:s,schema:e}),o=en(t);if(!a.success)throw new xe({message:"Invalid JSON response",cause:a.error,statusCode:t.status,responseHeaders:o,responseBody:s,url:r,requestBodyValues:n});return{responseHeaders:o,value:a.value}},{btoa:eu,atob:tu}=globalThis;function ba(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=tu(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function Me(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return eu(t)}function Zt(e){return e?.replace(/\/$/,"")}var Z;(function(e){e.assertEqual=s=>s;function t(s){}e.assertIs=t;function r(s){throw new Error}e.assertNever=r,e.arrayToEnum=s=>{let a={};for(let o of s)a[o]=o;return a},e.getValidEnumValues=s=>{let a=e.objectKeys(s).filter(l=>typeof s[s[l]]!="number"),o={};for(let l of a)o[l]=s[l];return e.objectValues(o)},e.objectValues=s=>e.objectKeys(s).map(function(a){return s[a]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let a=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&a.push(o);return a},e.find=(s,a)=>{for(let o of s)if(a(o))return o},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,a=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}e.joinValues=n,e.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(Z||(Z={}));var On;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(On||(On={}));var C=Z.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),We=e=>{switch(typeof e){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(e)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(e)?C.array:e===null?C.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?C.promise:typeof Map<"u"&&e instanceof Map?C.map:typeof Set<"u"&&e instanceof Set?C.set:typeof Date<"u"&&e instanceof Date?C.date:C.object;default:return C.unknown}},x=Z.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ru=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ke=class e extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){let r=t||function(a){return a.message},n={_errors:[]},s=a=>{for(let o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(r(o));else{let l=n,u=0;for(;u<o.path.length;){let c=o.path[u];u===o.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(r(o))):l[c]=l[c]||{_errors:[]},l=l[c],u++}}};return s(this),n}static assert(t){if(!(t instanceof e))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Z.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){let r={},n=[];for(let s of this.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};ke.create=e=>new ke(e);var Ht=(e,t)=>{let r;switch(e.code){case x.invalid_type:e.received===C.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case x.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Z.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:r=`Unrecognized key(s) in object: ${Z.joinValues(e.keys,", ")}`;break;case x.invalid_union:r="Invalid input";break;case x.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Z.joinValues(e.options)}`;break;case x.invalid_enum_value:r=`Invalid enum value. Expected ${Z.joinValues(e.options)}, received '${e.received}'`;break;case x.invalid_arguments:r="Invalid function arguments";break;case x.invalid_return_type:r="Invalid function return type";break;case x.invalid_date:r="Invalid date";break;case x.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Z.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case x.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case x.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case x.custom:r="Invalid input";break;case x.invalid_intersection_types:r="Intersection results could not be merged";break;case x.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case x.not_finite:r="Number must be finite";break;default:r=t.defaultError,Z.assertNever(e)}return{message:r}},xa=Ht;function nu(e){xa=e}function rn(){return xa}var nn=e=>{let{data:t,path:r,errorMaps:n,issueData:s}=e,a=[...r,...s.path||[]],o={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let l="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)l=c(o,{data:t,defaultError:l}).message;return{...s,path:a,message:l}},su=[];function T(e,t){let r=rn(),n=nn({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===Ht?void 0:Ht].filter(s=>!!s)});e.common.issues.push(n)}var ce=class e{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){let n=[];for(let s of r){if(s.status==="aborted")return M;s.status==="dirty"&&t.dirty(),n.push(s.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){let n=[];for(let s of r){let a=await s.key,o=await s.value;n.push({key:a,value:o})}return e.mergeObjectSync(t,n)}static mergeObjectSync(t,r){let n={};for(let s of r){let{key:a,value:o}=s;if(a.status==="aborted"||o.status==="aborted")return M;a.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),a.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(n[a.value]=o.value)}return{status:t.value,value:n}}},M=Object.freeze({status:"aborted"}),Bt=e=>({status:"dirty",value:e}),me=e=>({status:"valid",value:e}),Dn=e=>e.status==="aborted",$n=e=>e.status==="dirty",wt=e=>e.status==="valid",vr=e=>typeof Promise<"u"&&e instanceof Promise;function sn(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function ka(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}var E;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(E||(E={}));var gr,yr,Ae=class{constructor(t,r,n,s){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},_a=(e,t)=>{if(wt(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new ke(e.common.issues);return this._error=r,this._error}}};function D(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(o,l)=>{var u,c;let{message:p}=e;return o.code==="invalid_enum_value"?{message:p??l.defaultError}:typeof l.data>"u"?{message:(u=p??n)!==null&&u!==void 0?u:l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:(c=p??r)!==null&&c!==void 0?c:l.defaultError}},description:s}}var $=class{get description(){return this._def.description}_getType(t){return We(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:We(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ce,ctx:{common:t.parent.common,data:t.data,parsedType:We(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let r=this._parse(t);if(vr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){let r=this._parse(t);return Promise.resolve(r)}parse(t,r){let n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){var n;let s={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:We(t)},a=this._parseSync({data:t,path:s.path,parent:s});return _a(s,a)}"~validate"(t){var r,n;let s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:We(t)};if(!this["~standard"].async)try{let a=this._parseSync({data:t,path:[],parent:s});return wt(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:s}).then(a=>wt(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(t,r){let n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:We(t)},s=this._parse({data:t,path:n.path,parent:n}),a=await(vr(s)?s:Promise.resolve(s));return _a(n,a)}refine(t,r){let n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,a)=>{let o=t(s),l=()=>a.addIssue({code:x.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(t,r){return this._refinement((n,s)=>t(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(t){return new Te({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ve.create(this,this._def)}nullable(){return Je.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ye.create(this)}promise(){return lt.create(this,this._def)}or(t){return Et.create([this,t],this._def)}and(t){return At.create(this,t,this._def)}transform(t){return new Te({...D(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let r=typeof t=="function"?t:()=>t;return new Mt({...D(this._def),innerType:this,defaultValue:r,typeName:k.ZodDefault})}brand(){return new br({typeName:k.ZodBranded,type:this,...D(this._def)})}catch(t){let r=typeof t=="function"?t:()=>t;return new Ot({...D(this._def),innerType:this,catchValue:r,typeName:k.ZodCatch})}describe(t){let r=this.constructor;return new r({...this._def,description:t})}pipe(t){return _r.create(this,t)}readonly(){return Dt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},au=/^c[^\s-]{8,}$/i,ou=/^[0-9a-z]+$/,iu=/^[0-9A-HJKMNP-TV-Z]{26}$/i,lu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,uu=/^[a-z0-9_-]{21}$/i,cu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,pu=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,du=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,mu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Mn,fu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,hu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,gu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,yu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ta="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",_u=new RegExp(`^${Ta}$`);function Sa(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function wu(e){return new RegExp(`^${Sa(e)}$`)}function Ca(e){let t=`${Ta}T${Sa(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function xu(e,t){return!!((t==="v4"||!t)&&fu.test(e)||(t==="v6"||!t)&&gu.test(e))}function ku(e,t){if(!cu.test(e))return!1;try{let[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||t&&s.alg!==t)}catch{return!1}}function Tu(e,t){return!!((t==="v4"||!t)&&hu.test(e)||(t==="v6"||!t)&&yu.test(e))}var ot=class e extends ${_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==C.string){let a=this._getOrReturnCtx(t);return T(a,{code:x.invalid_type,expected:C.string,received:a.parsedType}),M}let n=new ce,s;for(let a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(s=this._getOrReturnCtx(t,s),T(s,{code:x.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")t.data.length>a.value&&(s=this._getOrReturnCtx(t,s),T(s,{code:x.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let o=t.data.length>a.value,l=t.data.length<a.value;(o||l)&&(s=this._getOrReturnCtx(t,s),o?T(s,{code:x.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):l&&T(s,{code:x.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")du.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"email",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")Mn||(Mn=new RegExp(mu,"u")),Mn.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"emoji",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")lu.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"uuid",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")uu.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"nanoid",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")au.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"cuid",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")ou.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"cuid2",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")iu.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"ulid",code:x.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),T(s,{validation:"url",code:x.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"regex",code:x.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(t,s),T(s,{code:x.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(s=this._getOrReturnCtx(t,s),T(s,{code:x.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(s=this._getOrReturnCtx(t,s),T(s,{code:x.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?Ca(a).test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{code:x.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?_u.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{code:x.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?wu(a).test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{code:x.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?pu.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"duration",code:x.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?xu(t.data,a.version)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"ip",code:x.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?ku(t.data,a.alg)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"jwt",code:x.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?Tu(t.data,a.version)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"cidr",code:x.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?vu.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"base64",code:x.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?bu.test(t.data)||(s=this._getOrReturnCtx(t,s),T(s,{validation:"base64url",code:x.invalid_string,message:a.message}),n.dirty()):Z.assertNever(a);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(s=>t.test(s),{validation:r,code:x.invalid_string,...E.errToObj(n)})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...E.errToObj(t)})}url(t){return this._addCheck({kind:"url",...E.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...E.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...E.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...E.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...E.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...E.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...E.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...E.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...E.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...E.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...E.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...E.errToObj(t)})}datetime(t){var r,n;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:(r=t?.offset)!==null&&r!==void 0?r:!1,local:(n=t?.local)!==null&&n!==void 0?n:!1,...E.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision,...E.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...E.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...E.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r?.position,...E.errToObj(r?.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...E.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...E.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...E.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...E.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...E.errToObj(r)})}nonempty(t){return this.min(1,E.errToObj(t))}trim(){return new e({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new e({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new e({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};ot.create=e=>{var t;return new ot({checks:[],typeName:k.ZodString,coerce:(t=e?.coerce)!==null&&t!==void 0?t:!1,...D(e)})};function Su(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n,a=parseInt(e.toFixed(s).replace(".","")),o=parseInt(t.toFixed(s).replace(".",""));return a%o/Math.pow(10,s)}var xt=class e extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==C.number){let a=this._getOrReturnCtx(t);return T(a,{code:x.invalid_type,expected:C.number,received:a.parsedType}),M}let n,s=new ce;for(let a of this._def.checks)a.kind==="int"?Z.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),T(n,{code:x.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(n=this._getOrReturnCtx(t,n),T(n,{code:x.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(n=this._getOrReturnCtx(t,n),T(n,{code:x.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Su(t.data,a.value)!==0&&(n=this._getOrReturnCtx(t,n),T(n,{code:x.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),T(n,{code:x.not_finite,message:a.message}),s.dirty()):Z.assertNever(a);return{status:s.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,E.toString(r))}gt(t,r){return this.setLimit("min",t,!1,E.toString(r))}lte(t,r){return this.setLimit("max",t,!0,E.toString(r))}lt(t,r){return this.setLimit("max",t,!1,E.toString(r))}setLimit(t,r,n,s){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:E.toString(s)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:E.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:E.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:E.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:E.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:E.toString(t)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Z.isInteger(t.value))}get isFinite(){let t=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}};xt.create=e=>new xt({checks:[],typeName:k.ZodNumber,coerce:e?.coerce||!1,...D(e)});var kt=class e extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==C.bigint)return this._getInvalidInput(t);let n,s=new ce;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(n=this._getOrReturnCtx(t,n),T(n,{code:x.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(n=this._getOrReturnCtx(t,n),T(n,{code:x.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),T(n,{code:x.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Z.assertNever(a);return{status:s.value,value:t.data}}_getInvalidInput(t){let r=this._getOrReturnCtx(t);return T(r,{code:x.invalid_type,expected:C.bigint,received:r.parsedType}),M}gte(t,r){return this.setLimit("min",t,!0,E.toString(r))}gt(t,r){return this.setLimit("min",t,!1,E.toString(r))}lte(t,r){return this.setLimit("max",t,!0,E.toString(r))}lt(t,r){return this.setLimit("max",t,!1,E.toString(r))}setLimit(t,r,n,s){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:E.toString(s)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:E.toString(r)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};kt.create=e=>{var t;return new kt({checks:[],typeName:k.ZodBigInt,coerce:(t=e?.coerce)!==null&&t!==void 0?t:!1,...D(e)})};var Tt=class extends ${_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==C.boolean){let n=this._getOrReturnCtx(t);return T(n,{code:x.invalid_type,expected:C.boolean,received:n.parsedType}),M}return me(t.data)}};Tt.create=e=>new Tt({typeName:k.ZodBoolean,coerce:e?.coerce||!1,...D(e)});var St=class e extends ${_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==C.date){let a=this._getOrReturnCtx(t);return T(a,{code:x.invalid_type,expected:C.date,received:a.parsedType}),M}if(isNaN(t.data.getTime())){let a=this._getOrReturnCtx(t);return T(a,{code:x.invalid_date}),M}let n=new ce,s;for(let a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(s=this._getOrReturnCtx(t,s),T(s,{code:x.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(s=this._getOrReturnCtx(t,s),T(s,{code:x.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Z.assertNever(a);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:E.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:E.toString(r)})}get minDate(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}};St.create=e=>new St({checks:[],coerce:e?.coerce||!1,typeName:k.ZodDate,...D(e)});var Gt=class extends ${_parse(t){if(this._getType(t)!==C.symbol){let n=this._getOrReturnCtx(t);return T(n,{code:x.invalid_type,expected:C.symbol,received:n.parsedType}),M}return me(t.data)}};Gt.create=e=>new Gt({typeName:k.ZodSymbol,...D(e)});var Ct=class extends ${_parse(t){if(this._getType(t)!==C.undefined){let n=this._getOrReturnCtx(t);return T(n,{code:x.invalid_type,expected:C.undefined,received:n.parsedType}),M}return me(t.data)}};Ct.create=e=>new Ct({typeName:k.ZodUndefined,...D(e)});var It=class extends ${_parse(t){if(this._getType(t)!==C.null){let n=this._getOrReturnCtx(t);return T(n,{code:x.invalid_type,expected:C.null,received:n.parsedType}),M}return me(t.data)}};It.create=e=>new It({typeName:k.ZodNull,...D(e)});var it=class extends ${constructor(){super(...arguments),this._any=!0}_parse(t){return me(t.data)}};it.create=e=>new it({typeName:k.ZodAny,...D(e)});var Ke=class extends ${constructor(){super(...arguments),this._unknown=!0}_parse(t){return me(t.data)}};Ke.create=e=>new Ke({typeName:k.ZodUnknown,...D(e)});var Oe=class extends ${_parse(t){let r=this._getOrReturnCtx(t);return T(r,{code:x.invalid_type,expected:C.never,received:r.parsedType}),M}};Oe.create=e=>new Oe({typeName:k.ZodNever,...D(e)});var Wt=class extends ${_parse(t){if(this._getType(t)!==C.undefined){let n=this._getOrReturnCtx(t);return T(n,{code:x.invalid_type,expected:C.void,received:n.parsedType}),M}return me(t.data)}};Wt.create=e=>new Wt({typeName:k.ZodVoid,...D(e)});var Ye=class e extends ${_parse(t){let{ctx:r,status:n}=this._processInputParams(t),s=this._def;if(r.parsedType!==C.array)return T(r,{code:x.invalid_type,expected:C.array,received:r.parsedType}),M;if(s.exactLength!==null){let o=r.data.length>s.exactLength.value,l=r.data.length<s.exactLength.value;(o||l)&&(T(r,{code:o?x.too_big:x.too_small,minimum:l?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(T(r,{code:x.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(T(r,{code:x.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((o,l)=>s.type._parseAsync(new Ae(r,o,r.path,l)))).then(o=>ce.mergeArray(n,o));let a=[...r.data].map((o,l)=>s.type._parseSync(new Ae(r,o,r.path,l)));return ce.mergeArray(n,a)}get element(){return this._def.type}min(t,r){return new e({...this._def,minLength:{value:t,message:E.toString(r)}})}max(t,r){return new e({...this._def,maxLength:{value:t,message:E.toString(r)}})}length(t,r){return new e({...this._def,exactLength:{value:t,message:E.toString(r)}})}nonempty(t){return this.min(1,t)}};Ye.create=(e,t)=>new Ye({type:e,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...D(t)});function zt(e){if(e instanceof be){let t={};for(let r in e.shape){let n=e.shape[r];t[r]=ve.create(zt(n))}return new be({...e._def,shape:()=>t})}else return e instanceof Ye?new Ye({...e._def,type:zt(e.element)}):e instanceof ve?ve.create(zt(e.unwrap())):e instanceof Je?Je.create(zt(e.unwrap())):e instanceof Fe?Fe.create(e.items.map(t=>zt(t))):e}var be=class e extends ${constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),r=Z.objectKeys(t);return this._cached={shape:t,keys:r}}_parse(t){if(this._getType(t)!==C.object){let c=this._getOrReturnCtx(t);return T(c,{code:x.invalid_type,expected:C.object,received:c.parsedType}),M}let{status:n,ctx:s}=this._processInputParams(t),{shape:a,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Oe&&this._def.unknownKeys==="strip"))for(let c in s.data)o.includes(c)||l.push(c);let u=[];for(let c of o){let p=a[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:p._parse(new Ae(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Oe){let c=this._def.unknownKeys;if(c==="passthrough")for(let p of l)u.push({key:{status:"valid",value:p},value:{status:"valid",value:s.data[p]}});else if(c==="strict")l.length>0&&(T(s,{code:x.unrecognized_keys,keys:l}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let p of l){let d=s.data[p];u.push({key:{status:"valid",value:p},value:c._parse(new Ae(s,d,s.path,p)),alwaysSet:p in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let p of u){let d=await p.key,f=await p.value;c.push({key:d,value:f,alwaysSet:p.alwaysSet})}return c}).then(c=>ce.mergeObjectSync(n,c)):ce.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(t){return E.errToObj,new e({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var s,a,o,l;let u=(o=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,r,n).message)!==null&&o!==void 0?o:n.defaultError;return r.code==="unrecognized_keys"?{message:(l=E.errToObj(t).message)!==null&&l!==void 0?l:u}:{message:u}}}:{}})}strip(){return new e({...this._def,unknownKeys:"strip"})}passthrough(){return new e({...this._def,unknownKeys:"passthrough"})}extend(t){return new e({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new e({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:k.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new e({...this._def,catchall:t})}pick(t){let r={};return Z.objectKeys(t).forEach(n=>{t[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new e({...this._def,shape:()=>r})}omit(t){let r={};return Z.objectKeys(this.shape).forEach(n=>{t[n]||(r[n]=this.shape[n])}),new e({...this._def,shape:()=>r})}deepPartial(){return zt(this)}partial(t){let r={};return Z.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];t&&!t[n]?r[n]=s:r[n]=s.optional()}),new e({...this._def,shape:()=>r})}required(t){let r={};return Z.objectKeys(this.shape).forEach(n=>{if(t&&!t[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ve;)a=a._def.innerType;r[n]=a}}),new e({...this._def,shape:()=>r})}keyof(){return Ia(Z.objectKeys(this.shape))}};be.create=(e,t)=>new be({shape:()=>e,unknownKeys:"strip",catchall:Oe.create(),typeName:k.ZodObject,...D(t)});be.strictCreate=(e,t)=>new be({shape:()=>e,unknownKeys:"strict",catchall:Oe.create(),typeName:k.ZodObject,...D(t)});be.lazycreate=(e,t)=>new be({shape:e,unknownKeys:"strip",catchall:Oe.create(),typeName:k.ZodObject,...D(t)});var Et=class extends ${_parse(t){let{ctx:r}=this._processInputParams(t),n=this._def.options;function s(a){for(let l of a)if(l.result.status==="valid")return l.result;for(let l of a)if(l.result.status==="dirty")return r.common.issues.push(...l.ctx.common.issues),l.result;let o=a.map(l=>new ke(l.ctx.common.issues));return T(r,{code:x.invalid_union,unionErrors:o}),M}if(r.common.async)return Promise.all(n.map(async a=>{let o={...r,common:{...r.common,issues:[]},parent:null};return{result:await a._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(s);{let a,o=[];for(let u of n){let c={...r,common:{...r.common,issues:[]},parent:null},p=u._parseSync({data:r.data,path:r.path,parent:c});if(p.status==="valid")return p;p.status==="dirty"&&!a&&(a={result:p,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(a)return r.common.issues.push(...a.ctx.common.issues),a.result;let l=o.map(u=>new ke(u));return T(r,{code:x.invalid_union,unionErrors:l}),M}}get options(){return this._def.options}};Et.create=(e,t)=>new Et({options:e,typeName:k.ZodUnion,...D(t)});var Ge=e=>e instanceof Rt?Ge(e.schema):e instanceof Te?Ge(e.innerType()):e instanceof Pt?[e.value]:e instanceof Nt?e.options:e instanceof jt?Z.objectValues(e.enum):e instanceof Mt?Ge(e._def.innerType):e instanceof Ct?[void 0]:e instanceof It?[null]:e instanceof ve?[void 0,...Ge(e.unwrap())]:e instanceof Je?[null,...Ge(e.unwrap())]:e instanceof br||e instanceof Dt?Ge(e.unwrap()):e instanceof Ot?Ge(e._def.innerType):[],an=class e extends ${_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==C.object)return T(r,{code:x.invalid_type,expected:C.object,received:r.parsedType}),M;let n=this.discriminator,s=r.data[n],a=this.optionsMap.get(s);return a?r.common.async?a._parseAsync({data:r.data,path:r.path,parent:r}):a._parseSync({data:r.data,path:r.path,parent:r}):(T(r,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),M)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,r,n){let s=new Map;for(let a of r){let o=Ge(a.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let l of o){if(s.has(l))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(l)}`);s.set(l,a)}}return new e({typeName:k.ZodDiscriminatedUnion,discriminator:t,options:r,optionsMap:s,...D(n)})}};function Un(e,t){let r=We(e),n=We(t);if(e===t)return{valid:!0,data:e};if(r===C.object&&n===C.object){let s=Z.objectKeys(t),a=Z.objectKeys(e).filter(l=>s.indexOf(l)!==-1),o={...e,...t};for(let l of a){let u=Un(e[l],t[l]);if(!u.valid)return{valid:!1};o[l]=u.data}return{valid:!0,data:o}}else if(r===C.array&&n===C.array){if(e.length!==t.length)return{valid:!1};let s=[];for(let a=0;a<e.length;a++){let o=e[a],l=t[a],u=Un(o,l);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return r===C.date&&n===C.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}var At=class extends ${_parse(t){let{status:r,ctx:n}=this._processInputParams(t),s=(a,o)=>{if(Dn(a)||Dn(o))return M;let l=Un(a.value,o.value);return l.valid?(($n(a)||$n(o))&&r.dirty(),{status:r.value,value:l.data}):(T(n,{code:x.invalid_intersection_types}),M)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,o])=>s(a,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};At.create=(e,t,r)=>new At({left:e,right:t,typeName:k.ZodIntersection,...D(r)});var Fe=class e extends ${_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==C.array)return T(n,{code:x.invalid_type,expected:C.array,received:n.parsedType}),M;if(n.data.length<this._def.items.length)return T(n,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),M;!this._def.rest&&n.data.length>this._def.items.length&&(T(n,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let a=[...n.data].map((o,l)=>{let u=this._def.items[l]||this._def.rest;return u?u._parse(new Ae(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(a).then(o=>ce.mergeArray(r,o)):ce.mergeArray(r,a)}get items(){return this._def.items}rest(t){return new e({...this._def,rest:t})}};Fe.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Fe({items:e,typeName:k.ZodTuple,rest:null,...D(t)})};var on=class e extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==C.object)return T(n,{code:x.invalid_type,expected:C.object,received:n.parsedType}),M;let s=[],a=this._def.keyType,o=this._def.valueType;for(let l in n.data)s.push({key:a._parse(new Ae(n,l,n.path,l)),value:o._parse(new Ae(n,n.data[l],n.path,l)),alwaysSet:l in n.data});return n.common.async?ce.mergeObjectAsync(r,s):ce.mergeObjectSync(r,s)}get element(){return this._def.valueType}static create(t,r,n){return r instanceof $?new e({keyType:t,valueType:r,typeName:k.ZodRecord,...D(n)}):new e({keyType:ot.create(),valueType:t,typeName:k.ZodRecord,...D(r)})}},Kt=class extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==C.map)return T(n,{code:x.invalid_type,expected:C.map,received:n.parsedType}),M;let s=this._def.keyType,a=this._def.valueType,o=[...n.data.entries()].map(([l,u],c)=>({key:s._parse(new Ae(n,l,n.path,[c,"key"])),value:a._parse(new Ae(n,u,n.path,[c,"value"]))}));if(n.common.async){let l=new Map;return Promise.resolve().then(async()=>{for(let u of o){let c=await u.key,p=await u.value;if(c.status==="aborted"||p.status==="aborted")return M;(c.status==="dirty"||p.status==="dirty")&&r.dirty(),l.set(c.value,p.value)}return{status:r.value,value:l}})}else{let l=new Map;for(let u of o){let c=u.key,p=u.value;if(c.status==="aborted"||p.status==="aborted")return M;(c.status==="dirty"||p.status==="dirty")&&r.dirty(),l.set(c.value,p.value)}return{status:r.value,value:l}}}};Kt.create=(e,t,r)=>new Kt({valueType:t,keyType:e,typeName:k.ZodMap,...D(r)});var Yt=class e extends ${_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==C.set)return T(n,{code:x.invalid_type,expected:C.set,received:n.parsedType}),M;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(T(n,{code:x.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(T(n,{code:x.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());let a=this._def.valueType;function o(u){let c=new Set;for(let p of u){if(p.status==="aborted")return M;p.status==="dirty"&&r.dirty(),c.add(p.value)}return{status:r.value,value:c}}let l=[...n.data.values()].map((u,c)=>a._parse(new Ae(n,u,n.path,c)));return n.common.async?Promise.all(l).then(u=>o(u)):o(l)}min(t,r){return new e({...this._def,minSize:{value:t,message:E.toString(r)}})}max(t,r){return new e({...this._def,maxSize:{value:t,message:E.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}};Yt.create=(e,t)=>new Yt({valueType:e,minSize:null,maxSize:null,typeName:k.ZodSet,...D(t)});var ln=class e extends ${constructor(){super(...arguments),this.validate=this.implement}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==C.function)return T(r,{code:x.invalid_type,expected:C.function,received:r.parsedType}),M;function n(l,u){return nn({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,rn(),Ht].filter(c=>!!c),issueData:{code:x.invalid_arguments,argumentsError:u}})}function s(l,u){return nn({data:l,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,rn(),Ht].filter(c=>!!c),issueData:{code:x.invalid_return_type,returnTypeError:u}})}let a={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof lt){let l=this;return me(async function(...u){let c=new ke([]),p=await l._def.args.parseAsync(u,a).catch(v=>{throw c.addIssue(n(u,v)),c}),d=await Reflect.apply(o,this,p);return await l._def.returns._def.type.parseAsync(d,a).catch(v=>{throw c.addIssue(s(d,v)),c})})}else{let l=this;return me(function(...u){let c=l._def.args.safeParse(u,a);if(!c.success)throw new ke([n(u,c.error)]);let p=Reflect.apply(o,this,c.data),d=l._def.returns.safeParse(p,a);if(!d.success)throw new ke([s(p,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new e({...this._def,args:Fe.create(t).rest(Ke.create())})}returns(t){return new e({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,r,n){return new e({args:t||Fe.create([]).rest(Ke.create()),returns:r||Ke.create(),typeName:k.ZodFunction,...D(n)})}},Rt=class extends ${get schema(){return this._def.getter()}_parse(t){let{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Rt.create=(e,t)=>new Rt({getter:e,typeName:k.ZodLazy,...D(t)});var Pt=class extends ${_parse(t){if(t.data!==this._def.value){let r=this._getOrReturnCtx(t);return T(r,{received:r.data,code:x.invalid_literal,expected:this._def.value}),M}return{status:"valid",value:t.data}}get value(){return this._def.value}};Pt.create=(e,t)=>new Pt({value:e,typeName:k.ZodLiteral,...D(t)});function Ia(e,t){return new Nt({values:e,typeName:k.ZodEnum,...D(t)})}var Nt=class e extends ${constructor(){super(...arguments),gr.set(this,void 0)}_parse(t){if(typeof t.data!="string"){let r=this._getOrReturnCtx(t),n=this._def.values;return T(r,{expected:Z.joinValues(n),received:r.parsedType,code:x.invalid_type}),M}if(sn(this,gr,"f")||ka(this,gr,new Set(this._def.values),"f"),!sn(this,gr,"f").has(t.data)){let r=this._getOrReturnCtx(t),n=this._def.values;return T(r,{received:r.data,code:x.invalid_enum_value,options:n}),M}return me(t.data)}get options(){return this._def.values}get enum(){let t={};for(let r of this._def.values)t[r]=r;return t}get Values(){let t={};for(let r of this._def.values)t[r]=r;return t}get Enum(){let t={};for(let r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return e.create(t,{...this._def,...r})}exclude(t,r=this._def){return e.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}};gr=new WeakMap;Nt.create=Ia;var jt=class extends ${constructor(){super(...arguments),yr.set(this,void 0)}_parse(t){let r=Z.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==C.string&&n.parsedType!==C.number){let s=Z.objectValues(r);return T(n,{expected:Z.joinValues(s),received:n.parsedType,code:x.invalid_type}),M}if(sn(this,yr,"f")||ka(this,yr,new Set(Z.getValidEnumValues(this._def.values)),"f"),!sn(this,yr,"f").has(t.data)){let s=Z.objectValues(r);return T(n,{received:n.data,code:x.invalid_enum_value,options:s}),M}return me(t.data)}get enum(){return this._def.values}};yr=new WeakMap;jt.create=(e,t)=>new jt({values:e,typeName:k.ZodNativeEnum,...D(t)});var lt=class extends ${unwrap(){return this._def.type}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==C.promise&&r.common.async===!1)return T(r,{code:x.invalid_type,expected:C.promise,received:r.parsedType}),M;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return me(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}};lt.create=(e,t)=>new lt({type:e,typeName:k.ZodPromise,...D(t)});var Te=class extends ${innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:r,ctx:n}=this._processInputParams(t),s=this._def.effect||null,a={addIssue:o=>{T(n,o),o.fatal?r.abort():r.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){let o=s.transform(n.data,a);if(n.common.async)return Promise.resolve(o).then(async l=>{if(r.value==="aborted")return M;let u=await this._def.schema._parseAsync({data:l,path:n.path,parent:n});return u.status==="aborted"?M:u.status==="dirty"||r.value==="dirty"?Bt(u.value):u});{if(r.value==="aborted")return M;let l=this._def.schema._parseSync({data:o,path:n.path,parent:n});return l.status==="aborted"?M:l.status==="dirty"||r.value==="dirty"?Bt(l.value):l}}if(s.type==="refinement"){let o=l=>{let u=s.refinement(l,a);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){let l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?M:(l.status==="dirty"&&r.dirty(),o(l.value),{status:r.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?M:(l.status==="dirty"&&r.dirty(),o(l.value).then(()=>({status:r.value,value:l.value}))))}if(s.type==="transform")if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!wt(o))return o;let l=s.transform(o.value,a);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>wt(o)?Promise.resolve(s.transform(o.value,a)).then(l=>({status:r.value,value:l})):o);Z.assertNever(s)}};Te.create=(e,t,r)=>new Te({schema:e,typeName:k.ZodEffects,effect:t,...D(r)});Te.createWithPreprocess=(e,t,r)=>new Te({schema:t,effect:{type:"preprocess",transform:e},typeName:k.ZodEffects,...D(r)});var ve=class extends ${_parse(t){return this._getType(t)===C.undefined?me(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ve.create=(e,t)=>new ve({innerType:e,typeName:k.ZodOptional,...D(t)});var Je=class extends ${_parse(t){return this._getType(t)===C.null?me(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Je.create=(e,t)=>new Je({innerType:e,typeName:k.ZodNullable,...D(t)});var Mt=class extends ${_parse(t){let{ctx:r}=this._processInputParams(t),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Mt.create=(e,t)=>new Mt({innerType:e,typeName:k.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...D(t)});var Ot=class extends ${_parse(t){let{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return vr(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new ke(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ke(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ot.create=(e,t)=>new Ot({innerType:e,typeName:k.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...D(t)});var Xt=class extends ${_parse(t){if(this._getType(t)!==C.nan){let n=this._getOrReturnCtx(t);return T(n,{code:x.invalid_type,expected:C.nan,received:n.parsedType}),M}return{status:"valid",value:t.data}}};Xt.create=e=>new Xt({typeName:k.ZodNaN,...D(e)});var Cu=Symbol("zod_brand"),br=class extends ${_parse(t){let{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},_r=class e extends ${_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?M:a.status==="dirty"?(r.dirty(),Bt(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?M:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(t,r){return new e({in:t,out:r,typeName:k.ZodPipeline})}},Dt=class extends ${_parse(t){let r=this._def.innerType._parse(t),n=s=>(wt(s)&&(s.value=Object.freeze(s.value)),s);return vr(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}};Dt.create=(e,t)=>new Dt({innerType:e,typeName:k.ZodReadonly,...D(t)});function Ea(e,t={},r){return e?it.create().superRefine((n,s)=>{var a,o;if(!e(n)){let l=typeof t=="function"?t(n):typeof t=="string"?{message:t}:t,u=(o=(a=l.fatal)!==null&&a!==void 0?a:r)!==null&&o!==void 0?o:!0,c=typeof l=="string"?{message:l}:l;s.addIssue({code:"custom",...c,fatal:u})}}):it.create()}var Iu={object:be.lazycreate},k;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(k||(k={}));var Eu=(e,t={message:`Input not instance of ${e.name}`})=>Ea(r=>r instanceof e,t),Aa=ot.create,Ra=xt.create,Au=Xt.create,Ru=kt.create,Pa=Tt.create,Pu=St.create,Nu=Gt.create,ju=Ct.create,Mu=It.create,Ou=it.create,Du=Ke.create,$u=Oe.create,Uu=Wt.create,qu=Ye.create,Lu=be.create,Fu=be.strictCreate,Ju=Et.create,Vu=an.create,Zu=At.create,zu=Fe.create,Bu=on.create,Hu=Kt.create,Gu=Yt.create,Wu=ln.create,Ku=Rt.create,Yu=Pt.create,Xu=Nt.create,Qu=jt.create,ec=lt.create,wa=Te.create,tc=ve.create,rc=Je.create,nc=Te.createWithPreprocess,sc=_r.create,ac=()=>Aa().optional(),oc=()=>Ra().optional(),ic=()=>Pa().optional(),lc={string:e=>ot.create({...e,coerce:!0}),number:e=>xt.create({...e,coerce:!0}),boolean:e=>Tt.create({...e,coerce:!0}),bigint:e=>kt.create({...e,coerce:!0}),date:e=>St.create({...e,coerce:!0})},uc=M,i=Object.freeze({__proto__:null,defaultErrorMap:Ht,setErrorMap:nu,getErrorMap:rn,makeIssue:nn,EMPTY_PATH:su,addIssueToContext:T,ParseStatus:ce,INVALID:M,DIRTY:Bt,OK:me,isAborted:Dn,isDirty:$n,isValid:wt,isAsync:vr,get util(){return Z},get objectUtil(){return On},ZodParsedType:C,getParsedType:We,ZodType:$,datetimeRegex:Ca,ZodString:ot,ZodNumber:xt,ZodBigInt:kt,ZodBoolean:Tt,ZodDate:St,ZodSymbol:Gt,ZodUndefined:Ct,ZodNull:It,ZodAny:it,ZodUnknown:Ke,ZodNever:Oe,ZodVoid:Wt,ZodArray:Ye,ZodObject:be,ZodUnion:Et,ZodDiscriminatedUnion:an,ZodIntersection:At,ZodTuple:Fe,ZodRecord:on,ZodMap:Kt,ZodSet:Yt,ZodFunction:ln,ZodLazy:Rt,ZodLiteral:Pt,ZodEnum:Nt,ZodNativeEnum:jt,ZodPromise:lt,ZodEffects:Te,ZodTransformer:Te,ZodOptional:ve,ZodNullable:Je,ZodDefault:Mt,ZodCatch:Ot,ZodNaN:Xt,BRAND:Cu,ZodBranded:br,ZodPipeline:_r,ZodReadonly:Dt,custom:Ea,Schema:$,ZodSchema:$,late:Iu,get ZodFirstPartyTypeKind(){return k},coerce:lc,any:Ou,array:qu,bigint:Ru,boolean:Pa,date:Pu,discriminatedUnion:Vu,effect:wa,enum:Xu,function:Wu,instanceof:Eu,intersection:Zu,lazy:Ku,literal:Yu,map:Hu,nan:Au,nativeEnum:Qu,never:$u,null:Mu,nullable:rc,number:Ra,object:Lu,oboolean:ic,onumber:oc,optional:tc,ostring:ac,pipeline:sc,preprocess:nc,promise:ec,record:Bu,set:Gu,strictObject:Fu,string:Aa,symbol:Nu,transformer:wa,tuple:zu,undefined:ju,union:Ju,unknown:Du,void:Uu,NEVER:uc,ZodIssueCode:x,quotelessJson:ru,ZodError:ke});var cc=i.object({type:i.literal("error"),error:i.object({type:i.string(),message:i.string()})}),Na=at({errorSchema:cc,errorToMessage:e=>e.error.message});function pc({prompt:e,cacheControl:t}){var r,n,s,a;let o=new Set,l=dc(e),u,c=[];function p(d){var f;if(t===!1)return;let v=d?.anthropic;return(f=v?.cacheControl)!=null?f:v?.cache_control}for(let d=0;d<l.length;d++){let f=l[d],v=d===l.length-1,g=f.type;switch(g){case"system":{if(u!=null)throw new P({functionality:"Multiple system messages that are separated by user/assistant messages"});u=f.messages.map(({content:m,providerMetadata:y})=>({type:"text",text:m,cache_control:p(y)}));break}case"user":{let m=[];for(let y of f.messages){let{role:b,content:h}=y;switch(b){case"user":{for(let w=0;w<h.length;w++){let _=h[w],I=w===h.length-1,S=(r=p(_.providerMetadata))!=null?r:I?p(y.providerMetadata):void 0;switch(_.type){case"text":{m.push({type:"text",text:_.text,cache_control:S});break}case"image":{if(_.image instanceof URL)throw new P({functionality:"Image URLs in user messages"});m.push({type:"image",source:{type:"base64",media_type:(n=_.mimeType)!=null?n:"image/jpeg",data:Me(_.image)},cache_control:S});break}case"file":{if(_.data instanceof URL)throw new P({functionality:"Image URLs in user messages"});if(_.mimeType!=="application/pdf")throw new P({functionality:"Non-PDF files in user messages"});o.add("pdfs-2024-09-25"),m.push({type:"document",source:{type:"base64",media_type:"application/pdf",data:_.data},cache_control:S});break}}}break}case"tool":{for(let w=0;w<h.length;w++){let _=h[w],I=w===h.length-1,S=(s=p(_.providerMetadata))!=null?s:I?p(y.providerMetadata):void 0,j=_.content!=null?_.content.map(q=>{var U;switch(q.type){case"text":return{type:"text",text:q.text,cache_control:void 0};case"image":return{type:"image",source:{type:"base64",media_type:(U=q.mimeType)!=null?U:"image/jpeg",data:q.data},cache_control:void 0}}}):JSON.stringify(_.result);m.push({type:"tool_result",tool_use_id:_.toolCallId,content:j,is_error:_.isError,cache_control:S})}break}default:{let w=b;throw new Error(`Unsupported role: ${w}`)}}}c.push({role:"user",content:m});break}case"assistant":{let m=[];for(let y=0;y<f.messages.length;y++){let b=f.messages[y],h=y===f.messages.length-1,{content:w}=b;for(let _=0;_<w.length;_++){let I=w[_],S=_===w.length-1,j=(a=p(I.providerMetadata))!=null?a:S?p(b.providerMetadata):void 0;switch(I.type){case"text":{m.push({type:"text",text:v&&h&&S?I.text.trim():I.text,cache_control:j});break}case"tool-call":{m.push({type:"tool_use",id:I.toolCallId,name:I.toolName,input:I.args,cache_control:j});break}}}}c.push({role:"assistant",content:m});break}default:{let m=g;throw new Error(`Unsupported type: ${m}`)}}}return{prompt:{system:u,messages:c},betas:o}}function dc(e){let t=[],r;for(let n of e){let{role:s}=n;switch(s){case"system":{r?.type!=="system"&&(r={type:"system",messages:[]},t.push(r)),r.messages.push(n);break}case"assistant":{r?.type!=="assistant"&&(r={type:"assistant",messages:[]},t.push(r)),r.messages.push(n);break}case"user":{r?.type!=="user"&&(r={type:"user",messages:[]},t.push(r)),r.messages.push(n);break}case"tool":{r?.type!=="user"&&(r={type:"user",messages:[]},t.push(r)),r.messages.push(n);break}default:{let a=s;throw new Error(`Unsupported role: ${a}`)}}}return t}function ja(e){switch(e){case"end_turn":case"stop_sequence":return"stop";case"tool_use":return"tool-calls";case"max_tokens":return"length";default:return"unknown"}}function mc(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0,n=[],s=new Set;if(r==null)return{tools:void 0,tool_choice:void 0,toolWarnings:n,betas:s};let a=[];for(let u of r)switch(u.type){case"function":a.push({name:u.name,description:u.description,input_schema:u.parameters});break;case"provider-defined":switch(s.add("computer-use-2024-10-22"),u.id){case"anthropic.computer_20241022":a.push({name:u.name,type:"computer_20241022",display_width_px:u.args.displayWidthPx,display_height_px:u.args.displayHeightPx,display_number:u.args.displayNumber});break;case"anthropic.text_editor_20241022":a.push({name:u.name,type:"text_editor_20241022"});break;case"anthropic.bash_20241022":a.push({name:u.name,type:"bash_20241022"});break;default:n.push({type:"unsupported-tool",tool:u});break}break;default:n.push({type:"unsupported-tool",tool:u});break}let o=e.toolChoice;if(o==null)return{tools:a,tool_choice:void 0,toolWarnings:n,betas:s};let l=o.type;switch(l){case"auto":return{tools:a,tool_choice:{type:"auto"},toolWarnings:n,betas:s};case"required":return{tools:a,tool_choice:{type:"any"},toolWarnings:n,betas:s};case"none":return{tools:void 0,tool_choice:void 0,toolWarnings:n,betas:s};case"tool":return{tools:a,tool_choice:{type:"tool",name:o.toolName},toolWarnings:n,betas:s};default:{let u=l;throw new P({functionality:`Unsupported tool choice type: ${u}`})}}}var fc=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:s,topK:a,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:p}){var d;let f=e.type,v=[];o!=null&&v.push({type:"unsupported-setting",setting:"frequencyPenalty"}),l!=null&&v.push({type:"unsupported-setting",setting:"presencePenalty"}),p!=null&&v.push({type:"unsupported-setting",setting:"seed"}),c!=null&&c.type!=="text"&&v.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:g,betas:m}=pc({prompt:t,cacheControl:(d=this.settings.cacheControl)!=null?d:!1}),y={model:this.modelId,max_tokens:r??4096,temperature:n,top_k:a,top_p:s,stop_sequences:u,system:g.system,messages:g.messages};switch(f){case"regular":{let{tools:b,tool_choice:h,toolWarnings:w,betas:_}=mc(e);return{args:{...y,tools:b,tool_choice:h},warnings:[...v,...w],betas:new Set([...m,..._])}}case"object-json":throw new P({functionality:"json-mode object generation"});case"object-tool":{let{name:b,description:h,parameters:w}=e.tool;return{args:{...y,tools:[{name:b,description:h,input_schema:w}],tool_choice:{type:"tool",name:b}},warnings:v,betas:m}}default:{let b=f;throw new Error(`Unsupported type: ${b}`)}}}async getHeaders({betas:e,headers:t}){return this.settings.cacheControl&&e.add("prompt-caching-2024-07-31"),ee(await _t(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(",")}:{},t)}buildRequestUrl(e){var t,r,n;return(n=(r=(t=this.config).buildRequestUrl)==null?void 0:r.call(t,this.config.baseURL,e))!=null?n:`${this.config.baseURL}/messages`}transformRequestBody(e){var t,r,n;return(n=(r=(t=this.config).transformRequestBody)==null?void 0:r.call(t,e))!=null?n:e}async doGenerate(e){var t,r,n,s;let{args:a,warnings:o,betas:l}=await this.getArgs(e),{responseHeaders:u,value:c}=await X({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:l,headers:e.headers}),body:this.transformRequestBody(a),failedResponseHandler:Na,successfulResponseHandler:ne(hc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:p,...d}=a,f="";for(let g of c.content)g.type==="text"&&(f+=g.text);let v;if(c.content.some(g=>g.type==="tool_use")){v=[];for(let g of c.content)g.type==="tool_use"&&v.push({toolCallType:"function",toolCallId:g.id,toolName:g.name,args:JSON.stringify(g.input)})}return{text:f,toolCalls:v,finishReason:ja(c.stop_reason),usage:{promptTokens:c.usage.input_tokens,completionTokens:c.usage.output_tokens},rawCall:{rawPrompt:p,rawSettings:d},rawResponse:{headers:u},response:{id:(t=c.id)!=null?t:void 0,modelId:(r=c.model)!=null?r:void 0},warnings:o,providerMetadata:this.settings.cacheControl===!0?{anthropic:{cacheCreationInputTokens:(n=c.usage.cache_creation_input_tokens)!=null?n:null,cacheReadInputTokens:(s=c.usage.cache_read_input_tokens)!=null?s:null}}:void 0,request:{body:JSON.stringify(a)}}}async doStream(e){let{args:t,warnings:r,betas:n}=await this.getArgs(e),s={...t,stream:!0},{responseHeaders:a,value:o}=await X({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:n,headers:e.headers}),body:this.transformRequestBody(s),failedResponseHandler:Na,successfulResponseHandler:Ee(gc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:l,...u}=t,c="unknown",p={promptTokens:Number.NaN,completionTokens:Number.NaN},d={},f,v=this;return{stream:o.pipeThrough(new TransformStream({transform(g,m){var y,b,h,w;if(!g.success){m.enqueue({type:"error",error:g.error});return}let _=g.value;switch(_.type){case"ping":return;case"content_block_start":{let I=_.content_block.type;switch(I){case"text":return;case"tool_use":{d[_.index]={toolCallId:_.content_block.id,toolName:_.content_block.name,jsonText:""};return}default:{let S=I;throw new Error(`Unsupported content block type: ${S}`)}}}case"content_block_stop":{if(d[_.index]!=null){let I=d[_.index];m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:I.toolCallId,toolName:I.toolName,args:I.jsonText}),delete d[_.index]}return}case"content_block_delta":{let I=_.delta.type;switch(I){case"text_delta":{m.enqueue({type:"text-delta",textDelta:_.delta.text});return}case"input_json_delta":{let S=d[_.index];m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:S.toolCallId,toolName:S.toolName,argsTextDelta:_.delta.partial_json}),S.jsonText+=_.delta.partial_json;return}default:{let S=I;throw new Error(`Unsupported delta type: ${S}`)}}}case"message_start":{p.promptTokens=_.message.usage.input_tokens,p.completionTokens=_.message.usage.output_tokens,v.settings.cacheControl===!0&&(f={anthropic:{cacheCreationInputTokens:(y=_.message.usage.cache_creation_input_tokens)!=null?y:null,cacheReadInputTokens:(b=_.message.usage.cache_read_input_tokens)!=null?b:null}}),m.enqueue({type:"response-metadata",id:(h=_.message.id)!=null?h:void 0,modelId:(w=_.message.model)!=null?w:void 0});return}case"message_delta":{p.completionTokens=_.usage.output_tokens,c=ja(_.delta.stop_reason);return}case"message_stop":{m.enqueue({type:"finish",finishReason:c,usage:p,providerMetadata:f});return}case"error":{m.enqueue({type:"error",error:_.error});return}default:{let I=_;throw new Error(`Unsupported chunk type: ${I}`)}}}})),rawCall:{rawPrompt:l,rawSettings:u},rawResponse:{headers:a},warnings:r,request:{body:JSON.stringify(s)}}}},hc=i.object({type:i.literal("message"),id:i.string().nullish(),model:i.string().nullish(),content:i.array(i.discriminatedUnion("type",[i.object({type:i.literal("text"),text:i.string()}),i.object({type:i.literal("tool_use"),id:i.string(),name:i.string(),input:i.unknown()})])),stop_reason:i.string().nullish(),usage:i.object({input_tokens:i.number(),output_tokens:i.number(),cache_creation_input_tokens:i.number().nullish(),cache_read_input_tokens:i.number().nullish()})}),gc=i.discriminatedUnion("type",[i.object({type:i.literal("message_start"),message:i.object({id:i.string().nullish(),model:i.string().nullish(),usage:i.object({input_tokens:i.number(),output_tokens:i.number(),cache_creation_input_tokens:i.number().nullish(),cache_read_input_tokens:i.number().nullish()})})}),i.object({type:i.literal("content_block_start"),index:i.number(),content_block:i.discriminatedUnion("type",[i.object({type:i.literal("text"),text:i.string()}),i.object({type:i.literal("tool_use"),id:i.string(),name:i.string()})])}),i.object({type:i.literal("content_block_delta"),index:i.number(),delta:i.discriminatedUnion("type",[i.object({type:i.literal("input_json_delta"),partial_json:i.string()}),i.object({type:i.literal("text_delta"),text:i.string()})])}),i.object({type:i.literal("content_block_stop"),index:i.number()}),i.object({type:i.literal("error"),error:i.object({type:i.string(),message:i.string()})}),i.object({type:i.literal("message_delta"),delta:i.object({stop_reason:i.string().nullish()}),usage:i.object({output_tokens:i.number()})}),i.object({type:i.literal("message_stop")}),i.object({type:i.literal("ping")})]),yc=i.object({command:i.string(),restart:i.boolean().optional()});function vc(e={}){return{type:"provider-defined",id:"anthropic.bash_20241022",args:{},parameters:yc,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var bc=i.object({command:i.enum(["view","create","str_replace","insert","undo_edit"]),path:i.string(),file_text:i.string().optional(),insert_line:i.number().int().optional(),new_str:i.string().optional(),old_str:i.string().optional(),view_range:i.array(i.number().int()).optional()});function _c(e={}){return{type:"provider-defined",id:"anthropic.text_editor_20241022",args:{},parameters:bc,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var wc=i.object({action:i.enum(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:i.array(i.number().int()).optional(),text:i.string().optional()});function xc(e){return{type:"provider-defined",id:"anthropic.computer_20241022",args:{displayWidthPx:e.displayWidthPx,displayHeightPx:e.displayHeightPx,displayNumber:e.displayNumber},parameters:wc,execute:e.execute,experimental_toToolResultContent:e.experimental_toToolResultContent}}var kc={bash_20241022:vc,textEditor_20241022:_c,computer_20241022:xc};function qn(e={}){var t;let r=(t=Zt(e.baseURL))!=null?t:"https://api.anthropic.com/v1",n=()=>({"anthropic-version":"2023-06-01","x-api-key":nt({apiKey:e.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...e.headers}),s=(o,l={})=>new fc(o,l,{provider:"anthropic.messages",baseURL:r,headers:n,fetch:e.fetch}),a=function(o,l){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return s(o,l)};return a.languageModel=s,a.chat=s,a.messages=s,a.textEmbeddingModel=o=>{throw new Qs({modelId:o,modelType:"textEmbeddingModel"})},a.tools=kc,a}var Bm=qn();async function Ma(e,t){let r=qn({baseURL:t.apiBaseUrl,apiKey:t.apiKey});e.apiChat=r.chat(e.model?e.model:"claude-3-5-sonnet-20240620")}function Ve(e){if(Tc(e))return;if(typeof e=="boolean")return{type:"boolean",properties:{}};let{type:t,description:r,required:n,properties:s,items:a,allOf:o,anyOf:l,oneOf:u,format:c,const:p,minLength:d}=e,f={};return r&&(f.description=r),n&&(f.required=n),c&&(f.format=c),p!==void 0&&(f.enum=[p]),t&&(Array.isArray(t)?t.includes("null")?(f.type=t.filter(v=>v!=="null")[0],f.nullable=!0):f.type=t:t==="null"?f.type="null":f.type=t),s!=null&&(f.properties=Object.entries(s).reduce((v,[g,m])=>(v[g]=Ve(m),v),{})),a&&(f.items=Array.isArray(a)?a.map(Ve):Ve(a)),o&&(f.allOf=o.map(Ve)),l&&(f.anyOf=l.map(Ve)),u&&(f.oneOf=u.map(Ve)),d!==void 0&&(f.minLength=d),f}function Tc(e){return e!=null&&typeof e=="object"&&e.type==="object"&&(e.properties==null||Object.keys(e.properties).length===0)}function Sc(e){var t,r;let n=[],s=[],a=!0;for(let{role:o,content:l}of e)switch(o){case"system":{if(!a)throw new P({functionality:"system messages are only supported at the beginning of the conversation"});n.push({text:l});break}case"user":{a=!1;let u=[];for(let c of l)switch(c.type){case"text":{u.push({text:c.text});break}case"image":{u.push(c.image instanceof URL?{fileData:{mimeType:(t=c.mimeType)!=null?t:"image/jpeg",fileUri:c.image.toString()}}:{inlineData:{mimeType:(r=c.mimeType)!=null?r:"image/jpeg",data:Me(c.image)}});break}case"file":{u.push(c.data instanceof URL?{fileData:{mimeType:c.mimeType,fileUri:c.data.toString()}}:{inlineData:{mimeType:c.mimeType,data:c.data}});break}default:{let p=c;throw new P({functionality:`prompt part: ${p}`})}}s.push({role:"user",parts:u});break}case"assistant":{a=!1,s.push({role:"model",parts:l.map(u=>{switch(u.type){case"text":return u.text.length===0?void 0:{text:u.text};case"tool-call":return{functionCall:{name:u.toolName,args:u.args}}}}).filter(u=>u!==void 0)});break}case"tool":{a=!1,s.push({role:"user",parts:l.map(u=>({functionResponse:{name:u.toolName,response:{name:u.toolName,content:u.result}}}))});break}default:{let u=o;throw new Error(`Unsupported role: ${u}`)}}return{systemInstruction:n.length>0?{parts:n}:void 0,contents:s}}function Oa(e){return e.includes("/")?e:`models/${e}`}var Cc=i.object({error:i.object({code:i.number().nullable(),message:i.string(),status:i.string()})}),Ln=at({errorSchema:Cc,errorToMessage:e=>e.error.message});function Ic(e,t,r){var n,s;let a=(n=e.tools)!=null&&n.length?e.tools:void 0,o=[];if(t)return{tools:r?{googleSearch:{}}:{googleSearchRetrieval:{}},toolConfig:void 0,toolWarnings:o};if(a==null)return{tools:void 0,toolConfig:void 0,toolWarnings:o};let l=[];for(let p of a)p.type==="provider-defined"?o.push({type:"unsupported-tool",tool:p}):l.push({name:p.name,description:(s=p.description)!=null?s:"",parameters:Ve(p.parameters)});let u=e.toolChoice;if(u==null)return{tools:{functionDeclarations:l},toolConfig:void 0,toolWarnings:o};let c=u.type;switch(c){case"auto":return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:o};case"none":return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:o};case"required":return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:o};case"tool":return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[u.toolName]}},toolWarnings:o};default:{let p=c;throw new P({functionality:`Unsupported tool choice type: ${p}`})}}}function Da({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"RECITATION":case"SAFETY":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";default:return"unknown"}}var Ec=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!0}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:s,topK:a,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:p}){var d,f;let v=e.type,g=[];p!=null&&g.push({type:"unsupported-setting",setting:"seed"});let m={maxOutputTokens:r,temperature:n,topK:a,topP:s,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseMimeType:c?.type==="json"?"application/json":void 0,responseSchema:c?.type==="json"&&c.schema!=null&&this.supportsStructuredOutputs?Ve(c.schema):void 0,...this.settings.audioTimestamp&&{audioTimestamp:this.settings.audioTimestamp}},{contents:y,systemInstruction:b}=Sc(t);switch(v){case"regular":{let{tools:h,toolConfig:w,toolWarnings:_}=Ic(e,(d=this.settings.useSearchGrounding)!=null?d:!1,this.modelId.includes("gemini-2"));return{args:{generationConfig:m,contents:y,systemInstruction:b,safetySettings:this.settings.safetySettings,tools:h,toolConfig:w,cachedContent:this.settings.cachedContent},warnings:[...g,..._]}}case"object-json":return{args:{generationConfig:{...m,responseMimeType:"application/json",responseSchema:e.schema!=null&&this.supportsStructuredOutputs?Ve(e.schema):void 0},contents:y,systemInstruction:b,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:g};case"object-tool":return{args:{generationConfig:m,contents:y,tools:{functionDeclarations:[{name:e.tool.name,description:(f=e.tool.description)!=null?f:"",parameters:Ve(e.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:g};default:{let h=v;throw new Error(`Unsupported type: ${h}`)}}}supportsUrl(e){return e.toString().startsWith("https://generativelanguage.googleapis.com/v1beta/files/")}async doGenerate(e){var t,r,n,s,a,o,l,u;let{args:c,warnings:p}=await this.getArgs(e),d=JSON.stringify(c),f=ee(await _t(this.config.headers),e.headers),{responseHeaders:v,value:g}=await X({url:`${this.config.baseURL}/${Oa(this.modelId)}:generateContent`,headers:f,body:c,failedResponseHandler:Ln,successfulResponseHandler:ne(Ac),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:m,...y}=c,b=g.candidates[0],h=$a({parts:(r=(t=b.content)==null?void 0:t.parts)!=null?r:[],generateId:this.config.generateId}),w=g.usageMetadata;return{text:Ua((s=(n=b.content)==null?void 0:n.parts)!=null?s:[]),toolCalls:h,finishReason:Da({finishReason:b.finishReason,hasToolCalls:h!=null&&h.length>0}),usage:{promptTokens:(a=w?.promptTokenCount)!=null?a:NaN,completionTokens:(o=w?.candidatesTokenCount)!=null?o:NaN},rawCall:{rawPrompt:m,rawSettings:y},rawResponse:{headers:v},warnings:p,providerMetadata:{google:{groundingMetadata:(l=b.groundingMetadata)!=null?l:null,safetyRatings:(u=b.safetyRatings)!=null?u:null}},request:{body:d}}}async doStream(e){let{args:t,warnings:r}=await this.getArgs(e),n=JSON.stringify(t),s=ee(await _t(this.config.headers),e.headers),{responseHeaders:a,value:o}=await X({url:`${this.config.baseURL}/${Oa(this.modelId)}:streamGenerateContent?alt=sse`,headers:s,body:t,failedResponseHandler:Ln,successfulResponseHandler:Ee(Rc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:l,...u}=t,c="unknown",p={promptTokens:Number.NaN,completionTokens:Number.NaN},d,f=this.config.generateId,v=!1;return{stream:o.pipeThrough(new TransformStream({transform(g,m){var y,b,h,w,_;if(!g.success){m.enqueue({type:"error",error:g.error});return}let I=g.value,S=I.usageMetadata;S!=null&&(p={promptTokens:(y=S.promptTokenCount)!=null?y:NaN,completionTokens:(b=S.candidatesTokenCount)!=null?b:NaN});let j=(h=I.candidates)==null?void 0:h[0];if(j==null)return;j.finishReason!=null&&(c=Da({finishReason:j.finishReason,hasToolCalls:v}),d={google:{groundingMetadata:(w=j.groundingMetadata)!=null?w:null,safetyRatings:(_=j.safetyRatings)!=null?_:null}});let q=j.content;if(q==null)return;let U=Ua(q.parts);U!=null&&m.enqueue({type:"text-delta",textDelta:U});let W=$a({parts:q.parts,generateId:f});if(W!=null)for(let K of W)m.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:K.toolCallId,toolName:K.toolName,argsTextDelta:K.args}),m.enqueue({type:"tool-call",toolCallType:"function",toolCallId:K.toolCallId,toolName:K.toolName,args:K.args}),v=!0},flush(g){g.enqueue({type:"finish",finishReason:c,usage:p,providerMetadata:d})}})),rawCall:{rawPrompt:l,rawSettings:u},rawResponse:{headers:a},warnings:r,request:{body:n}}}};function $a({parts:e,generateId:t}){let r=e.filter(n=>"functionCall"in n);return r.length===0?void 0:r.map(n=>({toolCallType:"function",toolCallId:t(),toolName:n.functionCall.name,args:JSON.stringify(n.functionCall.args)}))}function Ua(e){let t=e.filter(r=>"text"in r);return t.length===0?void 0:t.map(r=>r.text).join("")}var qa=i.object({role:i.string(),parts:i.array(i.union([i.object({text:i.string()}),i.object({functionCall:i.object({name:i.string(),args:i.unknown()})})]))}),La=i.object({webSearchQueries:i.array(i.string()).nullish(),retrievalQueries:i.array(i.string()).nullish(),searchEntryPoint:i.object({renderedContent:i.string()}).nullish(),groundingChunks:i.array(i.object({web:i.object({uri:i.string(),title:i.string()}).nullish(),retrievedContext:i.object({uri:i.string(),title:i.string()}).nullish()})).nullish(),groundingSupports:i.array(i.object({segment:i.object({startIndex:i.number().nullish(),endIndex:i.number().nullish(),text:i.string().nullish()}),segment_text:i.string().nullish(),groundingChunkIndices:i.array(i.number()).nullish(),supportChunkIndices:i.array(i.number()).nullish(),confidenceScores:i.array(i.number()).nullish(),confidenceScore:i.array(i.number()).nullish()})).nullish(),retrievalMetadata:i.union([i.object({webDynamicRetrievalScore:i.number()}),i.object({})]).nullish()}),Fa=i.object({category:i.string(),probability:i.string(),probabilityScore:i.number().nullish(),severity:i.string().nullish(),severityScore:i.number().nullish(),blocked:i.boolean().nullish()}),Ac=i.object({candidates:i.array(i.object({content:qa.nullish(),finishReason:i.string().nullish(),safetyRatings:i.array(Fa).nullish(),groundingMetadata:La.nullish()})),usageMetadata:i.object({promptTokenCount:i.number().nullish(),candidatesTokenCount:i.number().nullish(),totalTokenCount:i.number().nullish()}).nullish()}),Rc=i.object({candidates:i.array(i.object({content:qa.nullish(),finishReason:i.string().nullish(),safetyRatings:i.array(Fa).nullish(),groundingMetadata:La.nullish()})).nullish(),usageMetadata:i.object({promptTokenCount:i.number().nullish(),candidatesTokenCount:i.number().nullish(),totalTokenCount:i.number().nullish()}).nullish()}),Pc=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Lt({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let n=ee(await _t(this.config.headers),t),{responseHeaders:s,value:a}=await X({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:n,body:{requests:e.map(o=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:o}]},outputDimensionality:this.settings.outputDimensionality}))},failedResponseHandler:Ln,successfulResponseHandler:ne(Nc),abortSignal:r,fetch:this.config.fetch});return{embeddings:a.embeddings.map(o=>o.values),usage:void 0,rawResponse:{headers:s}}}},Nc=i.object({embeddings:i.array(i.object({values:i.array(i.number())}))});function Fn(e={}){var t;let r=(t=Zt(e.baseURL))!=null?t:"https://generativelanguage.googleapis.com/v1beta",n=()=>({"x-goog-api-key":nt({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers}),s=(l,u={})=>{var c;return new Ec(l,u,{provider:"google.generative-ai",baseURL:r,headers:n,generateId:(c=e.generateId)!=null?c:ie,fetch:e.fetch})},a=(l,u={})=>new Pc(l,u,{provider:"google.generative-ai",baseURL:r,headers:n,fetch:e.fetch}),o=function(l,u){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return s(l,u)};return o.languageModel=s,o.chat=s,o.generativeAI=s,o.embedding=a,o.textEmbedding=a,o.textEmbeddingModel=a,o}var uf=Fn();async function Ja(e,t){let r=Fn({baseURL:t.apiBaseUrl,apiKey:t.apiKey}),n=e.model?e.model:"gemini-1.5-flash-latest";e.apiChat=r(n),t.searchGrounding&&(e.apiChat=r(n,{useSearchGrounding:t.searchGrounding}))}var un=class{constructor({apiKey:t,apiBaseUrl:r,maxTokens:n,temperature:s,topP:a,organization:o,systemPrompt:l,searchGrounding:u}){this.apiKey=t,this.apiBaseUrl=r,this.maxTokens=n,this.temperature=s,this.topP=a,this.organization=o,this.systemPrompt=l,this.searchGrounding=u??!1}};function jc({prompt:e,useLegacyFunctionCalling:t=!1}){let r=[];for(let{role:n,content:s}of e)switch(n){case"system":{r.push({role:"system",content:s});break}case"user":{if(s.length===1&&s[0].type==="text"){r.push({role:"user",content:s[0].text});break}r.push({role:"user",content:s.map(a=>{var o,l,u;switch(a.type){case"text":return{type:"text",text:a.text};case"image":return{type:"image_url",image_url:{url:a.image instanceof URL?a.image.toString():`data:${(o=a.mimeType)!=null?o:"image/jpeg"};base64,${Me(a.image)}`,detail:(u=(l=a.providerMetadata)==null?void 0:l.openai)==null?void 0:u.imageDetail}};case"file":{if(a.data instanceof URL)throw new P({functionality:"'File content parts with URL data' functionality not supported."});switch(a.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:a.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:a.data,format:"mp3"}};default:throw new P({functionality:`File content part type ${a.mimeType} in user messages`})}}}})});break}case"assistant":{let a="",o=[];for(let l of s)switch(l.type){case"text":{a+=l.text;break}case"tool-call":{o.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)}});break}default:{let u=l;throw new Error(`Unsupported part: ${u}`)}}if(t){if(o.length>1)throw new P({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:a,function_call:o.length>0?o[0].function:void 0})}else r.push({role:"assistant",content:a,tool_calls:o.length>0?o:void 0});break}case"tool":{for(let a of s)t?r.push({role:"function",name:a.toolName,content:JSON.stringify(a.result)}):r.push({role:"tool",tool_call_id:a.toolCallId,content:JSON.stringify(a.result)});break}default:{let a=n;throw new Error(`Unsupported role: ${a}`)}}return r}function Va(e){var t,r;return(r=(t=e?.content)==null?void 0:t.map(({token:n,logprob:s,top_logprobs:a})=>({token:n,logprob:s,topLogprobs:a?a.map(({token:o,logprob:l})=>({token:o,logprob:l})):[]})))!=null?r:void 0}function cn(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Jn=i.object({error:i.object({message:i.string(),type:i.string().nullish(),param:i.any().nullish(),code:i.union([i.string(),i.number()]).nullish()})}),wr=at({errorSchema:Jn,errorToMessage:e=>e.error.message});function pn({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function Mc({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r}){var n;let s=(n=e.tools)!=null&&n.length?e.tools:void 0,a=[];if(s==null)return{tools:void 0,tool_choice:void 0,toolWarnings:a};let o=e.toolChoice;if(t){let c=[];for(let d of s)d.type==="provider-defined"?a.push({type:"unsupported-tool",tool:d}):c.push({name:d.name,description:d.description,parameters:d.parameters});if(o==null)return{functions:c,function_call:void 0,toolWarnings:a};switch(o.type){case"auto":case"none":case void 0:return{functions:c,function_call:void 0,toolWarnings:a};case"required":throw new P({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:c,function_call:{name:o.toolName},toolWarnings:a}}}let l=[];for(let c of s)c.type==="provider-defined"?a.push({type:"unsupported-tool",tool:c}):l.push({type:"function",function:{name:c.name,description:c.description,parameters:c.parameters,strict:r?!0:void 0}});if(o==null)return{tools:l,tool_choice:void 0,toolWarnings:a};let u=o.type;switch(u){case"auto":case"none":case"required":return{tools:l,tool_choice:u,toolWarnings:a};case"tool":return{tools:l,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:a};default:{let c=u;throw new P({functionality:`Unsupported tool choice type: ${c}`})}}}var za=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!1}get defaultObjectGenerationMode(){return Uc(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:s,topK:a,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:p,providerMetadata:d}){var f,v,g,m,y,b,h,w;let _=e.type,I=[];a!=null&&I.push({type:"unsupported-setting",setting:"topK"}),c?.type==="json"&&c.schema!=null&&!this.supportsStructuredOutputs&&I.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let S=this.settings.useLegacyFunctionCalling;if(S&&this.settings.parallelToolCalls===!0)throw new P({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(S&&this.supportsStructuredOutputs)throw new P({functionality:"structuredOutputs with useLegacyFunctionCalling"});let j={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:n,top_p:s,frequency_penalty:o,presence_penalty:l,response_format:c?.type==="json"?this.supportsStructuredOutputs&&c.schema!=null?{type:"json_schema",json_schema:{schema:c.schema,strict:!0,name:(f=c.name)!=null?f:"response",description:c.description}}:{type:"json_object"}:void 0,stop:u,seed:p,max_completion_tokens:(v=d?.openai)==null?void 0:v.maxCompletionTokens,store:(g=d?.openai)==null?void 0:g.store,metadata:(m=d?.openai)==null?void 0:m.metadata,prediction:(y=d?.openai)==null?void 0:y.prediction,reasoning_effort:(h=(b=d?.openai)==null?void 0:b.reasoningEffort)!=null?h:this.settings.reasoningEffort,messages:jc({prompt:t,useLegacyFunctionCalling:S})};switch($c(this.modelId)&&(j.temperature=void 0,j.top_p=void 0,j.frequency_penalty=void 0,j.presence_penalty=void 0),_){case"regular":{let{tools:q,tool_choice:U,functions:W,function_call:K,toolWarnings:Q}=Mc({mode:e,useLegacyFunctionCalling:S,structuredOutputs:this.supportsStructuredOutputs});return{args:{...j,tools:q,tool_choice:U,functions:W,function_call:K},warnings:[...I,...Q]}}case"object-json":return{args:{...j,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(w=e.name)!=null?w:"response",description:e.description}}:{type:"json_object"}},warnings:I};case"object-tool":return{args:S?{...j,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...j,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:I};default:{let q=_;throw new Error(`Unsupported type: ${q}`)}}}async doGenerate(e){var t,r,n,s,a,o,l,u,c,p,d,f,v,g,m,y,b,h;let{args:w,warnings:_}=this.getArgs(e),{responseHeaders:I,value:S}=await X({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:w,failedResponseHandler:wr,successfulResponseHandler:ne(Oc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:j,...q}=w,U=S.choices[0],W;return(((r=(t=S.usage)==null?void 0:t.completion_tokens_details)==null?void 0:r.reasoning_tokens)!=null||((s=(n=S.usage)==null?void 0:n.prompt_tokens_details)==null?void 0:s.cached_tokens)!=null)&&(W={openai:{}},((o=(a=S.usage)==null?void 0:a.completion_tokens_details)==null?void 0:o.reasoning_tokens)!=null&&(W.openai.reasoningTokens=(u=(l=S.usage)==null?void 0:l.completion_tokens_details)==null?void 0:u.reasoning_tokens),((p=(c=S.usage)==null?void 0:c.prompt_tokens_details)==null?void 0:p.cached_tokens)!=null&&(W.openai.cachedPromptTokens=(f=(d=S.usage)==null?void 0:d.prompt_tokens_details)==null?void 0:f.cached_tokens)),{text:(v=U.message.content)!=null?v:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&U.message.function_call?[{toolCallType:"function",toolCallId:ie(),toolName:U.message.function_call.name,args:U.message.function_call.arguments}]:(g=U.message.tool_calls)==null?void 0:g.map(K=>{var Q;return{toolCallType:"function",toolCallId:(Q=K.id)!=null?Q:ie(),toolName:K.function.name,args:K.function.arguments}}),finishReason:cn(U.finish_reason),usage:{promptTokens:(y=(m=S.usage)==null?void 0:m.prompt_tokens)!=null?y:NaN,completionTokens:(h=(b=S.usage)==null?void 0:b.completion_tokens)!=null?h:NaN},rawCall:{rawPrompt:j,rawSettings:q},rawResponse:{headers:I},request:{body:JSON.stringify(w)},response:pn(S),warnings:_,logprobs:Va(U.logprobs),providerMetadata:W}}async doStream(e){if(this.settings.simulateStreaming){let m=await this.doGenerate(e);return{stream:new ReadableStream({start(b){if(b.enqueue({type:"response-metadata",...m.response}),m.text&&b.enqueue({type:"text-delta",textDelta:m.text}),m.toolCalls)for(let h of m.toolCalls)b.enqueue({type:"tool-call",...h});b.enqueue({type:"finish",finishReason:m.finishReason,usage:m.usage,logprobs:m.logprobs,providerMetadata:m.providerMetadata}),b.close()}}),rawCall:m.rawCall,rawResponse:m.rawResponse,warnings:m.warnings}}let{args:t,warnings:r}=this.getArgs(e),n={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await X({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:n,failedResponseHandler:wr,successfulResponseHandler:Ee(Dc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...l}=t,u=[],c="unknown",p={promptTokens:void 0,completionTokens:void 0},d,f=!0,{useLegacyFunctionCalling:v}=this.settings,g;return{stream:a.pipeThrough(new TransformStream({transform(m,y){var b,h,w,_,I,S,j,q,U,W,K,Q,le,ge;if(!m.success){c="error",y.enqueue({type:"error",error:m.error});return}let te=m.value;if("error"in te){c="error",y.enqueue({type:"error",error:te.error});return}if(f&&(f=!1,y.enqueue({type:"response-metadata",...pn(te)})),te.usage!=null){p={promptTokens:(b=te.usage.prompt_tokens)!=null?b:void 0,completionTokens:(h=te.usage.completion_tokens)!=null?h:void 0};let{completion_tokens_details:R,prompt_tokens_details:B}=te.usage;(R?.reasoning_tokens!=null||B?.cached_tokens!=null)&&(g={openai:{}},R?.reasoning_tokens!=null&&(g.openai.reasoningTokens=R?.reasoning_tokens),B?.cached_tokens!=null&&(g.openai.cachedPromptTokens=B?.cached_tokens))}let re=te.choices[0];if(re?.finish_reason!=null&&(c=cn(re.finish_reason)),re?.delta==null)return;let ae=re.delta;ae.content!=null&&y.enqueue({type:"text-delta",textDelta:ae.content});let Ce=Va(re?.logprobs);Ce?.length&&(d===void 0&&(d=[]),d.push(...Ce));let L=v&&ae.function_call!=null?[{type:"function",id:ie(),function:ae.function_call,index:0}]:ae.tool_calls;if(L!=null)for(let R of L){let B=R.index;if(u[B]==null){if(R.type!=="function")throw new rt({data:R,message:"Expected 'function' type."});if(R.id==null)throw new rt({data:R,message:"Expected 'id' to be a string."});if(((w=R.function)==null?void 0:w.name)==null)throw new rt({data:R,message:"Expected 'function.name' to be a string."});u[B]={id:R.id,type:"function",function:{name:R.function.name,arguments:(_=R.function.arguments)!=null?_:""},hasFinished:!1};let z=u[B];((I=z.function)==null?void 0:I.name)!=null&&((S=z.function)==null?void 0:S.arguments)!=null&&(z.function.arguments.length>0&&y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:z.id,toolName:z.function.name,argsTextDelta:z.function.arguments}),Vt(z.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(j=z.id)!=null?j:ie(),toolName:z.function.name,args:z.function.arguments}),z.hasFinished=!0));continue}let H=u[B];H.hasFinished||(((q=R.function)==null?void 0:q.arguments)!=null&&(H.function.arguments+=(W=(U=R.function)==null?void 0:U.arguments)!=null?W:""),y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:H.id,toolName:H.function.name,argsTextDelta:(K=R.function.arguments)!=null?K:""}),((Q=H.function)==null?void 0:Q.name)!=null&&((le=H.function)==null?void 0:le.arguments)!=null&&Vt(H.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ge=H.id)!=null?ge:ie(),toolName:H.function.name,args:H.function.arguments}),H.hasFinished=!0))}},flush(m){var y,b;m.enqueue({type:"finish",finishReason:c,logprobs:d,usage:{promptTokens:(y=p.promptTokens)!=null?y:NaN,completionTokens:(b=p.completionTokens)!=null?b:NaN},...g!=null?{providerMetadata:g}:{}})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:s},request:{body:JSON.stringify(n)},warnings:r}}},Ba=i.object({prompt_tokens:i.number().nullish(),completion_tokens:i.number().nullish(),prompt_tokens_details:i.object({cached_tokens:i.number().nullish()}).nullish(),completion_tokens_details:i.object({reasoning_tokens:i.number().nullish()}).nullish()}).nullish(),Oc=i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({message:i.object({role:i.literal("assistant").nullish(),content:i.string().nullish(),function_call:i.object({arguments:i.string(),name:i.string()}).nullish(),tool_calls:i.array(i.object({id:i.string().nullish(),type:i.literal("function"),function:i.object({name:i.string(),arguments:i.string()})})).nullish()}),index:i.number(),logprobs:i.object({content:i.array(i.object({token:i.string(),logprob:i.number(),top_logprobs:i.array(i.object({token:i.string(),logprob:i.number()}))})).nullable()}).nullish(),finish_reason:i.string().nullish()})),usage:Ba}),Dc=i.union([i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({delta:i.object({role:i.enum(["assistant"]).nullish(),content:i.string().nullish(),function_call:i.object({name:i.string().optional(),arguments:i.string().optional()}).nullish(),tool_calls:i.array(i.object({index:i.number(),id:i.string().nullish(),type:i.literal("function").optional(),function:i.object({name:i.string().nullish(),arguments:i.string().nullish()})})).nullish()}).nullish(),logprobs:i.object({content:i.array(i.object({token:i.string(),logprob:i.number(),top_logprobs:i.array(i.object({token:i.string(),logprob:i.number()}))})).nullable()}).nullish(),finish_reason:i.string().nullable().optional(),index:i.number()})),usage:Ba}),Jn]);function $c(e){return e==="o1"||e.startsWith("o1-")}function Uc(e){return e.startsWith("gpt-4o-audio-preview")}function qc({prompt:e,inputFormat:t,user:r="user",assistant:n="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let s="";e[0].role==="system"&&(s+=`${e[0].content}

`,e=e.slice(1));for(let{role:a,content:o}of e)switch(a){case"system":throw new je({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let l=o.map(u=>{switch(u.type){case"text":return u.text;case"image":throw new P({functionality:"images"})}}).join("");s+=`${r}:
${l}

`;break}case"assistant":{let l=o.map(u=>{switch(u.type){case"text":return u.text;case"tool-call":throw new P({functionality:"tool-call messages"})}}).join("");s+=`${n}:
${l}

`;break}case"tool":throw new P({functionality:"tool messages"});default:{let l=a;throw new Error(`Unsupported role: ${l}`)}}return s+=`${n}:
`,{prompt:s,stopSequences:[`
${r}:`]}}function Za(e){return e?.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([n,s])=>({token:n,logprob:s})):[]}))}var Ha=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:n,temperature:s,topP:a,topK:o,frequencyPenalty:l,presencePenalty:u,stopSequences:c,responseFormat:p,seed:d}){var f;let v=e.type,g=[];o!=null&&g.push({type:"unsupported-setting",setting:"topK"}),p!=null&&p.type!=="text"&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:m,stopSequences:y}=qc({prompt:r,inputFormat:t}),b=[...y??[],...c??[]],h={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:s,top_p:a,frequency_penalty:l,presence_penalty:u,seed:d,prompt:m,stop:b.length>0?b:void 0};switch(v){case"regular":{if((f=e.tools)!=null&&f.length)throw new P({functionality:"tools"});if(e.toolChoice)throw new P({functionality:"toolChoice"});return{args:h,warnings:g}}case"object-json":throw new P({functionality:"object-json mode"});case"object-tool":throw new P({functionality:"object-tool mode"});default:{let w=v;throw new Error(`Unsupported type: ${w}`)}}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:n,value:s}=await X({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:t,failedResponseHandler:wr,successfulResponseHandler:ne(Lc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...o}=t,l=s.choices[0];return{text:l.text,usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},finishReason:cn(l.finish_reason),logprobs:Za(l.logprobs),rawCall:{rawPrompt:a,rawSettings:o},rawResponse:{headers:n},response:pn(s),warnings:r,request:{body:JSON.stringify(t)}}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),n={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await X({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:n,failedResponseHandler:wr,successfulResponseHandler:Ee(Fc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...l}=t,u="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},p,d=!0;return{stream:a.pipeThrough(new TransformStream({transform(f,v){if(!f.success){u="error",v.enqueue({type:"error",error:f.error});return}let g=f.value;if("error"in g){u="error",v.enqueue({type:"error",error:g.error});return}d&&(d=!1,v.enqueue({type:"response-metadata",...pn(g)})),g.usage!=null&&(c={promptTokens:g.usage.prompt_tokens,completionTokens:g.usage.completion_tokens});let m=g.choices[0];m?.finish_reason!=null&&(u=cn(m.finish_reason)),m?.text!=null&&v.enqueue({type:"text-delta",textDelta:m.text});let y=Za(m?.logprobs);y?.length&&(p===void 0&&(p=[]),p.push(...y))},flush(f){f.enqueue({type:"finish",finishReason:u,logprobs:p,usage:c})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:s},warnings:r,request:{body:JSON.stringify(n)}}}},Lc=i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({text:i.string(),finish_reason:i.string(),logprobs:i.object({tokens:i.array(i.string()),token_logprobs:i.array(i.number()),top_logprobs:i.array(i.record(i.string(),i.number())).nullable()}).nullish()})),usage:i.object({prompt_tokens:i.number(),completion_tokens:i.number()})}),Fc=i.union([i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({text:i.string(),finish_reason:i.string().nullish(),index:i.number(),logprobs:i.object({tokens:i.array(i.string()),token_logprobs:i.array(i.number()),top_logprobs:i.array(i.record(i.string(),i.number())).nullable()}).nullish()})),usage:i.object({prompt_tokens:i.number(),completion_tokens:i.number()}).nullish()}),Jn]),Ga=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!0}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Lt({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:n,value:s}=await X({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:ee(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:wr,successfulResponseHandler:ne(Jc),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.data.map(a=>a.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:n}}}},Jc=i.object({data:i.array(i.object({embedding:i.array(i.number())})),usage:i.object({prompt_tokens:i.number()}).nullish()});function xr(e={}){var t;let r=()=>({"api-key":nt({apiKey:e.apiKey,environmentVariableName:"AZURE_API_KEY",description:"Azure OpenAI"}),...e.headers}),n=()=>va({settingValue:e.resourceName,settingName:"resourceName",environmentVariableName:"AZURE_RESOURCE_NAME",description:"Azure OpenAI resource name"}),s=(t=e.apiVersion)!=null?t:"2024-10-01-preview",a=({path:p,modelId:d})=>e.baseURL?`${e.baseURL}/${d}${p}?api-version=${s}`:`https://${n()}.openai.azure.com/openai/deployments/${d}${p}?api-version=${s}`,o=(p,d={})=>new za(p,d,{provider:"azure-openai.chat",url:a,headers:r,compatibility:"strict",fetch:e.fetch}),l=(p,d={})=>new Ha(p,d,{provider:"azure-openai.completion",url:a,compatibility:"strict",headers:r,fetch:e.fetch}),u=(p,d={})=>new Ga(p,d,{provider:"azure-openai.embeddings",headers:r,url:a,fetch:e.fetch}),c=function(p,d){if(new.target)throw new Error("The Azure OpenAI model function cannot be called with the new keyword.");return o(p,d)};return c.languageModel=o,c.chat=o,c.completion=l,c.embedding=u,c.textEmbedding=u,c.textEmbeddingModel=u,c}var $f=xr();function Vc({prompt:e,useLegacyFunctionCalling:t=!1}){let r=[];for(let{role:n,content:s}of e)switch(n){case"system":{r.push({role:"system",content:s});break}case"user":{if(s.length===1&&s[0].type==="text"){r.push({role:"user",content:s[0].text});break}r.push({role:"user",content:s.map(a=>{var o,l,u;switch(a.type){case"text":return{type:"text",text:a.text};case"image":return{type:"image_url",image_url:{url:a.image instanceof URL?a.image.toString():`data:${(o=a.mimeType)!=null?o:"image/jpeg"};base64,${Me(a.image)}`,detail:(u=(l=a.providerMetadata)==null?void 0:l.openai)==null?void 0:u.imageDetail}};case"file":{if(a.data instanceof URL)throw new P({functionality:"'File content parts with URL data' functionality not supported."});switch(a.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:a.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:a.data,format:"mp3"}};default:throw new P({functionality:`File content part type ${a.mimeType} in user messages`})}}}})});break}case"assistant":{let a="",o=[];for(let l of s)switch(l.type){case"text":{a+=l.text;break}case"tool-call":{o.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.args)}});break}default:{let u=l;throw new Error(`Unsupported part: ${u}`)}}if(t){if(o.length>1)throw new P({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});r.push({role:"assistant",content:a,function_call:o.length>0?o[0].function:void 0})}else r.push({role:"assistant",content:a,tool_calls:o.length>0?o:void 0});break}case"tool":{for(let a of s)t?r.push({role:"function",name:a.toolName,content:JSON.stringify(a.result)}):r.push({role:"tool",tool_call_id:a.toolCallId,content:JSON.stringify(a.result)});break}default:{let a=n;throw new Error(`Unsupported role: ${a}`)}}return r}function Wa(e){var t,r;return(r=(t=e?.content)==null?void 0:t.map(({token:n,logprob:s,top_logprobs:a})=>({token:n,logprob:s,topLogprobs:a?a.map(({token:o,logprob:l})=>({token:o,logprob:l})):[]})))!=null?r:void 0}function dn(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Vn=i.object({error:i.object({message:i.string(),type:i.string().nullish(),param:i.any().nullish(),code:i.union([i.string(),i.number()]).nullish()})}),Qt=at({errorSchema:Vn,errorToMessage:e=>e.error.message});function mn({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function Zc({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r}){var n;let s=(n=e.tools)!=null&&n.length?e.tools:void 0,a=[];if(s==null)return{tools:void 0,tool_choice:void 0,toolWarnings:a};let o=e.toolChoice;if(t){let c=[];for(let d of s)d.type==="provider-defined"?a.push({type:"unsupported-tool",tool:d}):c.push({name:d.name,description:d.description,parameters:d.parameters});if(o==null)return{functions:c,function_call:void 0,toolWarnings:a};switch(o.type){case"auto":case"none":case void 0:return{functions:c,function_call:void 0,toolWarnings:a};case"required":throw new P({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:c,function_call:{name:o.toolName},toolWarnings:a}}}let l=[];for(let c of s)c.type==="provider-defined"?a.push({type:"unsupported-tool",tool:c}):l.push({type:"function",function:{name:c.name,description:c.description,parameters:c.parameters,strict:r?!0:void 0}});if(o==null)return{tools:l,tool_choice:void 0,toolWarnings:a};let u=o.type;switch(u){case"auto":case"none":case"required":return{tools:l,tool_choice:u,toolWarnings:a};case"tool":return{tools:l,tool_choice:{type:"function",function:{name:o.toolName}},toolWarnings:a};default:{let c=u;throw new P({functionality:`Unsupported tool choice type: ${c}`})}}}var zc=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:!1}get defaultObjectGenerationMode(){return Wc(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:s,topK:a,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:p,providerMetadata:d}){var f,v,g,m,y,b,h,w;let _=e.type,I=[];a!=null&&I.push({type:"unsupported-setting",setting:"topK"}),c?.type==="json"&&c.schema!=null&&!this.supportsStructuredOutputs&&I.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let S=this.settings.useLegacyFunctionCalling;if(S&&this.settings.parallelToolCalls===!0)throw new P({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(S&&this.supportsStructuredOutputs)throw new P({functionality:"structuredOutputs with useLegacyFunctionCalling"});let j={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:n,top_p:s,frequency_penalty:o,presence_penalty:l,response_format:c?.type==="json"?this.supportsStructuredOutputs&&c.schema!=null?{type:"json_schema",json_schema:{schema:c.schema,strict:!0,name:(f=c.name)!=null?f:"response",description:c.description}}:{type:"json_object"}:void 0,stop:u,seed:p,max_completion_tokens:(v=d?.openai)==null?void 0:v.maxCompletionTokens,store:(g=d?.openai)==null?void 0:g.store,metadata:(m=d?.openai)==null?void 0:m.metadata,prediction:(y=d?.openai)==null?void 0:y.prediction,reasoning_effort:(h=(b=d?.openai)==null?void 0:b.reasoningEffort)!=null?h:this.settings.reasoningEffort,messages:Vc({prompt:t,useLegacyFunctionCalling:S})};switch(Gc(this.modelId)&&(j.temperature=void 0,j.top_p=void 0,j.frequency_penalty=void 0,j.presence_penalty=void 0),_){case"regular":{let{tools:q,tool_choice:U,functions:W,function_call:K,toolWarnings:Q}=Zc({mode:e,useLegacyFunctionCalling:S,structuredOutputs:this.supportsStructuredOutputs});return{args:{...j,tools:q,tool_choice:U,functions:W,function_call:K},warnings:[...I,...Q]}}case"object-json":return{args:{...j,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(w=e.name)!=null?w:"response",description:e.description}}:{type:"json_object"}},warnings:I};case"object-tool":return{args:S?{...j,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...j,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:I};default:{let q=_;throw new Error(`Unsupported type: ${q}`)}}}async doGenerate(e){var t,r,n,s,a,o,l,u,c,p,d,f,v,g,m,y,b,h;let{args:w,warnings:_}=this.getArgs(e),{responseHeaders:I,value:S}=await X({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:w,failedResponseHandler:Qt,successfulResponseHandler:ne(Bc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:j,...q}=w,U=S.choices[0],W;return(((r=(t=S.usage)==null?void 0:t.completion_tokens_details)==null?void 0:r.reasoning_tokens)!=null||((s=(n=S.usage)==null?void 0:n.prompt_tokens_details)==null?void 0:s.cached_tokens)!=null)&&(W={openai:{}},((o=(a=S.usage)==null?void 0:a.completion_tokens_details)==null?void 0:o.reasoning_tokens)!=null&&(W.openai.reasoningTokens=(u=(l=S.usage)==null?void 0:l.completion_tokens_details)==null?void 0:u.reasoning_tokens),((p=(c=S.usage)==null?void 0:c.prompt_tokens_details)==null?void 0:p.cached_tokens)!=null&&(W.openai.cachedPromptTokens=(f=(d=S.usage)==null?void 0:d.prompt_tokens_details)==null?void 0:f.cached_tokens)),{text:(v=U.message.content)!=null?v:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&U.message.function_call?[{toolCallType:"function",toolCallId:ie(),toolName:U.message.function_call.name,args:U.message.function_call.arguments}]:(g=U.message.tool_calls)==null?void 0:g.map(K=>{var Q;return{toolCallType:"function",toolCallId:(Q=K.id)!=null?Q:ie(),toolName:K.function.name,args:K.function.arguments}}),finishReason:dn(U.finish_reason),usage:{promptTokens:(y=(m=S.usage)==null?void 0:m.prompt_tokens)!=null?y:NaN,completionTokens:(h=(b=S.usage)==null?void 0:b.completion_tokens)!=null?h:NaN},rawCall:{rawPrompt:j,rawSettings:q},rawResponse:{headers:I},request:{body:JSON.stringify(w)},response:mn(S),warnings:_,logprobs:Wa(U.logprobs),providerMetadata:W}}async doStream(e){if(this.settings.simulateStreaming){let m=await this.doGenerate(e);return{stream:new ReadableStream({start(b){if(b.enqueue({type:"response-metadata",...m.response}),m.text&&b.enqueue({type:"text-delta",textDelta:m.text}),m.toolCalls)for(let h of m.toolCalls)b.enqueue({type:"tool-call",...h});b.enqueue({type:"finish",finishReason:m.finishReason,usage:m.usage,logprobs:m.logprobs,providerMetadata:m.providerMetadata}),b.close()}}),rawCall:m.rawCall,rawResponse:m.rawResponse,warnings:m.warnings}}let{args:t,warnings:r}=this.getArgs(e),n={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await X({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:n,failedResponseHandler:Qt,successfulResponseHandler:Ee(Hc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...l}=t,u=[],c="unknown",p={promptTokens:void 0,completionTokens:void 0},d,f=!0,{useLegacyFunctionCalling:v}=this.settings,g;return{stream:a.pipeThrough(new TransformStream({transform(m,y){var b,h,w,_,I,S,j,q,U,W,K,Q,le,ge;if(!m.success){c="error",y.enqueue({type:"error",error:m.error});return}let te=m.value;if("error"in te){c="error",y.enqueue({type:"error",error:te.error});return}if(f&&(f=!1,y.enqueue({type:"response-metadata",...mn(te)})),te.usage!=null){p={promptTokens:(b=te.usage.prompt_tokens)!=null?b:void 0,completionTokens:(h=te.usage.completion_tokens)!=null?h:void 0};let{completion_tokens_details:R,prompt_tokens_details:B}=te.usage;(R?.reasoning_tokens!=null||B?.cached_tokens!=null)&&(g={openai:{}},R?.reasoning_tokens!=null&&(g.openai.reasoningTokens=R?.reasoning_tokens),B?.cached_tokens!=null&&(g.openai.cachedPromptTokens=B?.cached_tokens))}let re=te.choices[0];if(re?.finish_reason!=null&&(c=dn(re.finish_reason)),re?.delta==null)return;let ae=re.delta;ae.content!=null&&y.enqueue({type:"text-delta",textDelta:ae.content});let Ce=Wa(re?.logprobs);Ce?.length&&(d===void 0&&(d=[]),d.push(...Ce));let L=v&&ae.function_call!=null?[{type:"function",id:ie(),function:ae.function_call,index:0}]:ae.tool_calls;if(L!=null)for(let R of L){let B=R.index;if(u[B]==null){if(R.type!=="function")throw new rt({data:R,message:"Expected 'function' type."});if(R.id==null)throw new rt({data:R,message:"Expected 'id' to be a string."});if(((w=R.function)==null?void 0:w.name)==null)throw new rt({data:R,message:"Expected 'function.name' to be a string."});u[B]={id:R.id,type:"function",function:{name:R.function.name,arguments:(_=R.function.arguments)!=null?_:""},hasFinished:!1};let z=u[B];((I=z.function)==null?void 0:I.name)!=null&&((S=z.function)==null?void 0:S.arguments)!=null&&(z.function.arguments.length>0&&y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:z.id,toolName:z.function.name,argsTextDelta:z.function.arguments}),Vt(z.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(j=z.id)!=null?j:ie(),toolName:z.function.name,args:z.function.arguments}),z.hasFinished=!0));continue}let H=u[B];H.hasFinished||(((q=R.function)==null?void 0:q.arguments)!=null&&(H.function.arguments+=(W=(U=R.function)==null?void 0:U.arguments)!=null?W:""),y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:H.id,toolName:H.function.name,argsTextDelta:(K=R.function.arguments)!=null?K:""}),((Q=H.function)==null?void 0:Q.name)!=null&&((le=H.function)==null?void 0:le.arguments)!=null&&Vt(H.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(ge=H.id)!=null?ge:ie(),toolName:H.function.name,args:H.function.arguments}),H.hasFinished=!0))}},flush(m){var y,b;m.enqueue({type:"finish",finishReason:c,logprobs:d,usage:{promptTokens:(y=p.promptTokens)!=null?y:NaN,completionTokens:(b=p.completionTokens)!=null?b:NaN},...g!=null?{providerMetadata:g}:{}})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:s},request:{body:JSON.stringify(n)},warnings:r}}},Ya=i.object({prompt_tokens:i.number().nullish(),completion_tokens:i.number().nullish(),prompt_tokens_details:i.object({cached_tokens:i.number().nullish()}).nullish(),completion_tokens_details:i.object({reasoning_tokens:i.number().nullish()}).nullish()}).nullish(),Bc=i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({message:i.object({role:i.literal("assistant").nullish(),content:i.string().nullish(),function_call:i.object({arguments:i.string(),name:i.string()}).nullish(),tool_calls:i.array(i.object({id:i.string().nullish(),type:i.literal("function"),function:i.object({name:i.string(),arguments:i.string()})})).nullish()}),index:i.number(),logprobs:i.object({content:i.array(i.object({token:i.string(),logprob:i.number(),top_logprobs:i.array(i.object({token:i.string(),logprob:i.number()}))})).nullable()}).nullish(),finish_reason:i.string().nullish()})),usage:Ya}),Hc=i.union([i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({delta:i.object({role:i.enum(["assistant"]).nullish(),content:i.string().nullish(),function_call:i.object({name:i.string().optional(),arguments:i.string().optional()}).nullish(),tool_calls:i.array(i.object({index:i.number(),id:i.string().nullish(),type:i.literal("function").optional(),function:i.object({name:i.string().nullish(),arguments:i.string().nullish()})})).nullish()}).nullish(),logprobs:i.object({content:i.array(i.object({token:i.string(),logprob:i.number(),top_logprobs:i.array(i.object({token:i.string(),logprob:i.number()}))})).nullable()}).nullish(),finish_reason:i.string().nullable().optional(),index:i.number()})),usage:Ya}),Vn]);function Gc(e){return e==="o1"||e.startsWith("o1-")}function Wc(e){return e.startsWith("gpt-4o-audio-preview")}function Kc({prompt:e,inputFormat:t,user:r="user",assistant:n="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let s="";e[0].role==="system"&&(s+=`${e[0].content}

`,e=e.slice(1));for(let{role:a,content:o}of e)switch(a){case"system":throw new je({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let l=o.map(u=>{switch(u.type){case"text":return u.text;case"image":throw new P({functionality:"images"})}}).join("");s+=`${r}:
${l}

`;break}case"assistant":{let l=o.map(u=>{switch(u.type){case"text":return u.text;case"tool-call":throw new P({functionality:"tool-call messages"})}}).join("");s+=`${n}:
${l}

`;break}case"tool":throw new P({functionality:"tool messages"});default:{let l=a;throw new Error(`Unsupported role: ${l}`)}}return s+=`${n}:
`,{prompt:s,stopSequences:[`
${r}:`]}}function Ka(e){return e?.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([n,s])=>({token:n,logprob:s})):[]}))}var Yc=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:n,temperature:s,topP:a,topK:o,frequencyPenalty:l,presencePenalty:u,stopSequences:c,responseFormat:p,seed:d}){var f;let v=e.type,g=[];o!=null&&g.push({type:"unsupported-setting",setting:"topK"}),p!=null&&p.type!=="text"&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:m,stopSequences:y}=Kc({prompt:r,inputFormat:t}),b=[...y??[],...c??[]],h={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:s,top_p:a,frequency_penalty:l,presence_penalty:u,seed:d,prompt:m,stop:b.length>0?b:void 0};switch(v){case"regular":{if((f=e.tools)!=null&&f.length)throw new P({functionality:"tools"});if(e.toolChoice)throw new P({functionality:"toolChoice"});return{args:h,warnings:g}}case"object-json":throw new P({functionality:"object-json mode"});case"object-tool":throw new P({functionality:"object-tool mode"});default:{let w=v;throw new Error(`Unsupported type: ${w}`)}}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:n,value:s}=await X({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:t,failedResponseHandler:Qt,successfulResponseHandler:ne(Xc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...o}=t,l=s.choices[0];return{text:l.text,usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},finishReason:dn(l.finish_reason),logprobs:Ka(l.logprobs),rawCall:{rawPrompt:a,rawSettings:o},rawResponse:{headers:n},response:mn(s),warnings:r,request:{body:JSON.stringify(t)}}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),n={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:a}=await X({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ee(this.config.headers(),e.headers),body:n,failedResponseHandler:Qt,successfulResponseHandler:Ee(Qc),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...l}=t,u="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},p,d=!0;return{stream:a.pipeThrough(new TransformStream({transform(f,v){if(!f.success){u="error",v.enqueue({type:"error",error:f.error});return}let g=f.value;if("error"in g){u="error",v.enqueue({type:"error",error:g.error});return}d&&(d=!1,v.enqueue({type:"response-metadata",...mn(g)})),g.usage!=null&&(c={promptTokens:g.usage.prompt_tokens,completionTokens:g.usage.completion_tokens});let m=g.choices[0];m?.finish_reason!=null&&(u=dn(m.finish_reason)),m?.text!=null&&v.enqueue({type:"text-delta",textDelta:m.text});let y=Ka(m?.logprobs);y?.length&&(p===void 0&&(p=[]),p.push(...y))},flush(f){f.enqueue({type:"finish",finishReason:u,logprobs:p,usage:c})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:s},warnings:r,request:{body:JSON.stringify(n)}}}},Xc=i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({text:i.string(),finish_reason:i.string(),logprobs:i.object({tokens:i.array(i.string()),token_logprobs:i.array(i.number()),top_logprobs:i.array(i.record(i.string(),i.number())).nullable()}).nullish()})),usage:i.object({prompt_tokens:i.number(),completion_tokens:i.number()})}),Qc=i.union([i.object({id:i.string().nullish(),created:i.number().nullish(),model:i.string().nullish(),choices:i.array(i.object({text:i.string(),finish_reason:i.string().nullish(),index:i.number(),logprobs:i.object({tokens:i.array(i.string()),token_logprobs:i.array(i.number()),top_logprobs:i.array(i.record(i.string(),i.number())).nullable()}).nullish()})),usage:i.object({prompt_tokens:i.number(),completion_tokens:i.number()}).nullish()}),Vn]),ep=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!0}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Lt({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:n,value:s}=await X({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:ee(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Qt,successfulResponseHandler:ne(tp),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.data.map(a=>a.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:n}}}},tp=i.object({data:i.array(i.object({embedding:i.array(i.number())})),usage:i.object({prompt_tokens:i.number()}).nullish()}),rp=class{constructor(e,t){this.specificationVersion="v1",this.modelId=e,this.config=t}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,providerOptions:n,headers:s,abortSignal:a}){var o;let{value:l}=await X({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:ee(this.config.headers(),s),body:{model:this.modelId,prompt:e,n:t,size:r,...(o=n.openai)!=null?o:{},response_format:"b64_json"},failedResponseHandler:Qt,successfulResponseHandler:ne(np),abortSignal:a,fetch:this.config.fetch});return{images:l.data.map(u=>u.b64_json)}}},np=i.object({data:i.array(i.object({b64_json:i.string()}))});function kr(e={}){var t,r,n;let s=(t=Zt(e.baseURL))!=null?t:"https://api.openai.com/v1",a=(r=e.compatibility)!=null?r:"compatible",o=(n=e.name)!=null?n:"openai",l=()=>({Authorization:`Bearer ${nt({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(g,m={})=>new zc(g,m,{provider:`${o}.chat`,url:({path:y})=>`${s}${y}`,headers:l,compatibility:a,fetch:e.fetch}),c=(g,m={})=>new Yc(g,m,{provider:`${o}.completion`,url:({path:y})=>`${s}${y}`,headers:l,compatibility:a,fetch:e.fetch}),p=(g,m={})=>new ep(g,m,{provider:`${o}.embedding`,url:({path:y})=>`${s}${y}`,headers:l,fetch:e.fetch}),d=g=>new rp(g,{provider:`${o}.image`,url:({path:m})=>`${s}${m}`,headers:l,fetch:e.fetch}),f=(g,m)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return g==="gpt-3.5-turbo-instruct"?c(g,m):u(g,m)},v=function(g,m){return f(g,m)};return v.languageModel=f,v.chat=u,v.completion=c,v.embedding=p,v.textEmbedding=p,v.textEmbeddingModel=p,v.image=d,v}var nh=kr({compatibility:"strict"});var Qa=Symbol("Let zodToJsonSchema decide on which parser to use"),Xa={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},eo=e=>typeof e=="string"?{...Xa,name:e}:{...Xa,...e};var to=e=>{let t=eo(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}};function Zn(e,t,r,n){n?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function V(e,t,r,n,s){e[t]=r,Zn(e,t,n,s)}function ro(){return{}}function no(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==k.ZodAny&&(r.items=N(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&V(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&V(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(V(r,"minItems",e.exactLength.value,e.exactLength.message,t),V(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function so(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let n of e.checks)switch(n.kind){case"min":t.target==="jsonSchema7"?n.inclusive?V(r,"minimum",n.value,n.message,t):V(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),V(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?V(r,"maximum",n.value,n.message,t):V(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),V(r,"maximum",n.value,n.message,t));break;case"multipleOf":V(r,"multipleOf",n.value,n.message,t);break}return r}function ao(){return{type:"boolean"}}function fn(e,t){return N(e.type._def,t)}var oo=(e,t)=>N(e.innerType._def,t);function zn(e,t,r){let n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,a)=>zn(e,t,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return sp(e,t)}}var sp=(e,t)=>{let r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(let n of e.checks)switch(n.kind){case"min":V(r,"minimum",n.value,n.message,t);break;case"max":V(r,"maximum",n.value,n.message,t);break}return r};function io(e,t){return{...N(e.innerType._def,t),default:e.defaultValue()}}function lo(e,t){return t.effectStrategy==="input"?N(e.schema._def,t):{}}function uo(e){return{type:"string",enum:Array.from(e.values)}}var ap=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function co(e,t){let r=[N(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),N(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a),n=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return r.forEach(a=>{if(ap(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(n=void 0);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){let{additionalProperties:l,...u}=a;o=u}else n=void 0;s.push(o)}}),s.length?{allOf:s,...n}:void 0}function po(e,t){let r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}var Bn,De={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Bn===void 0&&(Bn=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Bn),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function hn(e,t){let r={type:"string"};if(e.checks)for(let n of e.checks)switch(n.kind){case"min":V(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t);break;case"max":V(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":$e(r,"email",n.message,t);break;case"format:idn-email":$e(r,"idn-email",n.message,t);break;case"pattern:zod":fe(r,De.email,n.message,t);break}break;case"url":$e(r,"uri",n.message,t);break;case"uuid":$e(r,"uuid",n.message,t);break;case"regex":fe(r,n.regex,n.message,t);break;case"cuid":fe(r,De.cuid,n.message,t);break;case"cuid2":fe(r,De.cuid2,n.message,t);break;case"startsWith":fe(r,RegExp(`^${Hn(n.value,t)}`),n.message,t);break;case"endsWith":fe(r,RegExp(`${Hn(n.value,t)}$`),n.message,t);break;case"datetime":$e(r,"date-time",n.message,t);break;case"date":$e(r,"date",n.message,t);break;case"time":$e(r,"time",n.message,t);break;case"duration":$e(r,"duration",n.message,t);break;case"length":V(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t),V(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"includes":{fe(r,RegExp(Hn(n.value,t)),n.message,t);break}case"ip":{n.version!=="v6"&&$e(r,"ipv4",n.message,t),n.version!=="v4"&&$e(r,"ipv6",n.message,t);break}case"base64url":fe(r,De.base64url,n.message,t);break;case"jwt":fe(r,De.jwt,n.message,t);break;case"cidr":{n.version!=="v6"&&fe(r,De.ipv4Cidr,n.message,t),n.version!=="v4"&&fe(r,De.ipv6Cidr,n.message,t);break}case"emoji":fe(r,De.emoji(),n.message,t);break;case"ulid":{fe(r,De.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{$e(r,"binary",n.message,t);break}case"contentEncoding:base64":{V(r,"contentEncoding","base64",n.message,t);break}case"pattern:zod":{fe(r,De.base64,n.message,t);break}}break}case"nanoid":fe(r,De.nanoid,n.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function Hn(e,t){return t.patternStrategy==="escape"?ip(e):e}var op=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ip(e){let t="";for(let r=0;r<e.length;r++)op.has(e[r])||(t+="\\"),t+=e[r];return t}function $e(e,t,r,n){e.format||e.anyOf?.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):V(e,"format",t,r,n)}function fe(e,t,r,n){e.pattern||e.allOf?.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:mo(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):V(e,"pattern",mo(t,n),r,n)}function mo(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=r.i?e.source.toLowerCase():e.source,s="",a=!1,o=!1,l=!1;for(let u=0;u<n.length;u++){if(a){s+=n[u],a=!1;continue}if(r.i){if(o){if(n[u].match(/[a-z]/)){l?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),l=!1):n[u+1]==="-"&&n[u+2]?.match(/[a-z]/)?(s+=n[u],l=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(r.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(r.s&&n[u]==="."){s+=o?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?a=!0:o&&n[u]==="]"?o=!1:!o&&n[u]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function gn(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===k.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,s)=>({...n,[s]:N(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:N(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return r;if(e.keyType?._def.typeName===k.ZodString&&e.keyType._def.checks?.length){let{type:n,...s}=hn(e.keyType._def,t);return{...r,propertyNames:s}}else{if(e.keyType?._def.typeName===k.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===k.ZodBranded&&e.keyType._def.type._def.typeName===k.ZodString&&e.keyType._def.type._def.checks?.length){let{type:n,...s}=fn(e.keyType._def,t);return{...r,propertyNames:s}}}return r}function fo(e,t){if(t.mapStrategy==="record")return gn(e,t);let r=N(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},n=N(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function ho(e){let t=e.values,n=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),s=Array.from(new Set(n.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function go(){return{not:{}}}function yo(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Tr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function bo(e,t){if(t.target==="openApi3")return vo(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in Tr&&(!n._def.checks||!n._def.checks.length))){let n=r.reduce((s,a)=>{let o=Tr[a._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=r.reduce((s,a)=>{let o=typeof a._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===r.length){let s=n.filter((a,o,l)=>l.indexOf(a)===o);return{type:s.length>1?s:s[0],enum:r.reduce((a,o)=>a.includes(o._def.value)?a:[...a,o._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,s)=>[...n,...s._def.values.filter(a=>!n.includes(a))],[])};return vo(e,t)}var vo=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,s)=>N(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function _o(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Tr[e.innerType._def.typeName],nullable:!0}:{type:[Tr[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){let n=N(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let r=N(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function wo(e,t){let r={type:"number"};if(!e.checks)return r;for(let n of e.checks)switch(n.kind){case"int":r.type="integer",Zn(r,"type",n.message,t);break;case"min":t.target==="jsonSchema7"?n.inclusive?V(r,"minimum",n.value,n.message,t):V(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),V(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?V(r,"maximum",n.value,n.message,t):V(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),V(r,"maximum",n.value,n.message,t));break;case"multipleOf":V(r,"multipleOf",n.value,n.message,t);break}return r}function lp(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":N(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":N(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function xo(e,t){let r=t.target==="openAi",n={type:"object",...Object.entries(e.shape()).reduce((s,[a,o])=>{if(o===void 0||o._def===void 0)return s;let l=o.isOptional();l&&r&&(o instanceof ve&&(o=o._def.innerType),o.isNullable()||(o=o.nullable()),l=!1);let u=N(o._def,{...t,currentPath:[...t.currentPath,"properties",a],propertyPath:[...t.currentPath,"properties",a]});return u===void 0?s:{properties:{...s.properties,[a]:u},required:l?s.required:[...s.required,a]}},{properties:{},required:[]}),additionalProperties:lp(e,t)};return n.required.length||delete n.required,n}var ko=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return N(e.innerType._def,t);let r=N(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}};var To=(e,t)=>{if(t.pipeStrategy==="input")return N(e.in._def,t);if(t.pipeStrategy==="output")return N(e.out._def,t);let r=N(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=N(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(s=>s!==void 0)}};function So(e,t){return N(e.type._def,t)}function Co(e,t){let n={type:"array",uniqueItems:!0,items:N(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&V(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&V(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function Io(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>N(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:N(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>N(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function Eo(){return{not:{}}}function Ao(){return{}}var Ro=(e,t)=>N(e.innerType._def,t);function N(e,t,r=!1){let n=t.seen.get(e);if(t.override){let o=t.override?.(e,t,n,r);if(o!==Qa)return o}if(n&&!r){let o=up(n,t);if(o!==void 0)return o}let s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);let a=pp(e,e.typeName,t);return a&&dp(e,t,a),s.jsonSchema=a,a}var up=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:cp(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},cp=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},pp=(e,t,r)=>{switch(t){case k.ZodString:return hn(e,r);case k.ZodNumber:return wo(e,r);case k.ZodObject:return xo(e,r);case k.ZodBigInt:return so(e,r);case k.ZodBoolean:return ao();case k.ZodDate:return zn(e,r);case k.ZodUndefined:return Eo();case k.ZodNull:return yo(r);case k.ZodArray:return no(e,r);case k.ZodUnion:case k.ZodDiscriminatedUnion:return bo(e,r);case k.ZodIntersection:return co(e,r);case k.ZodTuple:return Io(e,r);case k.ZodRecord:return gn(e,r);case k.ZodLiteral:return po(e,r);case k.ZodEnum:return uo(e);case k.ZodNativeEnum:return ho(e);case k.ZodNullable:return _o(e,r);case k.ZodOptional:return ko(e,r);case k.ZodMap:return fo(e,r);case k.ZodSet:return Co(e,r);case k.ZodLazy:return N(e.getter()._def,r);case k.ZodPromise:return So(e,r);case k.ZodNaN:case k.ZodNever:return go();case k.ZodEffects:return lo(e,r);case k.ZodAny:return ro();case k.ZodUnknown:return Ao();case k.ZodDefault:return io(e,r);case k.ZodBranded:return fn(e,r);case k.ZodReadonly:return Ro(e,r);case k.ZodCatch:return oo(e,r);case k.ZodPipeline:return To(e,r);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(n=>{})(t)}},dp=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);var Po=(e,t)=>{let r=to(t),n=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[c,p])=>({...u,[c]:N(p._def,{...r,currentPath:[...r.basePath,r.definitionPath,c]},!0)??{}}),{}):void 0,s=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,a=N(e._def,s===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1)??{},o=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;o!==void 0&&(a.title=o);let l=s===void 0?n?{...a,[r.definitionPath]:n}:a:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...n,[s]:a}};return r.target==="jsonSchema7"?l.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l};var No=Po;var Sr={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Cr={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},Ir={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},Er={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Ar={code:"6",name:"data_message",parse:e=>{if(e==null||typeof e!="object"||!("role"in e)||!("data"in e)||typeof e.role!="string"||e.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},mp=[Sr,Cr,Ir,Er,Ar],qy={[Sr.code]:Sr,[Cr.code]:Cr,[Ir.code]:Ir,[Er.code]:Er,[Ar.code]:Ar},Ly={[Sr.name]:Sr.code,[Cr.name]:Cr.code,[Ir.name]:Ir.code,[Er.name]:Er.code,[Ar.name]:Ar.code},Fy=mp.map(e=>e.code);var Rr={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},Pr={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},Nr={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},jr={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},Mr={code:"9",name:"tool_call",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string"||!("args"in e)||typeof e.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},Or={code:"a",name:"tool_result",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},Dr={code:"b",name:"tool_call_streaming_start",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("toolName"in e)||typeof e.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},$r={code:"c",name:"tool_call_delta",parse:e=>{if(e==null||typeof e!="object"||!("toolCallId"in e)||typeof e.toolCallId!="string"||!("argsTextDelta"in e)||typeof e.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},Ur={code:"d",name:"finish_message",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},qr={code:"e",name:"finish_step",parse:e=>{if(e==null||typeof e!="object"||!("finishReason"in e)||typeof e.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&e.usage!=null&&typeof e.usage=="object"&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:typeof e.usage.promptTokens=="number"?e.usage.promptTokens:Number.NaN,completionTokens:typeof e.usage.completionTokens=="number"?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&typeof e.isContinued=="boolean"&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},jo=[Rr,Pr,Nr,jr,Mr,Or,Dr,$r,Ur,qr],Jy={[Rr.code]:Rr,[Pr.code]:Pr,[Nr.code]:Nr,[jr.code]:jr,[Mr.code]:Mr,[Or.code]:Or,[Dr.code]:Dr,[$r.code]:$r,[Ur.code]:Ur,[qr.code]:qr},Vy={[Rr.name]:Rr.code,[Pr.name]:Pr.code,[Nr.name]:Nr.code,[jr.name]:jr.code,[Mr.name]:Mr.code,[Or.name]:Or.code,[Dr.name]:Dr.code,[$r.name]:$r.code,[Ur.name]:Ur.code,[qr.name]:qr.code},Zy=jo.map(e=>e.code);function Se(e,t){let r=jo.find(n=>n.name===e);if(!r)throw new Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var Gn=Symbol.for("vercel.ai.schema");function fp(e,{validate:t}={}){return{[Gn]:!0,_type:void 0,[hr]:!0,jsonSchema:e,validate:t}}function hp(e){return typeof e=="object"&&e!==null&&Gn in e&&e[Gn]===!0&&"jsonSchema"in e&&"validate"in e}function $t(e){return hp(e)?e:gp(e)}function gp(e){return fp(No(e),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var Mo=typeof globalThis=="object"?globalThis:global;var Xe="1.9.0";var Oo=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function yp(e){var t=new Set([e]),r=new Set,n=e.match(Oo);if(!n)return function(){return!1};var s={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(s.prerelease!=null)return function(u){return u===e};function a(l){return r.add(l),!1}function o(l){return t.add(l),!0}return function(u){if(t.has(u))return!0;if(r.has(u))return!1;var c=u.match(Oo);if(!c)return a(u);var p={major:+c[1],minor:+c[2],patch:+c[3],prerelease:c[4]};return p.prerelease!=null||s.major!==p.major?a(u):s.major===0?s.minor===p.minor&&s.patch<=p.patch?o(u):a(u):s.minor<=p.minor?o(u):a(u)}}var Do=yp(Xe);var vp=Xe.split(".")[0],Lr=Symbol.for("opentelemetry.js.api."+vp),Fr=Mo;function er(e,t,r,n){var s;n===void 0&&(n=!1);var a=Fr[Lr]=(s=Fr[Lr])!==null&&s!==void 0?s:{version:Xe};if(!n&&a[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),!1}if(a.version!==Xe){var o=new Error("@opentelemetry/api: Registration of version v"+a.version+" for "+e+" does not match previously registered API v"+Xe);return r.error(o.stack||o.message),!1}return a[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+Xe+"."),!0}function Qe(e){var t,r,n=(t=Fr[Lr])===null||t===void 0?void 0:t.version;if(!(!n||!Do(n)))return(r=Fr[Lr])===null||r===void 0?void 0:r[e]}function tr(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Xe+".");var r=Fr[Lr];r&&delete r[e]}var bp=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)a.push(s.value)}catch(l){o={error:l}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a},_p=function(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,a;n<s;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},$o=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Jr("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Jr("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Jr("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Jr("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Jr("verbose",this._namespace,t)},e}();function Jr(e,t,r){var n=Qe("diag");if(n)return r.unshift(t),n[e].apply(n,_p([],bp(r),!1))}var he;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(he||(he={}));function Uo(e,t){e<he.NONE?e=he.NONE:e>he.ALL&&(e=he.ALL),t=t||{};function r(n,s){var a=t[n];return typeof a=="function"&&e>=s?a.bind(t):function(){}}return{error:r("error",he.ERROR),warn:r("warn",he.WARN),info:r("info",he.INFO),debug:r("debug",he.DEBUG),verbose:r("verbose",he.VERBOSE)}}var wp=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)a.push(s.value)}catch(l){o={error:l}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a},xp=function(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,a;n<s;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},kp="diag",rr=function(){function e(){function t(s){return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var l=Qe("diag");if(l)return l[s].apply(l,xp([],wp(a),!1))}}var r=this,n=function(s,a){var o,l,u;if(a===void 0&&(a={logLevel:he.INFO}),s===r){var c=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=c.stack)!==null&&o!==void 0?o:c.message),!1}typeof a=="number"&&(a={logLevel:a});var p=Qe("diag"),d=Uo((l=a.logLevel)!==null&&l!==void 0?l:he.INFO,s);if(p&&!a.suppressOverrideMessage){var f=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";p.warn("Current logger will be overwritten from "+f),d.warn("Current logger will overwrite one already registered from "+f)}return er("diag",d,r,!0)};r.setLogger=n,r.disable=function(){tr(kp,r)},r.createComponentLogger=function(s){return new $o(s)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function qo(e){return Symbol.for(e)}var Tp=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,s){var a=new e(r._currentContext);return a._currentContext.set(n,s),a},r.deleteValue=function(n){var s=new e(r._currentContext);return s._currentContext.delete(n),s}}return e}(),Lo=new Tp;var Sp=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)a.push(s.value)}catch(l){o={error:l}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a},Cp=function(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,a;n<s;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},Fo=function(){function e(){}return e.prototype.active=function(){return Lo},e.prototype.with=function(t,r,n){for(var s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];return r.call.apply(r,Cp([n],Sp(s),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}();var Ip=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,a=[],o;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)a.push(s.value)}catch(l){o={error:l}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a},Ep=function(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,a;n<s;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},Wn="context",Ap=new Fo,yn=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return er(Wn,t,rr.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,n){for(var s,a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return(s=this._getContextManager()).with.apply(s,Ep([t,r,n],Ip(a),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return Qe(Wn)||Ap},e.prototype.disable=function(){this._getContextManager().disable(),tr(Wn,rr.instance())},e}();var vn;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(vn||(vn={}));var Kn="0000000000000000",Yn="00000000000000000000000000000000",Jo={traceId:Yn,spanId:Kn,traceFlags:vn.NONE};var ut=function(){function e(t){t===void 0&&(t=Jo),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e}();var Xn=qo("OpenTelemetry Context Key SPAN");function bn(e){return e.getValue(Xn)||void 0}function Vo(){return bn(yn.getInstance().active())}function Vr(e,t){return e.setValue(Xn,t)}function Zo(e){return e.deleteValue(Xn)}function zo(e,t){return Vr(e,new ut(t))}function _n(e){var t;return(t=bn(e))===null||t===void 0?void 0:t.spanContext()}var Rp=/^([0-9a-f]{32})$/i,Pp=/^[0-9a-f]{16}$/i;function Np(e){return Rp.test(e)&&e!==Yn}function jp(e){return Pp.test(e)&&e!==Kn}function wn(e){return Np(e.traceId)&&jp(e.spanId)}function Bo(e){return new ut(e)}var Qn=yn.getInstance(),xn=function(){function e(){}return e.prototype.startSpan=function(t,r,n){n===void 0&&(n=Qn.active());var s=!!r?.root;if(s)return new ut;var a=n&&_n(n);return Mp(a)&&wn(a)?new ut(a):new ut},e.prototype.startActiveSpan=function(t,r,n,s){var a,o,l;if(!(arguments.length<2)){arguments.length===2?l=r:arguments.length===3?(a=r,l=n):(a=r,o=n,l=s);var u=o??Qn.active(),c=this.startSpan(t,a,u),p=Vr(u,c);return Qn.with(p,l,void 0,c)}},e}();function Mp(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var Op=new xn,Ho=function(){function e(t,r,n,s){this._provider=t,this.name=r,this.version=n,this.options=s}return e.prototype.startSpan=function(t,r,n){return this._getTracer().startSpan(t,r,n)},e.prototype.startActiveSpan=function(t,r,n,s){var a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Op},e}();var Go=function(){function e(){}return e.prototype.getTracer=function(t,r,n){return new xn},e}();var Dp=new Go,es=function(){function e(){}return e.prototype.getTracer=function(t,r,n){var s;return(s=this.getDelegateTracer(t,r,n))!==null&&s!==void 0?s:new Ho(this,t,r,n)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Dp},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,n){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,r,n)},e}();var nr;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(nr||(nr={}));var ts="trace",Wo=function(){function e(){this._proxyTracerProvider=new es,this.wrapSpanContext=Bo,this.isSpanContextValid=wn,this.deleteSpan=Zo,this.getSpan=bn,this.getActiveSpan=Vo,this.getSpanContext=_n,this.setSpan=Vr,this.setSpanContext=zo}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=er(ts,this._proxyTracerProvider,rr.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return Qe(ts)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){tr(ts,rr.instance()),this._proxyTracerProvider=new es},e}();var rs=Wo.getInstance();var $p=Object.defineProperty,is=(e,t)=>{for(var r in t)$p(e,r,{get:t[r],enumerable:!0})};function Tn(e,{contentType:t,dataStreamVersion:r}){let n=new Headers(e??{});return n.has("Content-Type")||n.set("Content-Type",t),r!==void 0&&n.set("X-Vercel-AI-Data-Stream",r),n}function Ko(e,{contentType:t,dataStreamVersion:r}){let n={};if(e!=null)for(let[s,a]of Object.entries(e))n[s]=a;return n["Content-Type"]==null&&(n["Content-Type"]=t),r!==void 0&&(n["X-Vercel-AI-Data-Stream"]=r),n}function Yo({response:e,status:t,statusText:r,headers:n,stream:s}){e.writeHead(t??200,r,n);let a=s.getReader();(async()=>{try{for(;;){let{done:l,value:u}=await a.read();if(l)break;e.write(u)}}catch(l){throw l}finally{e.end()}})()}var oi="AI_InvalidArgumentError",ii=`vercel.ai.error.${oi}`,Up=Symbol.for(ii),li,Re=class extends A{constructor({parameter:e,value:t,message:r}){super({name:oi,message:`Invalid argument for parameter ${e}: ${r}`}),this[li]=!0,this.parameter=e,this.value=t}static isInstance(e){return A.hasMarker(e,ii)}};li=Up;async function qp(e){return e===void 0?Promise.resolve():new Promise(t=>setTimeout(t,e))}var ui="AI_RetryError",ci=`vercel.ai.error.${ui}`,Lp=Symbol.for(ci),pi,Xo=class extends A{constructor({message:e,reason:t,errors:r}){super({name:ui,message:e}),this[pi]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return A.hasMarker(e,ci)}};pi=Lp;var Fp=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async n=>di(n,{maxRetries:e,delayInMs:t,backoffFactor:r});async function di(e,{maxRetries:t,delayInMs:r,backoffFactor:n},s=[]){try{return await e()}catch(a){if(fr(a)||t===0)throw a;let o=ya(a),l=[...s,a],u=l.length;if(u>t)throw new Xo({message:`Failed after ${u} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:l});if(a instanceof Error&&xe.isInstance(a)&&a.isRetryable===!0&&u<=t)return await qp(r),di(e,{maxRetries:t,delayInMs:n*r,backoffFactor:n},l);throw u===1?a:new Xo({message:`Failed after ${u} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:l})}}function mi({maxRetries:e}){if(e!=null){if(!Number.isInteger(e))throw new Re({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new Re({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=e??2;return{maxRetries:t,retry:Fp({maxRetries:t})}}function sr({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function fi({model:e,settings:t,telemetry:r,headers:n}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((a,[o,l])=>(a[`ai.settings.${o}`]=l,a),{}),...Object.entries((s=r?.metadata)!=null?s:{}).reduce((a,[o,l])=>(a[`ai.telemetry.metadata.${o}`]=l,a),{}),...Object.entries(n??{}).reduce((a,[o,l])=>(l!==void 0&&(a[`ai.request.headers.${o}`]=l),a),{})}}var Jp={startSpan(){return kn},startActiveSpan(e,t,r,n){if(typeof t=="function")return t(kn);if(typeof r=="function")return r(kn);if(typeof n=="function")return n(kn)}},kn={spanContext(){return Vp},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Vp={traceId:"",spanId:"",traceFlags:0};function hi({isEnabled:e=!1,tracer:t}={}){return e?t||rs.getTracer("ai"):Jp}function ar({name:e,tracer:t,attributes:r,fn:n,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:r},async a=>{try{let o=await n(a);return s&&a.end(),o}catch(o){try{o instanceof Error?(a.recordException({name:o.name,message:o.message,stack:o.stack}),a.setStatus({code:nr.ERROR,message:o.message})):a.setStatus({code:nr.ERROR})}finally{a.end()}throw o}})}function Pe({telemetry:e,attributes:t}){return e?.isEnabled!==!0?{}:Object.entries(t).reduce((r,[n,s])=>{if(s===void 0)return r;if(typeof s=="object"&&"input"in s&&typeof s.input=="function"){if(e?.recordInputs===!1)return r;let a=s.input();return a===void 0?r:{...r,[n]:a}}if(typeof s=="object"&&"output"in s&&typeof s.output=="function"){if(e?.recordOutputs===!1)return r;let a=s.output();return a===void 0?r:{...r,[n]:a}}return{...r,[n]:s}},{})}var gi="AI_NoObjectGeneratedError",yi=`vercel.ai.error.${gi}`,Zp=Symbol.for(yi),vi,Qo=class extends A{constructor({message:e="No object generated.",cause:t,text:r,response:n,usage:s}){super({name:gi,message:e,cause:t}),this[vi]=!0,this.text=r,this.response=n,this.usage=s}static isInstance(e){return A.hasMarker(e,yi)}};vi=Zp;var bi="AI_DownloadError",_i=`vercel.ai.error.${bi}`,zp=Symbol.for(_i),wi,ns=class extends A{constructor({url:e,statusCode:t,statusText:r,cause:n,message:s=n==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${n}`}){super({name:bi,message:s,cause:n}),this[wi]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return A.hasMarker(e,_i)}};wi=zp;async function Bp({url:e,fetchImplementation:t=fetch}){var r;let n=e.toString();try{let s=await t(n);if(!s.ok)throw new ns({url:n,statusCode:s.status,statusText:s.statusText});return{data:new Uint8Array(await s.arrayBuffer()),mimeType:(r=s.headers.get("content-type"))!=null?r:void 0}}catch(s){throw ns.isInstance(s)?s:new ns({url:n,cause:s})}}var Hp=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}];function Gp(e){for(let{bytes:t,mimeType:r}of Hp)if(e.length>=t.length&&t.every((n,s)=>e[s]===n))return r}var xi="AI_InvalidDataContentError",ki=`vercel.ai.error.${xi}`,Wp=Symbol.for(ki),Ti,ei=class extends A{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:xi,message:r,cause:t}),this[Ti]=!0,this.content=e}static isInstance(e){return A.hasMarker(e,ki)}};Ti=Wp;var Si=i.union([i.string(),i.instanceof(Uint8Array),i.instanceof(ArrayBuffer),i.custom(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function Kp(e){return typeof e=="string"?e:e instanceof ArrayBuffer?Me(new Uint8Array(e)):Me(e)}function Sn(e){if(e instanceof Uint8Array)return e;if(typeof e=="string")try{return ba(e)}catch(t){throw new ei({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new ei({content:e})}function Yp(e){try{return new TextDecoder().decode(e)}catch{throw new Error("Error decoding Uint8Array to text")}}var Ci="AI_InvalidMessageRoleError",Ii=`vercel.ai.error.${Ci}`,Xp=Symbol.for(Ii),Ei,Qp=class extends A{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Ci,message:t}),this[Ei]=!0,this.role=e}static isInstance(e){return A.hasMarker(e,Ii)}};Ei=Xp;function ed(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mimeType:void 0,base64Content:void 0}}}async function Ai({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:n=Bp}){let s=await rd(e.messages,n,t,r);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(a=>td(a,s))]}function td(e,t){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerMetadata:e.experimental_providerMetadata};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata}:{role:"user",content:e.content.map(n=>nd(n,t)).filter(n=>n.type!=="text"||n.text!==""),providerMetadata:e.experimental_providerMetadata};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter(n=>n.type!=="text"||n.text!=="").map(n=>{let{experimental_providerMetadata:s,...a}=n;return{...a,providerMetadata:s}}),providerMetadata:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(n=>({type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,result:n.result,content:n.experimental_content,isError:n.isError,providerMetadata:n.experimental_providerMetadata})),providerMetadata:e.experimental_providerMetadata};default:{let n=r;throw new Qp({role:n})}}}async function rd(e,t,r,n){let s=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").filter(o=>!(o.type==="image"&&r===!0)).map(o=>o.type==="image"?o.image:o.data).map(o=>typeof o=="string"&&(o.startsWith("http:")||o.startsWith("https:"))?new URL(o):o).filter(o=>o instanceof URL).filter(o=>!n(o)),a=await Promise.all(s.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(a.map(({url:o,data:l})=>[o.toString(),l]))}function nd(e,t){if(e.type==="text")return{type:"text",text:e.text,providerMetadata:e.experimental_providerMetadata};let r=e.mimeType,n,s,a,o=e.type;switch(o){case"image":n=e.image;break;case"file":n=e.data;break;default:throw new Error(`Unsupported part type: ${o}`)}try{s=typeof n=="string"?new URL(n):n}catch{s=n}if(s instanceof URL)if(s.protocol==="data:"){let{mimeType:l,base64Content:u}=ed(s.toString());if(l==null||u==null)throw new Error(`Invalid data URL format in part ${o}`);r=l,a=Sn(u)}else{let l=t[s.toString()];l?(a=l.data,r??(r=l.mimeType)):a=s}else a=Sn(s);switch(o){case"image":return r==null&&a instanceof Uint8Array&&(r=Gp(a)),{type:"image",image:a,mimeType:r,providerMetadata:e.experimental_providerMetadata};case"file":if(r==null)throw new Error("Mime type is missing for file part");return{type:"file",data:a instanceof Uint8Array?Kp(a):a,mimeType:r,providerMetadata:e.experimental_providerMetadata}}}function Ri({maxTokens:e,temperature:t,topP:r,topK:n,presencePenalty:s,frequencyPenalty:a,stopSequences:o,seed:l}){if(e!=null){if(!Number.isInteger(e))throw new Re({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new Re({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new Re({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new Re({parameter:"topP",value:r,message:"topP must be a number"});if(n!=null&&typeof n!="number")throw new Re({parameter:"topK",value:n,message:"topK must be a number"});if(s!=null&&typeof s!="number")throw new Re({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(a!=null&&typeof a!="number")throw new Re({parameter:"frequencyPenalty",value:a,message:"frequencyPenalty must be a number"});if(l!=null&&!Number.isInteger(l))throw new Re({parameter:"seed",value:l,message:"seed must be an integer"});return{maxTokens:e,temperature:t??0,topP:r,topK:n,presencePenalty:s,frequencyPenalty:a,stopSequences:o!=null&&o.length>0?o:void 0,seed:l}}var ss=i.lazy(()=>i.union([i.null(),i.string(),i.number(),i.boolean(),i.record(i.string(),ss),i.array(ss)])),ct=i.record(i.string(),i.record(i.string(),ss)),sd=i.array(i.union([i.object({type:i.literal("text"),text:i.string()}),i.object({type:i.literal("image"),data:i.string(),mimeType:i.string().optional()})])),Pi=i.object({type:i.literal("text"),text:i.string(),experimental_providerMetadata:ct.optional()}),ad=i.object({type:i.literal("image"),image:i.union([Si,i.instanceof(URL)]),mimeType:i.string().optional(),experimental_providerMetadata:ct.optional()}),od=i.object({type:i.literal("file"),data:i.union([Si,i.instanceof(URL)]),mimeType:i.string(),experimental_providerMetadata:ct.optional()}),id=i.object({type:i.literal("tool-call"),toolCallId:i.string(),toolName:i.string(),args:i.unknown()}),ld=i.object({type:i.literal("tool-result"),toolCallId:i.string(),toolName:i.string(),result:i.unknown(),content:sd.optional(),isError:i.boolean().optional(),experimental_providerMetadata:ct.optional()}),ud=i.object({role:i.literal("system"),content:i.string(),experimental_providerMetadata:ct.optional()}),cd=i.object({role:i.literal("user"),content:i.union([i.string(),i.array(i.union([Pi,ad,od]))]),experimental_providerMetadata:ct.optional()}),pd=i.object({role:i.literal("assistant"),content:i.union([i.string(),i.array(i.union([Pi,id]))]),experimental_providerMetadata:ct.optional()}),dd=i.object({role:i.literal("tool"),content:i.array(ld),experimental_providerMetadata:ct.optional()}),md=i.union([ud,cd,pd,dd]);function fd(e){if(!Array.isArray(e))return"other";if(e.length===0)return"messages";let t=e.map(hd);return t.some(r=>r==="has-ui-specific-parts")?"ui-messages":t.every(r=>r==="has-core-specific-parts"||r==="message")?"messages":"other"}function hd(e){return typeof e=="object"&&e!==null&&(e.role==="function"||e.role==="data"||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":typeof e=="object"&&e!==null&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e)?"has-core-specific-parts":typeof e=="object"&&e!==null&&"role"in e&&"content"in e&&typeof e.content=="string"&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function gd(e){var t,r,n;let s=[];for(let a of e){let o;try{o=new URL(a.url)}catch{throw new Error(`Invalid URL: ${a.url}`)}switch(o.protocol){case"http:":case"https:":{if((t=a.contentType)!=null&&t.startsWith("image/"))s.push({type:"image",image:o});else{if(!a.contentType)throw new Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:o,mimeType:a.contentType})}break}case"data:":{let l,u,c;try{[l,u]=a.url.split(","),c=l.split(";")[0].split(":")[1]}catch{throw new Error(`Error processing data URL: ${a.url}`)}if(c==null||u==null)throw new Error(`Invalid data URL format: ${a.url}`);if((r=a.contentType)!=null&&r.startsWith("image/"))s.push({type:"image",image:Sn(u)});else if((n=a.contentType)!=null&&n.startsWith("text/"))s.push({type:"text",text:Yp(Sn(u))});else{if(!a.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:u,mimeType:a.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${o.protocol}`)}}return s}var Ni="AI_MessageConversionError",ji=`vercel.ai.error.${Ni}`,yd=Symbol.for(ji),Mi,ti=class extends A{constructor({originalMessage:e,message:t}){super({name:Ni,message:t}),this[Mi]=!0,this.originalMessage=e}static isInstance(e){return A.hasMarker(e,ji)}};Mi=yd;function vd(e,t){var r;let n=(r=t?.tools)!=null?r:{},s=[];for(let a of e){let{role:o,content:l,toolInvocations:u,experimental_attachments:c}=a;switch(o){case"system":{s.push({role:"system",content:l});break}case"user":{s.push({role:"user",content:c?[{type:"text",text:l},...gd(c)]:l});break}case"assistant":{if(u==null){s.push({role:"assistant",content:l});break}s.push({role:"assistant",content:[{type:"text",text:l},...u.map(({toolCallId:p,toolName:d,args:f})=>({type:"tool-call",toolCallId:p,toolName:d,args:f}))]}),s.push({role:"tool",content:u.map(p=>{if(!("result"in p))throw new ti({originalMessage:a,message:"ToolInvocation must have a result: "+JSON.stringify(p)});let{toolCallId:d,toolName:f,result:v}=p,g=n[f];return g?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:d,toolName:f,result:g.experimental_toToolResultContent(v),experimental_content:g.experimental_toToolResultContent(v)}:{type:"tool-result",toolCallId:d,toolName:f,result:v}})});break}case"data":break;default:{let p=o;throw new ti({originalMessage:a,message:`Unsupported role: ${p}`})}}}return s}function Oi({prompt:e,tools:t}){if(e.prompt==null&&e.messages==null)throw new je({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new je({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new je({prompt:e,message:"system must be a string"});if(e.prompt!=null){if(typeof e.prompt!="string")throw new je({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(e.messages!=null){let r=fd(e.messages);if(r==="other")throw new je({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let n=r==="ui-messages"?vd(e.messages,{tools:t}):e.messages,s=st({value:n,schema:i.array(md)});if(!s.success)throw new je({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:s.error});return{type:"messages",messages:n,system:e.system}}throw new Error("unreachable")}function Di({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function $i(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}var bd="JSON schema:",_d="You MUST answer with a JSON object that matches the JSON schema above.",wd="You MUST answer with JSON.";function xd({prompt:e,schema:t,schemaPrefix:r=t!=null?bd:void 0,schemaSuffix:n=t!=null?_d:wd}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,r,t!=null?JSON.stringify(t):void 0,n].filter(s=>s!=null).join(`
`)}function ri(e,t){let r=e.pipeThrough(new TransformStream(t));return r[Symbol.asyncIterator]=()=>{let n=r.getReader();return{async next(){let{done:s,value:a}=await n.read();return s?{done:!0,value:void 0}:{done:!1,value:a}}}},r}var kb=He({prefix:"aiobj",size:24});var Ze=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this.promise)}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&((t=this._reject)==null||t.call(this,e))}};function ni(){let e,t;return{promise:new Promise((n,s)=>{e=n,t=s}),resolve:e,reject:t}}function kd(){let e=[],t=null,r=!1,n=ni(),s=async()=>{if(r&&e.length===0){t?.close();return}if(e.length===0)return n=ni(),await n.promise,s();try{let{value:a,done:o}=await e[0].read();o?(e.shift(),e.length>0?await s():r&&t?.close()):t?.enqueue(a)}catch(a){t?.error(a),e.shift(),r&&e.length===0&&t?.close()}};return{stream:new ReadableStream({start(a){t=a},pull:s,async cancel(){for(let a of e)await a.cancel();e=[],r=!0}}),addStream:a=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(a.getReader()),n.resolve()},close:()=>{r=!0,n.resolve(),e.length===0&&t?.close()}}}function Td(){var e,t;return(t=(e=globalThis?.performance)==null?void 0:e.now())!=null?t:Date.now()}var Sb=He({prefix:"aiobj",size:24});var Ui="AI_InvalidToolArgumentsError",qi=`vercel.ai.error.${Ui}`,Sd=Symbol.for(qi),Li,Fi=class extends A{constructor({toolArgs:e,toolName:t,cause:r,message:n=`Invalid arguments for tool ${t}: ${tt(r)}`}){super({name:Ui,message:n,cause:r}),this[Li]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return A.hasMarker(e,qi)}};Li=Sd;var Ji="AI_NoSuchToolError",Vi=`vercel.ai.error.${Ji}`,Cd=Symbol.for(Vi),Zi,as=class extends A{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Ji,message:r}),this[Zi]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return A.hasMarker(e,Vi)}};Zi=Cd;var zi="AI_ToolCallRepairError",Bi=`vercel.ai.error.${zi}`,Id=Symbol.for(Bi),Hi,Ed=class extends A{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${tt(e)}`}){super({name:zi,message:r,cause:e}),this[Hi]=!0,this.originalError=t}static isInstance(e){return A.hasMarker(e,Bi)}};Hi=Id;var Gi="AI_ToolExecutionError",Wi=`vercel.ai.error.${Gi}`,Ad=Symbol.for(Wi),Ki,Yi=class extends A{constructor({toolArgs:e,toolName:t,cause:r,message:n=`Error executing tool ${t}: ${tt(r)}`}){super({name:Gi,message:n,cause:r}),this[Ki]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return A.hasMarker(e,Wi)}};Ki=Ad;function Rd(e){return e!=null&&Object.keys(e).length>0}function Xi({tools:e,toolChoice:t,activeTools:r}){return Rd(e)?{tools:(r!=null?Object.entries(e).filter(([s])=>r.includes(s)):Object.entries(e)).map(([s,a])=>{let o=a.type;switch(o){case void 0:case"function":return{type:"function",name:s,description:a.description,parameters:$t(a.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:s,id:a.id,args:a.args};default:{let l=o;throw new Error(`Unsupported tool type: ${l}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var Pd=/^([\s\S]*?)(\s+)(\S*)$/;function Qi(e){let t=e.match(Pd);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function Nd(e){let t=Qi(e);return t?t.prefix+t.whitespace:e}async function el({toolCall:e,tools:t,repairToolCall:r,system:n,messages:s}){if(t==null)throw new as({toolName:e.toolName});try{return await si({toolCall:e,tools:t})}catch(a){if(r==null||!(as.isInstance(a)||Fi.isInstance(a)))throw a;let o=null;try{o=await r({toolCall:e,tools:t,parameterSchema:({toolName:l})=>$t(t[l].parameters).jsonSchema,system:n,messages:s,error:a})}catch(l){throw new Ed({cause:l,originalError:a})}if(o==null)throw a;return await si({toolCall:o,tools:t})}}async function si({toolCall:e,tools:t}){let r=e.toolName,n=t[r];if(n==null)throw new as({toolName:e.toolName,availableTools:Object.keys(t)});let s=$t(n.parameters),a=e.args.trim()===""?st({value:{},schema:s}):bt({text:e.args,schema:s});if(a.success===!1)throw new Fi({toolName:r,toolArgs:e.args,cause:a.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:a.value}}function os({text:e="",tools:t,toolCalls:r,toolResults:n}){let s=[];return s.push({role:"assistant",content:[{type:"text",text:e},...r]}),n.length>0&&s.push({role:"tool",content:n.map(a=>{let o=t[a.toolName];return o?.experimental_toToolResultContent!=null?{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,result:o.experimental_toToolResultContent(a.result),experimental_content:o.experimental_toToolResultContent(a.result)}:{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,result:a.result}})}),s}var jd=He({prefix:"aitxt",size:24});async function tl({model:e,tools:t,toolChoice:r,system:n,prompt:s,messages:a,maxRetries:o,abortSignal:l,headers:u,maxSteps:c=1,experimental_output:p,experimental_continueSteps:d=!1,experimental_telemetry:f,experimental_providerMetadata:v,experimental_activeTools:g,experimental_repairToolCall:m,_internal:{generateId:y=jd,currentDate:b=()=>new Date}={},onStepFinish:h,...w}){var _;if(c<1)throw new Re({parameter:"maxSteps",value:c,message:"maxSteps must be at least 1"});let{maxRetries:I,retry:S}=mi({maxRetries:o}),j=fi({model:e,telemetry:f,headers:u,settings:{...w,maxRetries:I}}),q=Oi({prompt:{system:(_=p?.injectIntoSystemPrompt({system:n,model:e}))!=null?_:n,prompt:s,messages:a},tools:t}),U=hi(f);return ar({name:"ai.generateText",attributes:Pe({telemetry:f,attributes:{...sr({operationId:"ai.generateText",telemetry:f}),...j,"ai.prompt":{input:()=>JSON.stringify({system:n,prompt:s,messages:a})},"ai.settings.maxSteps":c}}),tracer:U,fn:async W=>{var K,Q,le,ge,te,re;let ae={type:"regular",...Xi({tools:t,toolChoice:r,activeTools:g})},Ce=Ri(w),L,R=[],B=[],H=0,z=[],ze="",Ut=[],pt={completionTokens:0,promptTokens:0,totalTokens:0},qe="initial";do{let oe=H===0?q.type:"messages",O=[...q.messages,...z],_e=await Ai({prompt:{type:oe,system:q.system,messages:O},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl});L=await S(()=>ar({name:"ai.generateText.doGenerate",attributes:Pe({telemetry:f,attributes:{...sr({operationId:"ai.generateText.doGenerate",telemetry:f}),...j,"ai.prompt.format":{input:()=>oe},"ai.prompt.messages":{input:()=>JSON.stringify(_e)},"ai.prompt.tools":{input:()=>{var ye;return(ye=ae.tools)==null?void 0:ye.map(mt=>JSON.stringify(mt))}},"ai.prompt.toolChoice":{input:()=>ae.toolChoice!=null?JSON.stringify(ae.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":w.frequencyPenalty,"gen_ai.request.max_tokens":w.maxTokens,"gen_ai.request.presence_penalty":w.presencePenalty,"gen_ai.request.stop_sequences":w.stopSequences,"gen_ai.request.temperature":w.temperature,"gen_ai.request.top_k":w.topK,"gen_ai.request.top_p":w.topP}}),tracer:U,fn:async ye=>{var mt,lr,ft,Br,Hr,ht;let de=await e.doGenerate({mode:ae,...Ce,inputFormat:oe,responseFormat:p?.responseFormat({model:e}),prompt:_e,providerMetadata:v,abortSignal:l,headers:u}),we={id:(lr=(mt=de.response)==null?void 0:mt.id)!=null?lr:y(),timestamp:(Br=(ft=de.response)==null?void 0:ft.timestamp)!=null?Br:b(),modelId:(ht=(Hr=de.response)==null?void 0:Hr.modelId)!=null?ht:e.modelId};return ye.setAttributes(Pe({telemetry:f,attributes:{"ai.response.finishReason":de.finishReason,"ai.response.text":{output:()=>de.text},"ai.response.toolCalls":{output:()=>JSON.stringify(de.toolCalls)},"ai.response.id":we.id,"ai.response.model":we.modelId,"ai.response.timestamp":we.timestamp.toISOString(),"ai.usage.promptTokens":de.usage.promptTokens,"ai.usage.completionTokens":de.usage.completionTokens,"gen_ai.response.finish_reasons":[de.finishReason],"gen_ai.response.id":we.id,"gen_ai.response.model":we.modelId,"gen_ai.usage.input_tokens":de.usage.promptTokens,"gen_ai.usage.output_tokens":de.usage.completionTokens}})),{...de,response:we}}})),R=await Promise.all(((K=L.toolCalls)!=null?K:[]).map(ye=>el({toolCall:ye,tools:t,repairToolCall:m,system:n,messages:O}))),B=t==null?[]:await Md({toolCalls:R,tools:t,tracer:U,telemetry:f,messages:O,abortSignal:l});let Y=Di(L.usage);pt=$i(pt,Y);let se="done";++H<c&&(d&&L.finishReason==="length"&&R.length===0?se="continue":R.length>0&&B.length===R.length&&(se="tool-result"));let pe=(Q=L.text)!=null?Q:"",Ie=qe==="continue"&&ze.trimEnd()!==ze?pe.trimStart():pe,dt=se==="continue"?Nd(Ie):Ie;if(ze=se==="continue"||qe==="continue"?ze+dt:dt,qe==="continue"){let ye=z[z.length-1];typeof ye.content=="string"?ye.content+=dt:ye.content.push({text:dt,type:"text"})}else z.push(...os({text:ze,tools:t??{},toolCalls:R,toolResults:B}));let zr={stepType:qe,text:dt,toolCalls:R,toolResults:B,finishReason:L.finishReason,usage:Y,warnings:L.warnings,logprobs:L.logprobs,request:(le=L.request)!=null?le:{},response:{...L.response,headers:(ge=L.rawResponse)==null?void 0:ge.headers,messages:JSON.parse(JSON.stringify(z))},experimental_providerMetadata:L.providerMetadata,isContinued:se==="continue"};Ut.push(zr),await h?.(zr),qe=se}while(qe!=="done");return W.setAttributes(Pe({telemetry:f,attributes:{"ai.response.finishReason":L.finishReason,"ai.response.text":{output:()=>L.text},"ai.response.toolCalls":{output:()=>JSON.stringify(L.toolCalls)},"ai.usage.promptTokens":L.usage.promptTokens,"ai.usage.completionTokens":L.usage.completionTokens}})),new Od({text:ze,output:p?.parseOutput({text:ze},{response:L.response,usage:pt}),toolCalls:R,toolResults:B,finishReason:L.finishReason,usage:pt,warnings:L.warnings,request:(te=L.request)!=null?te:{},response:{...L.response,headers:(re=L.rawResponse)==null?void 0:re.headers,messages:z},logprobs:L.logprobs,steps:Ut,providerMetadata:L.providerMetadata})}})}async function Md({toolCalls:e,tools:t,tracer:r,telemetry:n,messages:s,abortSignal:a}){return(await Promise.all(e.map(async({toolCallId:l,toolName:u,args:c})=>{let p=t[u];if(p?.execute==null)return;let d=await ar({name:"ai.toolCall",attributes:Pe({telemetry:n,attributes:{...sr({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":u,"ai.toolCall.id":l,"ai.toolCall.args":{output:()=>JSON.stringify(c)}}}),tracer:r,fn:async f=>{try{let v=await p.execute(c,{toolCallId:l,messages:s,abortSignal:a});try{f.setAttributes(Pe({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(v)}}}))}catch{}return v}catch(v){throw new Yi({toolName:u,toolArgs:c,cause:v})}}});return{toolCallId:l,toolName:u,args:c,result:d}}))).filter(l=>l!=null)}var Od=class{constructor(e){this.text=e.text,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.experimental_output=e.output}},Dd={};is(Dd,{object:()=>Ud,text:()=>$d});var $d=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parseOutput({text:e}){return e}}),Ud=({schema:e})=>{let t=$t(e);return{type:"object",responseFormat:({model:r})=>({type:"json",schema:r.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt({system:r,model:n}){return n.supportsStructuredOutputs?r:xd({prompt:r,schema:t.jsonSchema})},parseOutput({text:r},n){let s=bt({text:r});if(!s.success)throw new Qo({message:"No object generated: could not parse the response.",cause:s.error,text:r,response:n.response,usage:n.usage});let a=st({value:s.value,schema:t});if(!a.success)throw new Qo({message:"No object generated: response did not match schema.",cause:a.error,text:r,response:n.response,usage:n.usage});return a.value}}};function ls(e,t){let r=e.getReader(),n=t.getReader(),s,a,o=!1,l=!1;async function u(p){try{s==null&&(s=r.read());let d=await s;s=void 0,d.done?p.close():p.enqueue(d.value)}catch(d){p.error(d)}}async function c(p){try{a==null&&(a=n.read());let d=await a;a=void 0,d.done?p.close():p.enqueue(d.value)}catch(d){p.error(d)}}return new ReadableStream({async pull(p){try{if(o){await c(p);return}if(l){await u(p);return}s==null&&(s=r.read()),a==null&&(a=n.read());let{result:d,reader:f}=await Promise.race([s.then(v=>({result:v,reader:r})),a.then(v=>({result:v,reader:n}))]);d.done||p.enqueue(d.value),f===r?(s=void 0,d.done&&(await c(p),o=!0)):(a=void 0,d.done&&(l=!0,await u(p)))}catch(d){p.error(d)}},cancel(){r.cancel(),n.cancel()}})}function qd({tools:e,generatorStream:t,toolCallStreaming:r,tracer:n,telemetry:s,system:a,messages:o,abortSignal:l,repairToolCall:u}){let c=null,p=new ReadableStream({start(b){c=b}}),d={},f=new Set,v=!1,g;function m(){v&&f.size===0&&(g!=null&&c.enqueue(g),c.close())}let y=new TransformStream({async transform(b,h){let w=b.type;switch(w){case"text-delta":case"response-metadata":case"error":{h.enqueue(b);break}case"tool-call-delta":{r&&(d[b.toolCallId]||(h.enqueue({type:"tool-call-streaming-start",toolCallId:b.toolCallId,toolName:b.toolName}),d[b.toolCallId]=!0),h.enqueue({type:"tool-call-delta",toolCallId:b.toolCallId,toolName:b.toolName,argsTextDelta:b.argsTextDelta}));break}case"tool-call":{try{let _=await el({toolCall:b,tools:e,repairToolCall:u,system:a,messages:o});h.enqueue(_);let I=e[_.toolName];if(I.execute!=null){let S=ie();f.add(S),ar({name:"ai.toolCall",attributes:Pe({telemetry:s,attributes:{...sr({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":_.toolName,"ai.toolCall.id":_.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(_.args)}}}),tracer:n,fn:async j=>I.execute(_.args,{toolCallId:_.toolCallId,messages:o,abortSignal:l}).then(q=>{c.enqueue({..._,type:"tool-result",result:q}),f.delete(S),m();try{j.setAttributes(Pe({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(q)}}}))}catch{}},q=>{c.enqueue({type:"error",error:new Yi({toolName:_.toolName,toolArgs:_.args,cause:q})}),f.delete(S),m()})})}}catch(_){c.enqueue({type:"error",error:_})}break}case"finish":{g={type:"finish",finishReason:b.finishReason,logprobs:b.logprobs,usage:Di(b.usage),experimental_providerMetadata:b.providerMetadata};break}default:{let _=w;throw new Error(`Unhandled chunk type: ${_}`)}}},flush(){v=!0,m()}});return new ReadableStream({async start(b){return Promise.all([t.pipeThrough(y).pipeTo(new WritableStream({write(h){b.enqueue(h)},close(){}})),p.pipeTo(new WritableStream({write(h){b.enqueue(h)},close(){b.close()}}))])}})}var Ld=He({prefix:"aitxt",size:24});function Cn({model:e,tools:t,toolChoice:r,system:n,prompt:s,messages:a,maxRetries:o,abortSignal:l,headers:u,maxSteps:c=1,experimental_continueSteps:p=!1,experimental_telemetry:d,experimental_providerMetadata:f,experimental_toolCallStreaming:v=!1,experimental_activeTools:g,experimental_repairToolCall:m,experimental_transform:y,onChunk:b,onFinish:h,onStepFinish:w,_internal:{now:_=Td,generateId:I=Ld,currentDate:S=()=>new Date}={},...j}){return new Fd({model:e,telemetry:d,headers:u,settings:j,maxRetries:o,abortSignal:l,system:n,prompt:s,messages:a,tools:t,toolChoice:r,toolCallStreaming:v,transform:y?.({tools:t}),activeTools:g,repairToolCall:m,maxSteps:c,continueSteps:p,providerMetadata:f,onChunk:b,onFinish:h,onStepFinish:w,now:_,currentDate:S,generateId:I})}var Fd=class{constructor({model:e,telemetry:t,headers:r,settings:n,maxRetries:s,abortSignal:a,system:o,prompt:l,messages:u,tools:c,toolChoice:p,toolCallStreaming:d,transform:f,activeTools:v,repairToolCall:g,maxSteps:m,continueSteps:y,providerMetadata:b,onChunk:h,onFinish:w,onStepFinish:_,now:I,currentDate:S,generateId:j}){if(this.warningsPromise=new Ze,this.usagePromise=new Ze,this.finishReasonPromise=new Ze,this.providerMetadataPromise=new Ze,this.textPromise=new Ze,this.toolCallsPromise=new Ze,this.toolResultsPromise=new Ze,this.requestPromise=new Ze,this.responsePromise=new Ze,this.stepsPromise=new Ze,m<1)throw new Re({parameter:"maxSteps",value:m,message:"maxSteps must be at least 1"});let q="",U="",W="",K,Q={id:j(),timestamp:S(),modelId:e.modelId,messages:[]},le=[],ge=[],te,re,ae,Ce="initial",L=[],R,B=new TransformStream({async transform(O,_e){if(_e.enqueue(O),(O.type==="text-delta"||O.type==="tool-call"||O.type==="tool-result"||O.type==="tool-call-streaming-start"||O.type==="tool-call-delta")&&await h?.({chunk:O}),O.type==="text-delta"&&(q+=O.textDelta,U+=O.textDelta,W+=O.textDelta),O.type==="tool-call"&&le.push(O),O.type==="tool-result"&&ge.push(O),O.type==="step-finish"){let Y=os({text:U,tools:c??{},toolCalls:le,toolResults:ge}),se=L.length,pe="done";se+1<m&&(y&&O.finishReason==="length"&&le.length===0?pe="continue":le.length>0&&ge.length===le.length&&(pe="tool-result"));let Ie={stepType:Ce,text:q,toolCalls:le,toolResults:ge,finishReason:O.finishReason,usage:O.usage,warnings:O.warnings,logprobs:O.logprobs,request:O.request,response:{...O.response,messages:[...Q.messages,...Y]},experimental_providerMetadata:O.experimental_providerMetadata,isContinued:O.isContinued};await _?.(Ie),L.push(Ie),le=[],ge=[],q="",K=O.request,pe!=="done"&&(Ce=pe),pe!=="continue"&&(Q.messages.push(...Y),U="")}O.type==="finish"&&(Q.id=O.response.id,Q.timestamp=O.response.timestamp,Q.modelId=O.response.modelId,Q.headers=O.response.headers,re=O.usage,te=O.finishReason,ae=O.experimental_providerMetadata)},async flush(O){var _e;try{let Y=L[L.length-1];Y&&(oe.warningsPromise.resolve(Y.warnings),oe.requestPromise.resolve(Y.request),oe.responsePromise.resolve(Y.response),oe.toolCallsPromise.resolve(Y.toolCalls),oe.toolResultsPromise.resolve(Y.toolResults),oe.providerMetadataPromise.resolve(Y.experimental_providerMetadata));let se=te??"unknown",pe=re??{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};oe.finishReasonPromise.resolve(se),oe.usagePromise.resolve(pe),oe.textPromise.resolve(W),oe.stepsPromise.resolve(L),await w?.({finishReason:se,logprobs:void 0,usage:pe,text:W,toolCalls:Y.toolCalls,toolResults:Y.toolResults,request:(_e=Y.request)!=null?_e:{},response:Y.response,warnings:Y.warnings,experimental_providerMetadata:Y.experimental_providerMetadata,steps:L}),R.setAttributes(Pe({telemetry:t,attributes:{"ai.response.finishReason":se,"ai.response.text":{output:()=>W},"ai.response.toolCalls":{output:()=>{var Ie;return(Ie=Y.toolCalls)!=null&&Ie.length?JSON.stringify(Y.toolCalls):void 0}},"ai.usage.promptTokens":pe.promptTokens,"ai.usage.completionTokens":pe.completionTokens}}))}catch(Y){O.error(Y)}finally{R.end()}}}),H=kd();this.addStream=H.addStream,this.closeStream=H.close,this.baseStream=(f?H.stream.pipeThrough(f):H.stream).pipeThrough(B);let{maxRetries:z,retry:ze}=mi({maxRetries:s}),Ut=hi(t),pt=fi({model:e,telemetry:t,headers:r,settings:{...n,maxRetries:z}}),qe=Oi({prompt:{system:o,prompt:l,messages:u},tools:c}),oe=this;ar({name:"ai.streamText",attributes:Pe({telemetry:t,attributes:{...sr({operationId:"ai.streamText",telemetry:t}),...pt,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:l,messages:u})},"ai.settings.maxSteps":m}}),tracer:Ut,endWhenDone:!1,fn:async O=>{R=O;async function _e({currentStep:Y,responseMessages:se,usage:pe,stepType:Ie,previousStepText:dt,hasLeadingWhitespace:zr}){let ye=se.length===0?qe.type:"messages",mt=[...qe.messages,...se],lr=await Ai({prompt:{type:ye,system:qe.system,messages:mt},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:e.supportsUrl}),ft={type:"regular",...Xi({tools:c,toolChoice:p,activeTools:v})},{result:{stream:Br,warnings:Hr,rawResponse:ht,request:de},doStreamSpan:we,startTimestampMs:ps}=await ze(()=>ar({name:"ai.streamText.doStream",attributes:Pe({telemetry:t,attributes:{...sr({operationId:"ai.streamText.doStream",telemetry:t}),...pt,"ai.prompt.format":{input:()=>ye},"ai.prompt.messages":{input:()=>JSON.stringify(lr)},"ai.prompt.tools":{input:()=>{var G;return(G=ft.tools)==null?void 0:G.map(ue=>JSON.stringify(ue))}},"ai.prompt.toolChoice":{input:()=>ft.toolChoice!=null?JSON.stringify(ft.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":n.frequencyPenalty,"gen_ai.request.max_tokens":n.maxTokens,"gen_ai.request.presence_penalty":n.presencePenalty,"gen_ai.request.stop_sequences":n.stopSequences,"gen_ai.request.temperature":n.temperature,"gen_ai.request.top_k":n.topK,"gen_ai.request.top_p":n.topP}}),tracer:Ut,endWhenDone:!1,fn:async G=>({startTimestampMs:I(),doStreamSpan:G,result:await e.doStream({mode:ft,...Ri(n),inputFormat:ye,prompt:lr,providerMetadata:b,abortSignal:a,headers:r})})})),ll=qd({tools:c,generatorStream:Br,toolCallStreaming:d,tracer:Ut,telemetry:t,system:o,messages:mt,repairToolCall:g,abortSignal:a}),ul=de??{},gt=[],In=[],yt="unknown",et={promptTokens:0,completionTokens:0,totalTokens:0},En,ds=!0,ur="",ms=Ie==="continue"?dt:"",An,Ne={id:j(),timestamp:S(),modelId:e.modelId},qt="",fs=!1,hs=!0,gs=!1;async function Rn({controller:G,chunk:ue}){G.enqueue(ue),ur+=ue.textDelta,ms+=ue.textDelta,fs=!0,gs=ue.textDelta.trimEnd()!==ue.textDelta}oe.addStream(ll.pipeThrough(new TransformStream({async transform(G,ue){var Be,cr,vt;if(ds){let Le=I()-ps;ds=!1,we.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Le}),we.setAttributes({"ai.response.msToFirstChunk":Le})}if(G.type==="text-delta"&&G.textDelta.length===0)return;let ys=G.type;switch(ys){case"text-delta":{if(y){let Le=hs&&zr?G.textDelta.trimStart():G.textDelta;if(Le.length===0)break;hs=!1,qt+=Le;let Gr=Qi(qt);Gr!=null&&(qt=Gr.suffix,await Rn({controller:ue,chunk:{type:"text-delta",textDelta:Gr.prefix+Gr.whitespace}}))}else await Rn({controller:ue,chunk:G});break}case"tool-call":{ue.enqueue(G),gt.push(G);break}case"tool-result":{ue.enqueue(G),In.push(G);break}case"response-metadata":{Ne={id:(Be=G.id)!=null?Be:Ne.id,timestamp:(cr=G.timestamp)!=null?cr:Ne.timestamp,modelId:(vt=G.modelId)!=null?vt:Ne.modelId};break}case"finish":{et=G.usage,yt=G.finishReason,En=G.experimental_providerMetadata,An=G.logprobs;let Le=I()-ps;we.addEvent("ai.stream.finish"),we.setAttributes({"ai.response.msToFinish":Le,"ai.response.avgCompletionTokensPerSecond":1e3*et.completionTokens/Le});break}case"tool-call-streaming-start":case"tool-call-delta":{ue.enqueue(G);break}case"error":{ue.enqueue(G),yt="error";break}default:{let Le=ys;throw new Error(`Unknown chunk type: ${Le}`)}}},async flush(G){let ue=gt.length>0?JSON.stringify(gt):void 0,Be="done";Y+1<m&&(y&&yt==="length"&&gt.length===0?Be="continue":gt.length>0&&In.length===gt.length&&(Be="tool-result")),y&&qt.length>0&&(Be!=="continue"||Ie==="continue"&&!fs)&&(await Rn({controller:G,chunk:{type:"text-delta",textDelta:qt}}),qt="");try{we.setAttributes(Pe({telemetry:t,attributes:{"ai.response.finishReason":yt,"ai.response.text":{output:()=>ur},"ai.response.toolCalls":{output:()=>ue},"ai.response.id":Ne.id,"ai.response.model":Ne.modelId,"ai.response.timestamp":Ne.timestamp.toISOString(),"ai.usage.promptTokens":et.promptTokens,"ai.usage.completionTokens":et.completionTokens,"gen_ai.response.finish_reasons":[yt],"gen_ai.response.id":Ne.id,"gen_ai.response.model":Ne.modelId,"gen_ai.usage.input_tokens":et.promptTokens,"gen_ai.usage.output_tokens":et.completionTokens}}))}catch{}finally{we.end()}G.enqueue({type:"step-finish",finishReason:yt,usage:et,experimental_providerMetadata:En,logprobs:An,request:ul,response:{...Ne,headers:ht?.headers},warnings:Hr,isContinued:Be==="continue"});let cr=$i(pe,et);if(Be==="done")G.enqueue({type:"finish",finishReason:yt,usage:cr,experimental_providerMetadata:En,logprobs:An,response:{...Ne,headers:ht?.headers}}),oe.closeStream();else{if(Ie==="continue"){let vt=se[se.length-1];typeof vt.content=="string"?vt.content+=ur:vt.content.push({text:ur,type:"text"})}else se.push(...os({text:ur,tools:c??{},toolCalls:gt,toolResults:In}));await _e({currentStep:Y+1,responseMessages:se,usage:cr,stepType:Be,previousStepText:ms,hasLeadingWhitespace:gs})}}})))}await _e({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1})}}).catch(O=>{oe.addStream(new ReadableStream({start(_e){_e.enqueue({type:"error",error:O}),_e.close()}})),oe.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return ri(this.teeStream(),{transform(e,t){e.type==="text-delta"?t.enqueue(e.textDelta):e.type==="error"&&t.error(e.error)}})}get fullStream(){return ri(this.teeStream(),{transform(e,t){t.enqueue(e)}})}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0}={}){let r="",n=new TransformStream({async transform(a,o){o.enqueue(a),a.type==="text-delta"&&(r+=a.textDelta)}}),s=new TransformStream({transform:async(a,o)=>{let l=a.type;switch(l){case"text-delta":{o.enqueue(Se("text",a.textDelta));break}case"tool-call-streaming-start":{o.enqueue(Se("tool_call_streaming_start",{toolCallId:a.toolCallId,toolName:a.toolName}));break}case"tool-call-delta":{o.enqueue(Se("tool_call_delta",{toolCallId:a.toolCallId,argsTextDelta:a.argsTextDelta}));break}case"tool-call":{o.enqueue(Se("tool_call",{toolCallId:a.toolCallId,toolName:a.toolName,args:a.args}));break}case"tool-result":{o.enqueue(Se("tool_result",{toolCallId:a.toolCallId,result:a.result}));break}case"error":{o.enqueue(Se("error",e(a.error)));break}case"step-finish":{o.enqueue(Se("finish_step",{finishReason:a.finishReason,usage:t?{promptTokens:a.usage.promptTokens,completionTokens:a.usage.completionTokens}:void 0,isContinued:a.isContinued}));break}case"finish":{o.enqueue(Se("finish_message",{finishReason:a.finishReason,usage:t?{promptTokens:a.usage.promptTokens,completionTokens:a.usage.completionTokens}:void 0}));break}default:{let u=l;throw new Error(`Unknown chunk type: ${u}`)}}}});return this.fullStream.pipeThrough(n).pipeThrough(s)}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:n,data:s,getErrorMessage:a,sendUsage:o}={}){Yo({response:e,status:t,statusText:r,headers:Ko(n,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:s,getErrorMessage:a,sendUsage:o})})}pipeTextStreamToResponse(e,t){Yo({response:e,status:t?.status,statusText:t?.statusText,headers:Ko(t?.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:e?.getErrorMessage,sendUsage:e?.sendUsage}).pipeThrough(new TextEncoderStream);return e?.data?ls(e?.data.stream,t):t}mergeIntoDataStream(e){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:n,getErrorMessage:s,sendUsage:a}={}){return new Response(this.toDataStream({data:n,getErrorMessage:s,sendUsage:a}),{status:t,statusText:r,headers:Tn(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:(t=e?.status)!=null?t:200,headers:Tn(e?.headers,{contentType:"text/plain; charset=utf-8"})})}};var Jd="AI_NoSuchProviderError",Vd=`vercel.ai.error.${Jd}`,Zd=Symbol.for(Vd),zd;zd=Zd;var Bd={};is(Bd,{mergeIntoDataStream:()=>Wd,toDataStream:()=>Hd,toDataStreamResponse:()=>Gd});function rl(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(n,s){s.enqueue(t.encode(n)),r+=n,e.onToken&&await e.onToken(n),e.onText&&typeof n=="string"&&await e.onText(n)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function us(e,t){return e.pipeThrough(new TransformStream({transform:async(r,n)=>{var s;if(typeof r=="string"){n.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&ai((s=r.data)==null?void 0:s.chunk,n);return}ai(r,n)}})).pipeThrough(rl(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,n)=>{n.enqueue(Se("text",r))}}))}function Hd(e,t){return us(e,t).pipeThrough(new TextEncoderStream)}function Gd(e,t){var r;let n=us(e,t?.callbacks).pipeThrough(new TextEncoderStream),s=t?.data,a=t?.init,o=s?ls(s.stream,n):n;return new Response(o,{status:(r=a?.status)!=null?r:200,statusText:a?.statusText,headers:Tn(a?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Wd(e,t){t.dataStream.merge(us(e,t.callbacks))}function ai(e,t){if(typeof e.content=="string")t.enqueue(e.content);else{let r=e.content;for(let n of r)n.type==="text"&&t.enqueue(n.text)}}var Kd={};is(Kd,{mergeIntoDataStream:()=>Qd,toDataStream:()=>Yd,toDataStreamResponse:()=>Xd});function cs(e,t){let r=em();return ga(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(n,s){s.enqueue(r(n.delta))}})).pipeThrough(rl(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,s)=>{s.enqueue(Se("text",n))}}))}function Yd(e,t){return cs(e,t).pipeThrough(new TextEncoderStream)}function Xd(e,t={}){var r;let{init:n,data:s,callbacks:a}=t,o=cs(e,a).pipeThrough(new TextEncoderStream),l=s?ls(s.stream,o):o;return new Response(l,{status:(r=n?.status)!=null?r:200,statusText:n?.statusText,headers:Tn(n?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Qd(e,t){t.dataStream.merge(cs(e,t.callbacks))}function em(){let e=!0;return t=>(e&&(t=t.trimStart(),t&&(e=!1)),t)}var Jb=15*1e3;async function nl(e,t){if(t.apiBaseUrl?.includes("openai.azure.com")){let r=t.apiBaseUrl.split(".")[0].split("//")[1],n=t.apiBaseUrl.split("/")[t.apiBaseUrl.split("/").length-1];e.model=n;let s=xr({resourceName:r,apiKey:t.apiKey});e.apiChat=s.chat(n)}else{let r=kr({baseURL:t.apiBaseUrl,apiKey:t.apiKey,organization:t.organization});e.apiChat=r.chat(e.model?e.model:"gpt-4o")}}async function sl(e,t,r){if(!e.apiChat)throw new Error("apiChat is undefined");try{if(Ue.appendLine(`INFO: chatgpt.model: ${e.model} chatgpt.question: ${t}`),e.model?.startsWith("o1")){e.chatHistory.length<=1&&e.chatHistory.push({role:"user",content:t}),e.chatHistory.push({role:"user",content:e.modelConfig.systemPrompt});let a=await tl({model:e.apiChat,messages:e.chatHistory});r(a.text),e.response=a.text,e.chatHistory.push({role:"assistant",content:a.text}),Ue.appendLine(`INFO: chatgpt.response: ${e.response}`);return}let n=[];e.chatHistory.push({role:"user",content:t});let s=await Cn({system:e.modelConfig.systemPrompt,model:e.apiChat,messages:e.chatHistory,maxTokens:e.modelConfig.maxTokens,topP:e.modelConfig.topP,temperature:e.modelConfig.temperature});for await(let a of s.textStream)r(a),n.push(a);e.response=n.join(""),e.chatHistory.push({role:"assistant",content:n.join("")}),Ue.appendLine(`INFO: chatgpt.response: ${e.response}`)}catch(n){throw Ue.appendLine(`ERROR: chatgpt.model: ${e.model} response: ${n}`),n}}function al(e,t){if(t.apiBaseUrl?.includes("openai.azure.com")){let r=t.apiBaseUrl.split(".")[0].split("//")[1],n=t.apiBaseUrl.split("/")[t.apiBaseUrl.split("/").length-1];e.model=n;let s=xr({resourceName:r,apiKey:t.apiKey});e.apiCompletion=s.completion(n)}else{let r=kr({baseURL:t.apiBaseUrl,apiKey:t.apiKey,organization:t.organization});e.apiCompletion=r.completion(e.model?e.model:"gpt-4o")}}async function ol(e,t,r){if(!e.apiCompletion)throw new Error("apiCompletion is not defined");Ue.appendLine(`INFO: chatgpt.model: ${e.model} chatgpt.question: ${t}`),e.chatHistory.push({role:"user",content:t});let n="";for(let o of e.chatHistory)n+=`${o.role==="user"?"Human:":"AI:"} ${o.content}
`;n+="AI: ";let s=await Cn({system:e.modelConfig.systemPrompt,model:e.apiCompletion,prompt:n,maxTokens:e.modelConfig.maxTokens,topP:e.modelConfig.topP,temperature:e.modelConfig.temperature}),a=[];for await(let o of s.textStream)r(o),a.push(o);e.response=a.join(""),e.chatHistory.push({role:"assistant",content:a.join("")}),Ue.appendLine(`INFO: chatgpt.response: ${e.response}`)}var Ue=F.window.createOutputChannel("ChatGPT Copilot"),tm=`Your task is to embody the role of an intelligent, helpful, and expert developer.
You MUST provide accurate and truthful answers, adhering strictly to the instructions given.
Your responses should be styled using Github Flavored Markdown for elements such as headings,
lists, colored text, code blocks, and highlights. However, you MUST NOT mention markdown or
styling directly in your response. Utilize available tools to supplement your knowledge
where necessary. Respond in the same language as the query, unless otherwise specified by the user.`,Zr=class{constructor(t){this.context=t;this.questionCounter=0;this.inProgress=!1;this.currentMessageId="";this.response="";this.chatHistory=[];this.subscribeToResponse=F.workspace.getConfiguration("chatgpt").get("response.showNotification")||!1,this.autoScroll=!!F.workspace.getConfiguration("chatgpt").get("response.autoScroll"),this.model=F.workspace.getConfiguration("chatgpt").get("gpt3.model"),this.model=="custom"&&(this.model=F.workspace.getConfiguration("chatgpt").get("gpt3.customModel")),this.apiBaseUrl=F.workspace.getConfiguration("chatgpt").get("gpt3.apiBaseUrl"),this.apiBaseUrl?.includes("azure")&&(this.model=this.model?.replace(".",""))}resolveWebviewView(t,r,n){this.webView=t,t.webview.options={enableScripts:!0,localResourceRoots:[this.context.extensionUri]},t.webview.html=this.getWebviewHtml(t.webview),t.webview.onDidReceiveMessage(async s=>{switch(s.type){case"addFreeTextQuestion":this.sendApiRequest(s.value,{command:"freeText"});break;case"editCode":let a=s.value.replace(/\$/g,"\\$");F.window.activeTextEditor?.insertSnippet(new F.SnippetString(a)),this.logEvent("code-inserted");break;case"openNew":let o=await F.workspace.openTextDocument({content:s.value,language:s.language});F.window.showTextDocument(o),this.logEvent(s.language==="markdown"?"code-exported":"code-opened");break;case"clearConversation":this.conversationId=void 0,this.chatHistory=[],this.logEvent("conversation-cleared");break;case"clearBrowser":this.logEvent("browser-cleared");break;case"cleargpt3":this.apiCompletion=void 0,this.apiChat=void 0,this.logEvent("gpt3-cleared");break;case"login":this.prepareConversation().then(l=>{l&&(this.sendMessage({type:"loginSuccessful",showConversations:!1},!0),this.logEvent("logged-in"))});break;case"openSettings":F.commands.executeCommand("workbench.action.openSettings","@ext:feiskyer.chatgpt-copilot chatgpt."),this.logEvent("settings-opened");break;case"openSettingsPrompt":F.commands.executeCommand("workbench.action.openSettings","@ext:feiskyer.chatgpt-copilot promptPrefix"),this.logEvent("settings-prompt-opened");break;case"listConversations":this.logEvent("conversations-list-attempted");break;case"showConversation":break;case"stopGenerating":this.stopGenerating();break;case"selectPrompt":this.modelConfig.systemPrompt=s.prompt.content,await this.prepareConversation(!0);break;case"togglePromptManager":await F.commands.executeCommand("chatgpt-copilot.togglePromptManager");break;case"searchPrompts":await this.handlePromptSearch(s.query,s.responseType);break;default:break}}),this.leftOverMessage!=null&&(this.sendMessage(this.leftOverMessage),this.leftOverMessage=null)}stopGenerating(){this.abortController?.abort?.(),this.inProgress=!1,this.sendMessage({type:"showInProgress",inProgress:this.inProgress});let t=!this.isCodexModel;this.sendMessage({type:"addResponse",value:this.response,done:!0,id:this.currentMessageId,autoScroll:this.autoScroll,responseInMarkdown:t}),this.logEvent("stopped-generating")}clearSession(){this.stopGenerating(),this.apiChat=void 0,this.apiCompletion=void 0,this.conversationId=void 0,this.logEvent("cleared-session")}get isCodexModel(){return this.model==null?!1:this.model.includes("instruct")||this.model.includes("code-")}get isGpt35Model(){return!this.isCodexModel&&!this.isClaude&&!this.isGemini}get isClaude(){return!!this.model?.startsWith("claude-")}get isGemini(){return!!this.model?.startsWith("gemini-")||!!this.model?.startsWith("learnlm")}async prepareConversation(t=!1){this.conversationId=this.conversationId||this.getRandomId();let r=this.context.globalState,n=F.workspace.getConfiguration("chatgpt");if(this.model=="custom"&&(this.model=n.get("gpt3.customModel")),this.isGpt35Model&&!this.apiChat||this.isClaude&&!this.apiChat||this.isGemini&&!this.apiChat||!this.isGpt35Model&&!this.isClaude&&!this.isGemini&&!this.apiCompletion||t){let s=n.get("gpt3.apiKey")||r.get("chatgpt-gpt3-apiKey"),a=n.get("gpt3.organization"),o=n.get("gpt3.maxTokens"),l=n.get("gpt3.temperature"),u=n.get("gpt3.top_p"),c=n.get("gpt3.searchGrounding.enabled"),p=n.get("systemPrompt");p||(p=tm);let d=n.get("gpt3.apiBaseUrl");if(!d&&this.isGpt35Model&&(d="https://api.openai.com/v1"),(!d||d=="https://api.openai.com/v1")&&(this.isClaude?d="https://api.anthropic.com/v1":this.isGemini&&(d="https://generativelanguage.googleapis.com/v1beta")),!s&&process.env.OPENAI_API_KEY!=null&&(s=process.env.OPENAI_API_KEY,this.logEvent("api key loaded from environment variable")),!s)return F.window.showErrorMessage("Please add your API Key to use OpenAI official APIs. Storing the API Key in Settings is discouraged due to security reasons, though you can still opt-in to use it to persist it in settings. Instead you can also temporarily set the API Key one-time: You will need to re-enter after restarting the vs-code.","Store in session (Recommended)","Open settings").then(async f=>{if(f==="Open settings")return F.commands.executeCommand("workbench.action.openSettings","chatgpt.gpt3.apiKey"),!1;f==="Store in session (Recommended)"&&await F.window.showInputBox({title:"Store OpenAI API Key in session",prompt:"Please enter your OpenAI API Key to store in your session only. This option won't persist the token on your settings.json file. You may need to re-enter after restarting your VS-Code",ignoreFocusOut:!0,placeHolder:"API Key",value:s||""}).then(v=>{v&&(s=v,r.update("chatgpt-gpt3-apiKey",s),this.sendMessage({type:"loginSuccessful"},!0))})}),!1;this.modelConfig=new un({apiKey:s,apiBaseUrl:d,maxTokens:o,temperature:l,topP:u,organization:a,systemPrompt:p,searchGrounding:c}),this.isGpt35Model?await nl(this,this.modelConfig):this.isClaude?await Ma(this,this.modelConfig):this.isGemini?await Ja(this,this.modelConfig):al(this,this.modelConfig)}return this.sendMessage({type:"loginSuccessful"},!0),!0}processQuestion(t,r,n){return r!=null&&(t=`${t}${n?` (The following code is in ${n} programming language)`:""}: ${r}`),t+`\r
`}async sendApiRequest(t,r){if(this.inProgress||(this.questionCounter++,this.logEvent("api-request-sent",{"chatgpt.command":r.command,"chatgpt.hasCode":String(!!r.code),"chatgpt.hasPreviousAnswer":String(!!r.previousAnswer)}),!await this.prepareConversation()))return;this.response="";let n=this.processQuestion(t,r.code,r.language);this.webView==null?F.commands.executeCommand("chatgpt-copilot.view.focus"):this.webView?.show?.(!0),this.inProgress=!0,this.abortController=new AbortController,this.sendMessage({type:"showInProgress",inProgress:this.inProgress,showStopButton:!0}),this.currentMessageId=this.getRandomId(),this.sendMessage({type:"addQuestion",value:t,code:r.code,autoScroll:this.autoScroll});let s=!this.isCodexModel,a=o=>{this.response+=o,this.sendMessage({type:"addResponse",value:this.response,id:this.currentMessageId,messageId:this.currentMessageId,autoScroll:this.autoScroll,responseInMarkdown:s})};try{this.isGpt35Model||this.isClaude||this.isGemini?await sl(this,n,a):await ol(this,n,a),r.previousAnswer!=null&&(this.response=r.previousAnswer+this.response),this.response.split("```").length%2===0&&(this.response=this.response+" \r\n ```\r\n",F.window.showInformationMessage("It looks like ChatGPT didn't complete their answer for your coding question. You can ask it to continue and combine the answers.","Continue and combine answers").then(async l=>{l==="Continue and combine answers"&&this.sendApiRequest("Continue",{command:r.command,code:void 0,previousAnswer:this.response})})),this.sendMessage({type:"addResponse",value:this.response,done:!0,id:this.currentMessageId,autoScroll:this.autoScroll,responseInMarkdown:s}),this.subscribeToResponse&&F.window.showInformationMessage("ChatGPT responded to your question.","Open conversation").then(async()=>{await F.commands.executeCommand("chatgpt-copilot.view.focus")})}catch(o){let l,u=o?.response?.data?.error?.message||o?.tostring?.()||o?.message||o?.name;this.logError("api-request-failed"),o?.response?.status||o?.response?.statusText?(l=`${o?.response?.status||""} ${o?.response?.statusText||""}`,F.window.showErrorMessage("An error occured. If this is due to max_token you could try `ChatGPT: Clear Conversation` command and retry sending your prompt.","Clear conversation and retry").then(async c=>{c==="Clear conversation and retry"&&(await F.commands.executeCommand("chatgpt-copilot.clearConversation"),await _s(250),this.sendApiRequest(t,{command:r.command,code:r.code}))})):o.statusCode===400?l=`Your model: '${this.model}' may be incompatible or one of your parameters is unknown. Reset your settings to default. (HTTP 400 Bad Request)`:o.statusCode===401?l=`Make sure you are properly signed in. If you are using Browser Auto-login method, make sure the browser is open (You could refresh the browser tab manually if you face any issues, too). If you stored your API key in settings.json, make sure it is accurate. If you stored API key in session, you can reset it with \`ChatGPT: Reset session\` command. (HTTP 401 Unauthorized) Potential reasons: \r
- 1.Invalid Authentication\r
- 2.Incorrect API key provided.\r
- 3.Incorrect Organization provided. \r
 See https://platform.openai.com/docs/guides/error-codes for more details.`:o.statusCode===403?l="Your token has expired. Please try authenticating again. (HTTP 403 Forbidden)":o.statusCode===404?l=`Your model: '${this.model}' may be incompatible or you may have exhausted your ChatGPT subscription allowance. (HTTP 404 Not Found)`:o.statusCode===429?l=`Too many requests try again later. (HTTP 429 Too Many Requests) Potential reasons: \r
 1. You exceeded your current quota, please check your plan and billing details\r
 2. You are sending requests too quickly \r
 3. The engine is currently overloaded, please try again later. \r
 See https://platform.openai.com/docs/guides/error-codes for more details.`:o.statusCode===500&&(l=`The server had an error while processing your request, please try again. (HTTP 500 Internal Server Error)\r
 See https://platform.openai.com/docs/guides/error-codes for more details.`),u&&(l=`${l?l+" ":""} ${u}`),this.sendMessage({type:"addError",value:l,autoScroll:this.autoScroll});return}finally{this.inProgress=!1,this.sendMessage({type:"showInProgress",inProgress:this.inProgress})}}sendMessage(t,r){this.webView?this.webView?.webview.postMessage(t):r||(this.leftOverMessage=t)}logEvent(t,r){r!=null?Ue.appendLine(`INFO ${t} chatgpt.model:${this.model} chatgpt.questionCounter:${this.questionCounter} ${JSON.stringify(r)}`):Ue.appendLine(`INFO ${t} chatgpt.model:${this.model}`)}logError(t){Ue.appendLine(`ERR ${t} chatgpt.model:${this.model}`)}getWebviewHtml(t){let r=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","main.js")),n=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","main.css")),s=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","highlight.min.css")),a=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","hjquery-ui.css")),o=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","highlight.min.js")),l=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","jquery-ui.min.js")),u=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","jquery-3.5.1.min.js")),c=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","marked.min.js")),p=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","tailwindcss.3.2.4.min.js")),d=t.asWebviewUri(F.Uri.joinPath(this.context.extensionUri,"media","vendor","turndown.js")),f=this.getRandomId();return`<!DOCTYPE html>
			<html lang="en">
			<head>
				<meta charset="UTF-8">
				<meta name="viewport" content="width=device-width, initial-scale=1.0">

				<link href="${n}" rel="stylesheet">
				<link href="${s}" rel="stylesheet">
        <link href="${a}" rel="stylesheet">
				<script src="${o}"></script>
				<script src="${c}"></script>
				<script src="${p}"></script>
				<script src="${d}"></script>
        <script src="${u}"></script>
        <script src="${l}"></script>
			</head>
			<body class="overflow-hidden">
				<div class="flex flex-col h-screen">
					<div class="absolute top-2 right-2 z-10">
						<button id="toggle-prompt-manager" class="p-1.5 rounded-lg" title="Manage Prompts">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
								<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
							</svg>
						</button>
					</div>

					<div id="introduction" class="flex flex-col justify-between h-full justify-center px-6 w-full relative login-screen overflow-auto">
						<div class="flex items-start text-center features-block my-5">
							<div class="flex flex-col gap-3.5 flex-1">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="w-6 h-6 m-auto">
									<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"></path>
								</svg>
								<h2>Features</h2>
								<ul class="flex flex-col gap-3.5 text-xs">
									<li class="features-li w-full border border-zinc-700 p-3 rounded-md">Chat with your code and documents in conversations</li>
                  <li class="features-li w-full border border-zinc-700 p-3 rounded-md">Prompt manager and chat with your own prompts (use # to search)</li>
									<li class="features-li w-full border border-zinc-700 p-3 rounded-md">Improve your code, add tests & find bugs</li>
									<li class="features-li w-full border border-zinc-700 p-3 rounded-md">Copy or create new files automatically</li>
									<li class="features-li w-full border border-zinc-700 p-3 rounded-md">Syntax highlighting with auto language detection</li>
								</ul>
							</div>
						</div>
						<div class="flex flex-col gap-4 h-full items-center justify-end text-center">
							<p class="max-w-sm text-center text-xs text-slate-500">
								<a title="" id="settings-button" href="#">Update settings</a>&nbsp; | &nbsp;<a title="" id="settings-prompt-button" href="#">Update prompts</a>
							</p>
						</div>
					</div>

          <style>
            /* Customize the dropdown menu */
            .ui-autocomplete {
                background-color: #484a44;
                color: #ffffff;
                border: 1px solid #1f241f;
                width: 200px;
            }

            /* Customize each item in the menu */
            .ui-menu-item {
                padding: 5px 10px;
            }

            /* Customize the item that is currently selected or being hovered over */
            .ui-menu-item.ui-state-focus {
                background-color: #808080 !important;
            }
            .ui-menu-item .ui-menu-item-wrapper.ui-state-active {
                background-color: #808080 !important;
            }
          </style>

					<div class="flex-1 overflow-y-auto" id="qa-list"></div>

					<div class="flex-1 overflow-y-auto hidden" id="conversation-list"></div>

					<div id="in-progress" class="pl-4 pt-2 flex items-center hidden">
						<div class="typing">Thinking</div>
						<div class="spinner">
							<div class="bounce1"></div>
							<div class="bounce2"></div>
							<div class="bounce3"></div>
						</div>

						<button id="stop-button" class="btn btn-primary flex items-end p-1 pr-2 rounded-md ml-5">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15m0 0L7.5 12m4.5 4.5V3" /></svg>Stop responding</button>
					</div>

					<div class="p-4 flex items-center pt-2">
						<div class="flex-1 textarea-wrapper">
							<textarea
								type="text"
								rows="1"
								id="question-input"
								placeholder="Ask a question..."
								onInput="this.parentNode.dataset.replicatedValue = this.value"></textarea>
						</div>
						<div id="chat-button-wrapper" class="absolute bottom-14 items-center more-menu right-8 border border-gray-200 shadow-xl hidden text-xs">
							<button class="flex gap-2 items-center justify-start p-2 w-full" id="clear-button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" /></svg>&nbsp;New chat</button>
							<button class="flex gap-2 items-center justify-start p-2 w-full" id="settings-button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>&nbsp;Update settings</button>
							<button class="flex gap-2 items-center justify-start p-2 w-full" id="export-button"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>&nbsp;Export to markdown</button>
						</div>
						<div id="question-input-buttons" class="right-6 absolute p-0.5 ml-5 flex items-center gap-2">
							<button id="more-button" title="More actions" class="rounded-lg p-0.5">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" /></svg>
							</button>

							<button id="ask-button" title="Submit prompt" class="ask-button rounded-lg p-0.5">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" /></svg>
							</button>
						</div>
					</div>
				</div>

				<script nonce="${f}" src="${r}"></script>
			</body>
			</html>`}getRandomId(){let t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}async handlePromptSearch(t,r){console.log("Searching prompts:",t);let n=this.context.globalState.get("prompts",{prompts:[]});if(!n.prompts||n.prompts.length===0){r==="titles"?this.sendMessage({type:"promptTitles",titles:[],isEmpty:!0}):this.sendMessage({type:"showPromptPicker",prompts:[],isEmpty:!0});return}let s=t.toLowerCase(),a=n.prompts.filter(o=>o.name.toLowerCase().includes(s)||o.content.toLowerCase().includes(s));r==="titles"?this.sendMessage({type:"promptTitles",titles:a.map(o=>({id:o.id,name:o.name,content:o.content}))}):this.sendMessage({type:"showPromptPicker",prompts:a})}};var or=Kr(require("vscode"));var ir=class{constructor(t){this.context=t;this.store={prompts:[]};this.loadPrompts()}loadPrompts(){this.store=this.context.globalState.get("prompts",{prompts:[]})}savePrompts(){console.log("Saving prompts:",this.store),this.context.globalState.update("prompts",this.store)}resolveWebviewView(t,r,n){this.webView=t,t.webview.options={enableScripts:!0,localResourceRoots:[this.context.extensionUri]},t.webview.html=this.getWebviewContent(t.webview),t.webview.onDidReceiveMessage(async s=>{switch(console.log("Received message:",s),s.type){case"addPrompt":this.addPrompt(s.prompt);break;case"updatePrompt":this.updatePrompt(s.prompt);break;case"deletePrompt":this.deletePrompt(s.id);break;case"getPrompts":this.handleGetPrompts(t.webview);break}})}getWebviewHtml(t){let r=t.asWebviewUri(or.Uri.joinPath(this.context.extensionUri,"media","prompt-manager.js"));return`<!DOCTYPE html>
    <html>
      <head>
        <link href="${t.asWebviewUri(or.Uri.joinPath(this.context.extensionUri,"media","prompt-manager.css"))}" rel="stylesheet">
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h2>Prompt Manager</h2>
            <button id="addPrompt">Add New Prompt</button>
          </div>
          <div id="promptList"></div>
        </div>
        <script src="${r}"></script>
      </body>
    </html>`}addPrompt(t){let r=Date.now(),n={id:this.generateId(),...t,createdAt:r,updatedAt:r};console.log("Adding new prompt:",n),this.store.prompts.push(n),this.savePrompts(),this.sendPromptsToAll(this.store.prompts)}updatePrompt(t){let r=this.store.prompts.findIndex(n=>n.id===t.id);r!==-1&&(this.store.prompts[r]={...t,updatedAt:Date.now()},this.savePrompts(),this.sendPromptsToAll(this.store.prompts))}deletePrompt(t){this.store.prompts=this.store.prompts.filter(r=>r.id!==t),this.savePrompts(),this.sendPromptsToAll(this.store.prompts)}sendPromptsToAll(t){this.webView?.webview.postMessage({type:"updatePrompts",prompts:t}),this._panel?.webview&&this._panel.webview.postMessage({type:"updatePrompts",prompts:t})}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}getPrompts(){return this.store.prompts}setPanel(t){this._panel=t}getWebviewContent(t){let r=t.asWebviewUri(or.Uri.joinPath(this.context.extensionUri,"media","prompt-manager.js")),n=t.asWebviewUri(or.Uri.joinPath(this.context.extensionUri,"media","prompt-manager.css")),s=t.asWebviewUri(or.Uri.joinPath(this.context.extensionUri,"media","vendor","tailwindcss.3.2.4.min.js"));return`<!DOCTYPE html>
        <html>
            <head>
                <link href="${n}" rel="stylesheet">
                <script src="${s}"></script>
            </head>
            <body class="overflow-hidden">
                <div class="flex flex-col h-screen">
                    <div class="flex-1 overflow-y-auto p-4">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <h2 class="text-lg font-semibold">Prompt Manager</h2>
                            </div>
                            <button id="addPrompt" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                </svg>
                                New Prompt
                            </button>
                        </div>
                        <div id="promptList" class="space-y-4"></div>
                    </div>
                </div>
                <script src="${r}"></script>
            </body>
        </html>`}handleGetPrompts(t){t.postMessage({type:"updatePrompts",prompts:this.store.prompts})}};var il=["addTests","findProblems","optimize","explain","addComments","completeCode","generateCode","customPrompt1","customPrompt2","adhoc"];async function rm(e){let t=e.globalState.get("chatgpt-adhoc-prompt")||"",r=new Zr(e),n=J.window.registerWebviewViewProvider("chatgpt-copilot.view",r,{webviewOptions:{retainContextWhenHidden:!0}}),s=J.commands.registerCommand("chatgpt-copilot.freeText",async()=>{let h=await J.window.showInputBox({prompt:"Ask anything..."});h&&r?.sendApiRequest(h,{command:"freeText"})}),a=J.commands.registerCommand("chatgpt-copilot.clearConversation",async()=>{r?.sendMessage({type:"clearConversation"},!0)}),o=J.commands.registerCommand("chatgpt-copilot.exportConversation",async()=>{r?.sendMessage({type:"exportConversation"},!0)}),l=J.commands.registerCommand("chatgpt-copilot.clearSession",()=>{e.globalState.update("chatgpt-session-token",null),e.globalState.update("chatgpt-clearance-token",null),e.globalState.update("chatgpt-user-agent",null),e.globalState.update("chatgpt-gpt3-apiKey",null),r?.clearSession(),r?.sendMessage({type:"clearConversation"},!0)}),u=J.workspace.onDidChangeConfiguration(h=>{h.affectsConfiguration("chatgpt.response.showNotification")&&(r.subscribeToResponse=J.workspace.getConfiguration("chatgpt").get("response.showNotification")||!1),h.affectsConfiguration("chatgpt.response.autoScroll")&&(r.autoScroll=!!J.workspace.getConfiguration("chatgpt").get("response.autoScroll")),h.affectsConfiguration("chatgpt.gpt3.model")&&(r.model=J.workspace.getConfiguration("chatgpt").get("gpt3.model")),h.affectsConfiguration("chatgpt.gpt3.customModel")&&r.model==="custom"&&(r.model=J.workspace.getConfiguration("chatgpt").get("gpt3.customModel")),(h.affectsConfiguration("chatgpt.gpt3.apiBaseUrl")||h.affectsConfiguration("chatgpt.gpt3.model")||h.affectsConfiguration("chatgpt.gpt3.apiKey")||h.affectsConfiguration("chatgpt.gpt3.customModel")||h.affectsConfiguration("chatgpt.gpt3.organization")||h.affectsConfiguration("chatgpt.gpt3.maxTokens")||h.affectsConfiguration("chatgpt.gpt3.temperature")||h.affectsConfiguration("chatgpt.systemPrompt")||h.affectsConfiguration("chatgpt.gpt3.top_p"))&&r.prepareConversation(!0),(h.affectsConfiguration("chatgpt.promptPrefix")||h.affectsConfiguration("chatgpt.gpt3.generateCode-enabled")||h.affectsConfiguration("chatgpt.gpt3.model"))&&b()}),c=J.commands.registerCommand("chatgpt-copilot.adhoc",async()=>{let h=J.window.activeTextEditor;if(!h)return;let w=h.document.getText(h.selection),_=!1;w&&(await J.window.showInputBox({title:"Add prefix to your ad-hoc command",prompt:"Prefix your code with your custom prompt. i.e. Explain this",ignoreFocusOut:!0,placeHolder:"Ask anything...",value:t}).then(I=>{if(!I){_=!0;return}t=I.trim()||"",e.globalState.update("chatgpt-adhoc-prompt",t)}),!_&&t?.length>0&&r?.sendApiRequest(t,{command:"adhoc",code:w}))}),p=J.commands.registerCommand("chatgpt-copilot.generateCode",()=>{let h=J.window.activeTextEditor;if(!h)return;let w=h.document.getText(h.selection);w&&r?.sendApiRequest(w,{command:"generateCode",language:h.document.languageId})}),d=il.filter(h=>h!=="adhoc"&&h!=="generateCode").map(h=>J.commands.registerCommand(`chatgpt-copilot.${h}`,()=>{let w=J.workspace.getConfiguration("chatgpt").get(`promptPrefix.${h}`),_=J.window.activeTextEditor;if(!_)return;let I=_.document.getText(_.selection);I&&w&&r?.sendApiRequest(w,{command:h,code:I,language:_.document.languageId})})),f=new ir(e),v=J.window.registerWebviewViewProvider("chatgpt-copilot.promptManager",f),g=J.commands.registerCommand("chatgpt-copilot.managePrompts",async()=>{await J.commands.executeCommand("chatgpt-copilot.promptManager.focus")}),m=J.commands.registerCommand("chatgpt-copilot.debugPrompts",async()=>{let h=e.globalState.get("prompts");console.log("Current stored prompts:",h),J.window.showInformationMessage(`Stored prompts: ${JSON.stringify(h,null,2)}`)}),y=J.commands.registerCommand("chatgpt-copilot.togglePromptManager",async()=>{let h=J.window.createWebviewPanel("chatgpt-copilot.promptManager","Prompt Manager",J.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e.extensionUri]}),w=new ir(e);w.setPanel(h),h.webview.html=w.getWebviewContent(h.webview),h.webview.onDidReceiveMessage(async _=>{switch(_.type){case"addPrompt":w.addPrompt(_.prompt);break;case"updatePrompt":w.updatePrompt(_.prompt);break;case"deletePrompt":w.deletePrompt(_.id);break;case"getPrompts":h.webview.postMessage({type:"updatePrompts",prompts:w.getPrompts()});break}}),h.onDidDispose(()=>{w.setPanel(void 0)})});e.subscriptions.push(n,s,a,o,l,u,c,p,...d,v,g,m,y);let b=()=>{il.forEach(h=>{if(h==="generateCode"){let w=!!J.workspace.getConfiguration("chatgpt").get("gpt3.generateCode-enabled"),_=J.workspace.getConfiguration("chatgpt").get("gpt3.model");w=w&&_.startsWith("code-"),J.commands.executeCommand("setContext","generateCode-enabled",w)}else{let w=!!J.workspace.getConfiguration("chatgpt.promptPrefix").get(`${h}-enabled`);J.commands.executeCommand("setContext",`${h}-enabled`,w)}})};b()}function nm(){}0&&(module.exports={activate,deactivate});
/**
 * @author Pengfei Ni
 *
 * @license
 * Copyright (c) 2024 - Present, Pengfei Ni
 *
 * All rights reserved. Code licensed under the ISC license
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
*/
/**
 * @author Pengfei Ni
 *
 * @license
 * Copyright (c) 2022 - 2023, Ali Gençay
 * Copyright (c) 2024 - Present, Pengfei Ni
 *
 * All rights reserved. Code licensed under the ISC license
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 */
